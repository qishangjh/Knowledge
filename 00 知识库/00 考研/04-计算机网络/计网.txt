                      公众号：一大颗牛奶糖 

计网-仅供参考，已纸质版本为准 

•  一、计算机网络体系结构 
                                   关注公众号【考研小舟】 
                                   免费考研资料&无水印PDF 

  •  （-）计算机网络概述 

    •  1.计算机网络的概念 
       • 定义：计算机网络是一些互联的、 自治的计算机的集合c     （“网络”一词强调的是“集 

        合”的概念） 由若干结点和连接这些结点的链路组成。 

       • 互联：指的是计算机之间能实现相互通信； 
       • 自治：指的是能完整地实现计算机的各种功能。 

       •  1）广义观点： 
         • 能实现远程信息处理的系统或能进一步达成资源共享的系统。 

       • 2） 资源共享观点： 
         •  目的：资源共享 
         •    单元：分布在不同地理位置的多台独立的“自治计算机”。 
         •    规则：协议。 

       • 3） 用户透明性观点： 
         • 计算机系统对用户好像是透明的一样。 

    • 2.计算机网络的组成 

       •  1）从 匚作方式上看，边缘部分和核心部分 
         •  （1）边缘部分： 
           • 定义：由所有连接在互联网上的主机    （端系统） 组成，用户直接使用，期 

             通信和资源共享C 

           • “主机 和主机A B进行通信” 
             •  实际上是指：“运行在主机A上的某个程序和运行在主机B上的另二合程 

               序进行通信”。 

             •  “进程”就是“运行着的程序”， 也指：“主机A的某个进程和主机B上的另 

               一个进程进行通信”， 简称“计算机之间通信”。 

         •  （2）核心部分 
           • 定义：由大量网络和连接这些网络的路由组成，为边缘部分提供联通性和交 

             换服务、 使边缘部分中的任何一台主机都能够向其他主机通信。 

           • •网络核心部分起特殊作用的是路由器，实现分组交换的关键构件，任务是转 
             发收到的分组                                  /六 
       • 2）从组成部分上看，硬件、软件 、协议                       /符 

                  非正式版本，版权所有，禁止盗印倒卖! 
﻿    •  硬件：主要由主机  （端系统）、通信链路  （双绞线等）、交换设备  （路由器、 
      交换机） 和通信处理机 （网卡） 组成。 

    •  软件：各种实现资源共享的软件和方便用户使用的各种工具软件。 
    •  协议：一种规则，规定了网络传输数据时遵循的规范。计算机网络的核心。 
  • 3） 从功能组成上看，通信子网和资源子网 
    •    子网：  （物理层、数据链路层、网络层） 
      • •组成：由各种传输介质、诵信设备和相应的网络协议组成c 
      •  功能：使网络具有数据传输、交换、控制和荏储的能力。 
        ・ 
    •    子网：  （会话层、表示层、应用层） 
      • •组成：实现资源共享功能的设备及其软件的集合。 
      • •功能：向网络用户提供共享其他计算机上的硬件资源、软件资源和数据资源 

        的服务。 

• 3.计算机网络的功能 

  • 1） 数据通信 
    •   基本最重要的功能，用来实现联网计算机译的各种信息的传输，将分散在 

      不同地理位置的计算机联系起来，进行统一的调配、管理、控制。 

    •   括连接控制、传输控制、差错控制、流量控制、路由选择、系路复用等子功 

      能。 
                       ） 
  • 2） 资源共享        / 
    • 软件共享、数据共享、硬件共享C 
                 . 
  • 3） 分布式处理 
    •    负荷过重时，将某个复杂任务分配给其他计算机系统，利用空闲计算机资 

      源以提高整个系统的利用率C 

    •    系统各计算机对用户透明，用户不知道具体哪台为其运行程序。 
  • 4） 提高可中性 
    • 各台计算机可以通过网络互为替代机c 
  • 5） 负载均衡 
    • 将工作仟务均衡地分配给计算机网络中各台计算机C 
  • 6） 信息综合处理 
    • 将分散在各地计算机中的数据资料进行集 中处理或分级处理。 

• 4.计算机网络的分类 

  • 1）按作用范围分类 
    • （1）广域网WAN （WideAreaNetwork） ： 类 比中国移动. 作用范围几十到几千 

      公里。 通常采用网状结构。     用交换技术。   结点交换机链路一般都是高 
﻿                公众号：一大颗牛奶糖 

    速链路。 

  •  （2） 城域网MAN （MetropolitanArea Network） ：类 比北京移动.  作用范围一般 
    是一个城市，距离约5-50km。多采用以太网技术。 

  •  （3） 局域网LAN （LocalArea Network） - 类比校园网, 1km左右。使用广播技 

    术。 

  •    个人局域网PAN  （PersonalArea Network） ： 类 比个人热点.  大约10m左 

    右。 

•  2）按使用者进行分类 
  •  （1）公用网：指公司出资建造的大型网络，按电信公司规定缴纳费用的人都可 
    以使用。例如中国移动、中国电信、中国联通等。 

  •  （2）专有网：某个部门为满足本单位的特殊业务工作需要而建造的网络。例如 

    铁路、电力、军队等部门的专用网。 

•  3）按传输技术分类 
  •  （1）广播式网络：所有计算机共享一个公共通信信道，一台计算机利用共享通 
    信信道发送报文分组，所有计算机都会收到，通过检查目的地址决定是否接受分 
    组。 

  •  （2）点对点网络：每条物理线路连接一对计算机。如果没有直接连接，可以通 

    过中间结点的接收、存储和转发。 

•  4）按拓扑结构分类 

    （a）总线形   （b）星形   （c）环形   （d）网状 

  •  （1）总线形网络：用单根传输线把计算机连接起来。 
     • •优点：建网容易、增减结点方便、节省线路。 
     • •缺点：重负载时通信效率不高、总线任意一处对故障敏感。 
  •  （2） 星形网络：每个终端或计算机都以单独的线路与中央设备相连。 
     • •优点：便于集中控制和管理。 
     • •缺点：成本高、中心结点对故障敏感。 
  •  （3） 环形网络：所有计算机接     备连接成一个环，环中信号单 向传输。例: 
    令牌环局域网。 

  •  （4） 网状形网络：每个结点至少两条路径与其他结点相连，多用于广域网。 
     • •优点：可靠性高。 
     • •缺点：控制复杂、线路成本高。 
•              :有线、无线 
•  6）按交换技术分类：电路交换、报文交换、分组交换                     W 

            非正式版本，版权所有，禁止盗印倒卖！              店" 
﻿• 5.计算机网络的主要性能指标 

  •  1） 速率 
     •     机发送信号是数字形式的，比特     （bit）  是数据量的单位, 表示“二进制数 

      字”。 

     •  网络技术中速室指的是数据的传送速率，也称为数据室或比特室，速率单位是 

      bit/s, bps 

     •     速率，指额定速室或标称速室，并非网络实际上运行的速率。 
  •  2） 带宽 
     •     称谓：指某个信号具有的频带宽度。信号宽带指该信号所包含的各种不同 
      频率成分所占据的频率范围，单位是赫兹一也        （千赫，兆赫，吉赫）。 

     •     称谓：表示网络中某通道传送数据的能力，在单位时间内某通道所能通过 

      的“最高数据率”， 单位但山，“比特每秒”。 

  •  3） 吞吐量 
     •   示单位时间内通过某个网络     （信道、接心病据量，吞吐量受网络的带宽 

      或网络的额定速率的限制c 

     •   吐量一般表示实际上到底有多少数据量能够通过网络，还可以用每秒传送的 

      字节数或帧数来表示 C 

  •  4） 时延                 — 
     • 定义：从网络  （或链路）   4满传送到另一端所需要的总时间。总时延二发送时 
                     吵 
      延+传播时延+处理时延+排队时延 

     •   送时延  （励超）：发送时延二数据帧长度（bit）/ 发送速率（bit/s） 
       • 主机或路由嘉爰送数据帧所需要的时间：从发送数据帧的第一个比特算起， 

         到该帧的最后一个比特发送完毕所需的时间 

     •    时延：传播时延二信道长摩（m）/电磁波在信道上传播速率（m/s） 
       • •埼威金在信道中传播一定的距离需要花费的时间。 
       • •与信号的发送速率无关。 
       • •自由空间（光速）3xl（）8m/s；铜线ZBxIO'm/s ；光纤2xl（）8m/s 
     •   理时延 
       • •主机或路 由器在收到分组时花费的时间进行处理。 
       • •处理的内容：分析分组的首部、从分组中提取数据部分、进行差错检验或查 

         找适当的路由等 

     •   队时延 
       • •分组进入路 由器后首先在输入队列中排队等待处理。路由器确定转发端口 

         后，还要在输出队列中排队等待转发。 

       • •排队时延的长短往往取决于网络中当时的通信量。 
  •  5） 时延宽带积 
﻿                     公众号：一大颗牛奶糖 

       •     ：指发送端发送的第一个比特即将到达终点时，发送端已经发了多少个比 

         特。 

       •   示链路可容纳多少个比特；时延带宽积=传播时延X 带笳 

     • 6）往返时间RTT 
       •   示从发送方发送数据开始，到发送方收到来自接收方的确认，总共经历的时 

         间。 

       •  RTT越大，在收到确认前，发送的数据越多。 

                  二                 二 
       •   返时延RTT 往返传播时延 +末端处理时间     传播时延x 2 + 末端处理时间 

     • 7）利用率 
       •     利用率 
         • •指出某个信道有百分之几的时间是被利用的。 
         • 
       •     利用率 
         • 全网络的信道利用率的加权平均值。 
       • •如果令DO表示网络空闲时的时延，D 表示网络当前的时延，D、DO和利用率U 之 

         间的关系。 

       • •当网络利用率达到其容量的1/2时，时延要加倍， 当网络利用率接近最大值1 

         时，网络的时延趋于无限大，信道或网络的利用率过高会产生非常大的时延。 

                    时延 
                    急剧 
                    增大, 

                          史J 用率 U 

            当信道的利用率增大时，该信道引 
                起的时延迅速增加。 

• （二）计算机网络体系结构与参考模型 

  •  1.计算机网络分层结构 

     •  1）计算机网络的体系结构 
       • 

         机网络及其所完成的功能的精准定义。 

       • 

         较容易实现的层次。 

     • 2） 分层优缺点                                      常 

                 非正式版本，版权所有，禁止盗印倒卖! 
﻿    • （1）好处： 各层之间是独立的；     性好；  结构上可以分割开；    于实现 
      和维护；  能促进标准化工作。 

    •  缺点：     效率；    功能不同层次中重复出现，产生了额外开销。 

  • 3） 分层的基本原则 
    •     层都实现相对独立的功能，降低大系统的复杂度。 
    •  各层界面自然清晰，相互交流尽可能少。 
    •   义独立于具体的实现方法，采用最合适的技术来实现。 
    . 保持下层对 卜层的独立性.  上层单向使用下层提供的服务C 
    •  整个分层结构能促进标准化工作。 

  • 4） 数据单位 
    •     次中，每个报文分为两部分：一是数据部分SDU；二是控制信息部分 
      PCI；它们共同组成PDU 

                      ： 
      •  服务数据单元  （SDU） 完成用户所要求的功能而应传送的数据 
                     ： 
      •  协议控制信息  （PCI） 控制协议操作的信息 
      •  协议数据单元  （PDU）：层次之间     据单位 
                           耀庙疑 
    •    理层的PDU称为比特. 链路层的PDU称为帧.  网络层的PDU称为分组, 传输 
      层的PD；称为报文 
    ・     n+1层收到的PDU作为第n层的SDU, 加上第n层的PCI, 就变成了第n层的 
      PDU, 交给第n-1层作为SDU发送  n-SDU+n-PCI=n-PDU= （n-1）-SDU 
                   / 
  • 5） 层次结构的含义 
    •   n层实体要使用第n-1层的服务来实现自身定义的功能，还向第n+1层提供本 

      层的服务，该服务是第n层及下面各层提供的服务的总和。 

    •     层湎共服务；中间层即是下次服务使用者，又是上层服务提供者；最高 

      层面向用户提供服务。 

    •   总   能通过相邻层间的播口使用下一层的服务.  不能调用其它层的服务C 
          0 
• 2.计算机网络协议、接口、服务的概念 

  •  1） 实体： 
    •  表示任何可发送或接收信息的硬件或软件进程。（进程） 
    •   n层中的活动元素称为n层实体，同一层次的实体称为对等实体。 
    •    同机器上的同一层次称为对等层。 

  • 2）协议 （水平）： 
    •  协议是规则的集合。为 进行网络中数据交换而建立的规则、标准或者约定称为 

      网络协议 

    •    议的三要素： 
      •  语法，数据与控制信息的结构或格式 
﻿                 公众号：一大颗牛奶糖 

       •  语义，需要发出何种控制信息，完成何种动作以及何种响应 
       •  同步，规定执行各种操作的条件、时序关系，即事件实现顺序的详细说明 
    •     议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要 
      实现本层协议，还需要使用下面一层所提供的服务 

  • 3） 服务 （垂直）： 
    •    层向它的直接上层提供的功能调用（一组原语操作）。 下层向上层通过接 

      过服务。 

    •    语划分四类： 
       •  请求: 服务用户发往服务提供者,  请求完成某项工作 
       •  指示:  服务提供者发往服务用户,  指示用户做某事情。 
       •  响应:  服务用户发往服务提供者,  作为对指示的响应。 
       •  证实:  服务提供者发往服务用户,  作为对请求的证实。 
    •   服务三种方式分类： 
       •  面向连接服务与无连接服务 
         • •面向连接的服务 
           • •双方通信时，要先建立一条通信线路，该线路面向无连接的服务包 

            括建立连接，使用连接和释放连接三个过程。 

           • •电话系统是一个面向连接的模式。 
         • •面向无连接的服务 
           • •通信双方不需要事先建立一条通信线路，而是把每个 目的地址的包 
            （报文分组）传送到线路上， 由系统选定线路进行传输。 

           •  和UDP就是两种无连接服务的协议。邮政系统是无连接的模式。 
       •    答服务和无应答服务 
         • •有应答服务：接收方在收到数据后向发送方给出相应的应答。 
         • •无应答服务：接收方收到数据后不自动给出应答。 
       •   靠服务和不可靠服务 
         • 

          传送到目的地。 

         • •不可靠服务：网络不能保证数据正确、可靠地传送到目的地，只能尽量 

          正确，可靠。 

• 3.IS0/0SI参考模型和TCP/IP模型 

             非正式版本，版权所有，禁止盗印倒卖! 
﻿  OSI 的体系结构   Tcp/ip 的体系结构  五层协议的体系结构 
                            /        / 

   7 应用层  /       应用层 

   6 表示层  /    （各种应用层协议，如    5  应用层 
               DNS, HTTP, SMTP 等） 
   5 会话层  /              /           / 

   4 运输层      运输层 TCP 或 UDP） 4  运输层 
          /      （       /           / 
   3 网络层  /      网际层 IP  /   3  网络层  / 

   2 数据链路层         接口层       2 数据链路层 
          /      网络                  / 
   1 物理层      （这一层并没有具体内容）   1  物理层 
          /              / 

     （a）          （b）            （c） 

              计算机网络体系结构： 
   （a）OSI 的七层协议；（b）TCP/IP 的四层协议；（c）五层协议 

•  I） OSI七层体系结构 
   •  （1）物理层 
      • •单位：比特 
      • •任务：在物理媒体上实现比特流的透明传输W酚 
      • •功能：在物理媒体上为数据端设备透明地传输原迄比特流。 
        •     义接口特性；     定义传输模式（单工/半双工/双工）；           传输速 
          率；      同步；     特编码 
      ・ •主要内容： 
        •   通信链路与通信结点的连接需要一些电路接口，物理层规定了这些接 

              一些参数。 

        •      了通信链路上的传输的信号的意义和电气特征。 
                   . 
   •  （2） 数据链路4  • 
      • •单位：帧 

        ♦ 
      •  任务 ：把网络层传下来的IP数据报组装成帧。 
      • •功能：      （定义帧的开始和结束）；        错控制（帧错+ 位错）；     流量控 
        制;领方问控制 （控制对信道的访问） 
      • 协议：SDLC 、HDLC 、PPP 、STP。 
   •  （3）网络层 
      • •单位：数据报。 
      • 任务： 
        •   负责为分组交换网上的不同主机提供通信服务。 
        •      层把运输层产生的报文段或用户数据报封装成分组或包进行传 

          送。 

      • •功能： 
        •   路由选择：根据网络情况，利用相应的路 由算法计算出一条合适的路 
          径，使这个分组可以顺利的到达结点B。 
        •     量控制 ：协调A 的发送速率和B的接收速率。 
﻿                 公众号：一大颗牛奶糖 

       •     控制：奇偶校验码，检查接收到的分组是否出现差错 
       • 
             控制：会有来不及接收分组而要丢弃大量分组的情况，要采取一 
         定的措施来缓解这种拥塞。 

     • •协议：IP 、IPX ICMP 、IGMP 、ARP RARP 
                、            、   、0SPFo 

     （4） 运输层 
     • 
     • •任务：负责向两台主机进程之间.端到端的通信提供数据传输服务。 
     • •功能：     传输，不可靠传输；        控制；     控制；      分用; 
     • •主要协议： 
       •   传输控制协议TCP-一提供面向连接的、 可靠的数据传输服务.数据传 

         输单位星报文段。 

       •    户数据报协议UDP--提供无连接的、尽最大努力的数据传输服务. 

         数据传输单位是用户数据报。 

     （5） 会话层 
     • •任务：允许不同主机上的各个进程之间进行会话，进程建立连接并在连接上 

       有序地传输数据。 

     • •功能： 
       •    立、 管理及终止进程间的会话 
                              c 

       •  使用校验点使通信会话在通信失效时从校验点继续恢复通信，实现数 

         据同步。 

     （6） 表示层 
     • •任务：使不同表示方法的数据和信息之间能互相交流。 
     • .功能：数据压缩、加密和解密C 

     （7） 应用层 
     • •任务：通过应用进程间的交互来完成特定网络应用，采用不、            、应用协议来 

       解决不同类型的应用要求C 

     • •协议定义：应用进程间通信和交互的规则。 
     • •应用层协议：域名系统DNS,   支持万维网应用的HTTP协议，支持电子邮件 

       的SMTP协议。 

• 2） TCP/IP四层体系结构 

        网络接口层：类似于OSI 的物理层和数据链路层。 

        网际层  （主机-主机） : 类似于OSI 的网络层。 

        传输层  （应用-应用、进程-进程） ：类似于OSI 的传输层。 

        应用层  （用户-用户） : 类似于OSI 的会话层、表示层、 

• 3） OSI与TCP/IP的比较 

  • •相似之处: 

            非正式版本，版权所有，禁止盗印倒卖! 
﻿                      公众号：一大颗牛奶糖 

•二、物理层 

     （-）通信基础 

    •  1.基本概念 
  - 
       • 1） 数据、信号、码元 
         •  数据：运送消息的实体，有意义的符号序列。 
         •  信号：数据的电气或电磁表现，是数据在传输过程汇总的存在形式。 
           • •根据信号中代表消息的参数取值方式不同 

                           ¬- 
             •     信号，连续信号   代表消息的参数的取值是连续的。 
             •     信号，离散信号一一代表消息的参数的取值是离散的。 
         • （3）码元:  一个固定时长的数字脉冲表示一位k进制数字,  代表不同离散数值的基 
          本波形。是数字通信中数字信号的计量单位。1码元可以携带多个比特的信息 

          量。 

       • 2） 速率、波特、带宽 
         •  Q）速率：数据率，指的是数据的传输速率，表示单位时间内传输的数据量。 
           •  码元传输速率   码元率 、波形速率，表示单位时间内数字通信系统所传输 
             的码元个数  （脉冲个数或信号变化次数），单位是波特     （Baud）, 1波特表 
             示数字通信系统每秒传输一个码元，码元可以是多进制。 

           •  信息传输速率   信息速率、比特率，表示单位时间内数字通信系统传输的 
             二进制码元个数，单位   是比特/秒 （b/s） 
         •  带宽： 
           •  原指，信号具有的频带宽度，单位是赫兹     （Hz） 
           • 
               示网络的通信线路所能传输数据的能力，表示单位时间内从网络中某一 
             点到另一点所能通过的“最高数据率”。 单位是b/s 
       • 3） 信源、信道、信宿 
         •   系统： 
           • •源点  （信源）：产生和发送数据的源头。 
           • •发送器：源点生成的数字比特流要通过发送器编码后才能够在传输系统中传 

             输。典型的发送器就是调制器。 

         •     系统： 
           • •接收器 ：接收传输系统传送过来的信号，并转换为能够被目的设备处理的信 

             息。典型的接收器是解调器。 

           • •终点  （信宿） 从接收器获取传送来的数字比特流，然后把信息输出（例如 
             屏幕显H）                                     x 
         •     ：信号的传输媒介，表示某个方 向传送信息的介质，通信线路往往包露 
          条发送信道和一条接收信道                             // 

                  非正式版本，版权所有，禁止盗印倒卖！            店" 
﻿     • •按传输信号形式的不同，可分为模拟信道和数字信道。 
     • •按传输介质的不同，分为无线信道和有线信道。 
• 4） 有关信道的基本概念 
  •     信息交互方式 
     •   向通信  （单工通信）：只能有一个方向的通信，没有反向交互，仅需要 

      一条信道。如无线电广播。 

     •  双向交替通信  （半双工通信）：通信的双方都可以发送信息，但是不能双 

      方同时发送或接收。两条信道。如对讲机。 

     •  双向同时通信  （全双工通信）：通信的双发可以同时发送和接收，两条信 
      道，如打电话。 

  •     数据传输方式 
     •    传输：速度慢， 费用低，适合远距离 
     •    传输：速度快， 费用高，适合近距离 
• 5） 物理层作用 
  •    可能地屏蔽掉这些传输媒体和通信手段的差异.  使物理层上面的数据链路层 

    感觉不到这些差异 

  •     的是如何在连接到各台计算机的传输媒体上传输数据比特流，而不指具体 

    的传输媒体。 

• （1）奈 氏准则 
  • •指出码元传输速率受限 
  •  理想信道.  极限码元传输率2W波特.  低信道下的极限数据传输率=2WlogW 
    ・ 
     (b/s) 

     •  W是理想低通道的带宽，单位为Hz。V表示每个码元离散 电平的数目。 
        H 
  • .结出 
     •   元传输的速率是有上限的，超过次上限，就会出现码间串扰问题，使接 

      收端不能完全正确识别码元。 

     •    的频带越宽，可更高的速率进行码元的有效传输。 
     •    传输速率受奈氏准则制约，要提高数据传输速率，需要使每个码元携 
      带更多比特的信息量，需要采用多元制。 

•香农定理 

  • •带宽受限且高斯白噪声干扰的信道的极限数据传输速率 
  •  C=Wlog2（：L+S/N） （bit/s） 
    ・ 
     •♦w为信道带宽；S为信道中所传信号平均功率；S/N为信噪比，即信号平均功 
      率与噪声平均功率之比，位为分贝      （dB） 
     • •信噪比  （dB） 10log^S/N）（dB） 
               = 
﻿                    公众号：一大颗牛奶糖 

     • •结论： 
        •  信道的带宽或信道的信噪比越大，信息的极限传输速率就越高C 
        •   要信息传输速率低于信道的极限信息传输速率，就一定存在某种方法来 

         实现无差别的传输。 

        •   一定的传输带宽和信噪比,  信息传输速率上限是一定的; 若信道带富.W 
         或信噪比S/N没有上限，则信道的极限信息传输速率C也没有上限。 
        •   元传输的速率越高，或信号传输的距离越远，或噪声干扰越大，或传输 

         媒体质量越差，在接收端的波形的失真就越严重。 

•  3.编码与调制 
   • 1） 基本概念： 

     •  调制：数字信号）模拟信号；       解调：模拟信号分数字信号 
     •     发送器   数字数据今数字信号；     调制器   数字数据）模拟信号 
     •  PCM编码器：模拟数据分数字信号；        大器调制器：模拟数据分模拟信号 
   • 2） 基带和带通信号 

             基带信号          带通信号 

     •    带信号  （即基本频带信号） ： 来自信源的信号。像计算机输出的代表各种文 

       字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表达了要传 
       输的信息的信号，比如我们说话的声波就是基带信号。 
     •     信号：把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段 
       以便在信道中传输    （即仅在一段频率范围内能够通过信道）。 

   • 3） 数字数据编码为数字信号 

        二进制数据 ； 1 o  o ； 1 i 1 i o  0 I 

         归零编码 
                      ।  1  | 

        非归零编码 

       反向非归零编码 

        曼彻斯解码 

      差分曼彻斯特编码 「LpL xmn 

     •    归零制  （NRZ）  : 正电平代表1, 负电平代表0, 不归零，一个周期全部用来 

       传输数据，无法传递时钟信号，难以同步。 

     •  归零制  （RZ） ：每个时钟周期的中间均跳变为低电平。 
                       ： 
     •  反向非归零制    （NRZI） 用信号的翻转代表0,   信号保持不变表示1。 
     •     斯特编码：位周期中心向上跳代表0,       向下跳代表1。 
        • •特点：每个码元中间电平跳变，跳变既作为时钟信号，又作为数据信号 

         位数据都需要两个电平来表示，频带宽度是原始基带宽度两倍、 以太网： 

               非正式版本，版权所有，禁止盗印倒卖! 
﻿      编码方式为易彻斯特编码c 

  •  差分曼彻斯特编码：在每一位的中心始终有跳变，位开始边界有跳变代表0, 

    没有跳变代表1 

    • •特点：码元中间有一次电平跳转，可以实现自同步，抗干扰性较好。 

•4） 数字数据调制为模拟信号 
                  — ~ 
   基带信号  o |"7~|  o o [~j i i~| Q Q 
    调幅  - —             — 
          W 
    调频  MWVW神邮WWy 
    调相  WWVWVWVW 

  •    AM：  载波的振幅随基带数字信号而变化。 
  •     FM：  载波的频率随基带数字信号而变化Q 
  •     PN： 载波的初始相位随基带数字里弁变化。 
  •  （4）正交振幅调制QAM：  多元制的振幅相位混合调制方法，信息传输速率更高。 

    •  拉种相位。 
    •    相位有1、2种振幅可选。 
    •   以调制16种码元，每种码元可以对应表示4个比特。 
    •  码元与4个比特对应关系采用格雷码：任意两个相邻码元只有1个比特不 

      同。 

•5） 模拟数据编码为数字信号 
  •    是指对模拟信号进行周期性扫描，把时间上连续的信号变成时间上离散的 

    信号。当采样的频率大于等于模拟数据的频带带宽    （最高变化频率） 的两倍时， 
    所得的离散信号可以无失真地代表被采样的模拟数据。 

  •   化是把采样取得的电平幅值按照一定的分级标度转化为对应的数字值并取整 

    数。 

  •    是把量化的结果转换为与之对应的二进制编码。 
﻿                 公众号：一大颗牛奶糖 

  •  6） 模拟数据调制成模拟信号 
    • 为实现传输的有效性，可能需要较高的频率。可使用频分复用（FDM）技术，充分 

      利用带宽资源。电话机和本地局交换机采用模拟信号传输模拟数据的编码方式； 
      模拟的声音数据是加载到模拟的载波信号中传输的。 

  •  7）调制解调原因： 
    • •调制过程 ：将信号频谱搬移到任何所需的较高频率范围，以电磁波形式辐射出 

      去。 

    • •如不进行调制，而把被传送的信号直接辐射出去，那各电台所发出信号频率就 

      会相同，他们混在一起，收信者将无法选择所要接收的信号。 

  •  8）调制作用的实质： 
    • 把各种信号的频谱搬移，使它们互不重叠地占据不同的频率范围，即信号分别托 
      付于不同频率的载波上，接收机可以分离出所需要的频率的信号，不致相互干 
      扰。 （实现了多路复用） 

•  4.电路交换、报文交换与分组交换 
  •  1） 电路交换： 
    •  过程： 先请求建立连接*  源结点和目的结点之间建立一条专用  （双方独占） 的 

      通路用干传输数据 

    •  特点： 整个报文的比特流连续地从源点直达终点，好像是在一条管道中传送C 

      传输过程中,  用户始终占用端到端的固定传输带宽C 

    •  步骤： 
       • “建立连接”（占用通信资源） 铲通话”（一直占用通信资源） 针释放连 

        接”（归还通信资源） 

    •  优点： 
       • 通信延迟小。传输数据量较大时，这一优点非常明显。 
       •    传输。按发送顺序传送数据，不存在时序问题。 
       •    冲突。不会出现争用物理信道的情况。 
       • 适用范围广。既适用于传输模拟信号，又适用于传输数字信号。 
       •    性强。物理通路一旦建立，双发可以随时通信。 
       •    简单。 
    •  缺点 ： 
       •    连接时间长。电路交换的平均连接建立时间对计算机通信来说太长。 
       •    独占，  使用效率低。连接建立后，信道被双方独占，不能被其他用户 

        使用。 

       •    性差。只要通路中任何一点出了故障，就必须重新的连接。 
       • 难以规格化。数据直达，不同类型、规格、不同速率的终端之间很难与野 
        连。                                    /千 

             非正式版本，版权所有，禁止盗印倒卖! 
﻿•2） 报文交换: 
  •  过程： 用户数据加上源地址、目的地址、校验码等辅助信息，然后封装成报 

    文，整个报文传送到相邻结点，全部存储后，再转发给下一个结点，每个报文可 
    以单独的选择到达目的结点的路径。 

  •  特点： 整个先传送到相邻结点，存储后查找转发表，转发到下一个结点。 
  •  优点： 
    •   须建立连接。不需要预先建立专用通信线路，不存在建立连接时延，随 

      时可以发送报文。 

    •   态分配线路。发送方把报文交给交换设备时，交换设备先存储整个报 
      文，然后选择合适的空闲线路，把报文送出去。 

    •     线路可靠性。如果某条路径发生故障，可以重新选择另一条路径。 
    •     线路占用率。在不同时间一段一段地部分 占用这条物理通道。 
    •     多目标服务。一个报文可以同时发送多个目的地址。 
  . 缺点： 
    •     进入交换结点要经历存储、转琴    会引起转发时延   （接收报文、校 

      验、排队、发送时间） 

    •   报文大小没有限制，但是要求网络结点有较大的缓存空间。 

•3） 分组交换： 
  •    程：将数据分成较短的固定k度的数据块，在每个数据块中加上目的地址、 
    源地址等辅助信息组成分组，以存储-转发方式传输。 

  •  概念：       .. 
    •  报文：要发送的整块数据。 
    •  “包”：  发送报文前，先将较长的报文分为一个个较小的等长数据段，每个 
      数据段有赢上由必要的控制信息组成的首部，就构成了一个分组，称 
      力'伊 
    •  “首头"：  分组的首部称为“包头”， 首部中包含目的地址和源地址等控制信 

      息。 

  •  特点： 单个分组传送到相邻结点，存储后查找转发表，转发到下一个结点。 
  •  优点： 
    •   须建立连接。不需要预先建立专用通信线路，不存在建立连接时延，随 

      时可以发送报文。 

    •   路利用率高。通信双方不是固定占用一条通信线路，不同的时间一段一 

      段地占用物理通路。 

    •   化存储管理。分组长度固定，相应缓冲区大小固定，在交换结点中对缓 

      冲区的管理，相对比较容易。 

    •     传输。分组是逐个传输的，后一个分组的存储和前一个分组的转发操 

      作并行，减少了报文的传输时间。 
﻿                  公众号：一大颗牛奶糖 

       •    了出错概率和重发数据量。分组较短，出错概率减少，每次重发数据 

        量也大大减少。 

    •   缺点： 
       •   在传输时延。分组交换比报文交换的传输时延少，但是相对电路交换扔 

        存在存储转发时延，其结点交换机必须有更强的处理能力。 

       •    传输额外的数据量。每个小数据块都要加上源地址、 目的地址和分组 

        编号等信息，信息量增大了5%-10%,  降低了通信效率，增加了处理时间，使 
        控制复杂，时延增加。 

       •    会出席失序、丢失或重复分组，分组到达 目的结点时，要对分组按编 

        号进行排序等工作 

  • 4） 主要特点 
    •    路交换一整个报文的比特流连续地从源点抵达直达终点，好像在一个管道 

      中传送 

    • 
         文交换¬一整个报文先传送到相邻结点，全部储存下来后查找转发表，转发 

      到下一个结点 

    •    组交换一-单个分组  （整个报文一部分） 传送到相邻结点，存储下来后查找 

      转发表，转发到下一个结点 

• 5.数据报与虚电路 
  • 分组交换进一步分为面向连接的虚电路和无连接的数据报 
  • 1） 数据报 
    •   步骤： 
       •    文拆成若干带有序号的数据单元，在网络层加上地址等控制信息后形 
        成数据报分组   （网络层的 PDU） 。 
       •  中间结点存储分组，找到最佳的路 由后，尽快转发每个分组。不同的分组 

        可以走不同的路径，按不同的顺序到达目的结点。 

    •   特点： 
       •  发送分组前不需要建立连接    发送方可随时发送分组,  结点可随时接收分 
        3                。 
        公 

       •   络尽最大努力交付， 传输不保证可靠性、 可能丢失; 每个分组独立选择 

        路由,  转发路径可能不同,  分组不一定按序到达目的结点 
                                        C 

       •   送的分组中要包括发送端和接收端的完整地址，独立传输。 
       •   组在交换结点存储转发时，需要排队等候处理。通过交换结点的通信较 

        大或网络发生拥塞时，时延增加，交换结点可根据情况丢弃部分分组。 

       •  网络具有冗余路径， 当某个交换结点或一条链路出现故障时，可相应地更 

        新转发表，寻找另一条路径转发分组，对故障适应能力强。 

       •    转发延时一般较小，提高网络吞吐量。                   4 
       •    双方不独占某条链路.资源利用率较高C 

             非正式版本，版权所有，禁止盗印倒卖！             店" 
﻿  • 2） 虚电路 
    •   步骤： 
       •   源主机和目的主机之间建立一条虚连接，用户发送的数据       （以分组为单 

        位） 将通过该路径按顺序传送到达目的主机。当通信完成之后用户发出释放 
        虚电路主机请求，由网络清除该虚连接。 

       •    未用过的虚电路号分配给虚电路，区别于其他虚电路，虚电路网络中 

        的每个结点上都维持一张虚电路表，包括在接收链路和发送链路上的虚电路 
        号、前一结点和下一结点的标识。数据的传输是双向进行的 

    •  （2）建立步骤 
       •    路建立 
         • 主机A发出一个特殊的"呼叫请求"分组，该分组通过中间结点送往主机 

          B, 若主机B同意连接，则发送"呼叫应答"分组予以确认。 

       •   据传输 
         • 电路建立后，主机A就可向主机B发送;        主机B也可在该虚电路上 

           向主机A发送数据。 

       •    路释放 
         • 传送结束后主机 A通过发送团   :请求”分组来拆除虚电路，逐段断开整个 

          连接。 

    •   特点： 
       •    路通信链路的建立和拆除需要时间开销，但对长时间、频繁的数据交 

        换效率较高。 

       • 虚电路的路由选择体现在连接建立阶段，连接建立确定传输路径。 
       •  虑电路提供可靠通信功能.  能保证每个分组正确且有序到达C  对两个数据 

        端点流量控制.  当接收方来不及接收数据时,    可以诵知发送方暂缓发送C 

       • 西虎电路有网络中的某个结点或某条链路出现故障而彻底失效时, 所有经过 

        该结点或该链路的虑电路将遭到破坏C 

       •  分组首部不包含目的地址,   包含虚电路标识符C  虚申.路申.路不易专用的. 
        每个结点到其他结点之间的链路可能同时有若干虚电路通过，也可能同时与 
        多个结点之间建立虚电路。 

 （二）传输介质 

• 0.概念： 
  •     介质也称传输媒体，他是发送设备和接收设备之间的物理通路，分为导向传输 

    介质和非导向传输介质。 

  •   输媒体不是物理层.  传输媒体在物理层下面.  传输媒体不知道所传输的信号是1 

    还是0, 物理层由于规定了电气特性，能够识别所传送的比特流。 

•  1.双绞线 
﻿                  公众号：一大颗牛奶糖 

   聚氯乙烯   绝缘层  铜线   聚氯乙烯 屏蔽层 绝缘层 铜线 
    套层               套层 
       （a）痔板娱           （b）屏蔽双绞线 

  •   定义：由两根采用一定规格并排绞合的、相互绝缘的铜导线组成，绞合可以减少 

    对相邻导线的电磁干扰。 

  •  2） 屏蔽双绞线：为提高双绞线抗电磁干扰的能力，在外面加上一层用金属丝编织成 
    的屏蔽层 

  •  3） 特点： 
     •  双绞线的带宽取决于铜线的粗细和传输的距离。双绞线衰减都随频率的升高而 

      增大，使用更粗的导线可以降低衰减。 

     •   于模拟传输，要用放大器放大衰减的信号 
     •   于数字传输，要用中继器将失真的信号整形 

•  2.同轴电缆 

              户套层   屏蔽层 绝缘层 
           绝缘因   ，导体 

                         内导体 

  •  ） 定义：由内导体铜质芯线、绝缘层、网状编织的外导体屏蔽层以及保护塑料外层 

    组成 

  •  2） 特点：具有很好的抗干扰特性，用于传输较高速率数据，传输距离更远，价格较 
    双绞线贵。 

  •  3） 分三 按特性阻抗数值不同，分为500同轴电缆和75Q同轴电缆。 
     •  50c主要用于传送基带数字信号，又称基带同轴电缆，在局域网中应用广泛 
     •  75C同轴电缆主要用于传送宽带信号，又称宽带同轴 电缆，主要用于有线电视 

      系统 

•  3.光缆 
  •  1） 概念：由非常透明的石英玻璃拉成细丝，主要由纤芯和包层构成双层通信圆柱 
    体，全反射 

  •  2） 优点: 
     •    容量非常大；    传输损耗小，中继距离长；       干扰性能好； 

      音，保密性好；     积小，重量轻 

  •  3） 注意： 
     •  光纤非中空。 
     •  多模光纤传输光信号的原理星光的全反射特性C 
     •    光纤：光纤的直径减小到与光线的一个波长相同时，光纤如同一个波导，           e 
      光在其中没有反射，沿直线传播。                              承 
- 4.无线传输介质                                       /手 
              非正式版本，版权所有，禁止盗印倒卖！             店" 
﻿    • 非导向传输媒体指自由空间，其中的电磁波传输称为无线传输。无线传输的频段很 

      广。 

    •  1） 无线电波 
      •   有较强的穿透能力，可以传输很长的距离，广泛应用于通信领域 
      •     有方向散播，无需对准某个方向就可以进行通信。 

    • 2）微波、红外线和激光 
      •  需要发送方和接收方存在一条视线通路，有很强的方向性，沿直线传播 
      •   外通信和激光通信需要把要传输的信号分别转换为各自的信号格式，再直接 

        在空间中传播 

      •     通信利用地球同步卫星作为 中继转发微波信号，通信容量大、距离远、覆 

        盖广，确定是端到端传播时延长 

      •     通信主要是靠电离层的反射，但短波信道的通信质量较差 

  • 5.物理层接口的特性 

    描述为确定与传输媒体的接口有关的一些特性 

    • 1） 机械特性：主要定义物理连接的边界点，指明接口片用接线器的形状、尺寸、引 
      脚数 目和排列等。            心1八 
    • 2） 电气特性：规定传输二进制位时，线路上信号的电压高低。指明在接口电缆的各 

      条线上出现的电压的范围。 

    • 3） 功能特性：指明某条线上出现的某一电平的电压表示何种意义 
    • 4） 过程特性：主要定义各条物理线路 的共工作规程和时序关系。指明对于不同功能 

      的各种可能事件的出现顺序。 

• （三）物理层设备 

  •  1.中继器 j 

    •  1） 主注骨 
      • 将信号整形并放大再转发 出去；将已经衰减得不完整的信号经过整理，重新产生 

        出完整的信号再继续传送。 

    • 2）原理: 
      • 信号再生  （并非简单地将衰减的信号放大） 
    • 3）注意: 
      •  使用中继器连接的几个网段仍然是一个局域网， 中继器没有存储转发功能，不 

        能连接两个具有不同速率的局域网。 

      •     器两端的网络部分是网段，而不是子网，4个中继器串联的5段通信介质中 

        只有3段可以挂接计算机，其余两段只能用扩展通信范围的链路段。 

      •     器和中继器都起放大作用，放大器放大的是模拟信号，原理是将衰减的信 

        号放大，中继器放大的是数字信号，原理是将衰减的信号整形再生。 
﻿                   公众号：一大颗牛奶糖 

      •   发器是物理层设备，不能识别数据链路层的帧，也无寻址功能，只有方法信 

        号功能。 

      •  中继器不仅传送有用信号,   也传送噪音和冲突信号C 

  - 2.集线器 
    •  1）  特点： 
      •     上是一个多端     继器, 工作在物理层C 
      •   它在网络中只市己信号放大和转发作用.  目的是扩大网络的传输范围，而不具备 

        信号的定向传送能力，信号传输的方向是固定的。 

      •     ，器每个接  仅简单地转发比特--收到 就转发1 L 收到0就转发0, 不讲 

        行碰撞检测,  若两个接    有信号输入，那么所有接     将收不到正确的帧。 

      •  集线器采用了专门的芯片，进行自适应串音回波抵消，这样可使接口转发出去 

        的较强信号不致对该接口收到的较弱信号产生干扰。 

      •  使用集线器的以太网在逻辑上仍是一个总线网.  各站共享逻辑上的总线,  使用 

        的还是CSMA/CD协议、 网络中的各站必须竞争对传输媒体的控制，并且在同一时 

        刻至多只允许一个站发送数据。 

      •     接线器有许多接口，两对双绞线与一台计算机上的适配器相连，即发送和 

        接收各使用一对双绞线。 

    • 2）注意： 
      •    线器的作用是将多个网络端     接在一起.  集线器为中心. 网络在拓扑结构 

        上属于星形结构C 

      •     器在物理层扩大了物理网络的覆盖范围.  但无法解决冲突域    （第二层交换 

        机可以解决） 与广播域  （第三层交换机可解决）的问题, 而且增大了冲突的概 

        工 
      •    线器没有寻址功能,  从一个端   到数据后,  从其他所有端   发出去C 
• （四）补充 

     （1） 基带传输、频带传输、宽带传输 
    •  基带传输：计算机内部或在相邻设备之间近距离传输，可以不经过调制就在信道 

      上直接进行的传输方式。 

      • •数字基带传输就是在信道中直接传输数字信号，传输媒体的整个带宽都被基带 

        信号 占用，双向的传输信息。 

    •     传输：对数字信号特定的频率的载波进行调制，将其变成适合于传送的信号 

      后再进行传输 

      • •远距离传输或无线传输时，数字信号必须用频带传输技术进行传输，解决了电 

        话系统传输数字信号的问题，实现多路复用，提高传输信道的利用率。 

    •  宽带传输：借助频带传输，可将链路容量分解成两个或多个信道，每个信道 

      携带不同的信号 

               非正式版本，版权所有，禁止盗印倒卖! 
﻿         • •宽带传输的所有信道能同时互不干扰地发送信号，链路容量大大增加。 

    •  （2）同步和异步 

       •   步：指某函数的执行方式，函数调用者需等待函数执行完后才能进行下一步，同 

        步通信双方必须先建立同步，双方的时钟要调整到同一个频率，收发双方不停地发送 
        和接收连续地同步比特流。 

       •  异步：异步通信在发送字符时，所发送的字符之间的时间间隔可以是任意的，发送 

        方可以在任意时刻开始发送字符，接收端必须时刻做好接收的准备。 

•三、数据链路层 
  • （-）数据链路层的功能 

    • 1） 概念 
       •     （link） ：从一个结点到另一个的一段物理线路  强线或无线），中间没有任 

        何其他的交换结点。 

                      ： 
       •   据链路  （data link） 控制数据传输的通信《    见这些协议的硬件和软件 
                                      网显 
        加到链路上，构成数据链路。 

       •   ：点对点信道的数据链路层的协议数醒珍《把比特组合成帧为单位传输，是为 

        了出错时只重发出错的帧，不必重发全部数据，提高效率。 

       •    管理： 
         • 数据链路层连接的建立/维持和释放过程都称为链路管理。主要适用于面向连接的 

           服务，链路两端的结点要进行通信，必须先确认对方已处于就绪状态，交换一些 
           必要信息对帧序号初始化，才能建立连接，传输完毕后要释放该连接。 
                       * 
    • 2） 数据链路层功畛^ 
       • （1）主要功能「V 
         •   曹物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造 
           为逻辑成差错的数据链路，链路管理。 
         •  在物理层提供服务的基础上向网络层提供服务。 
         •  帧定界  （确认帧的界限）、帧同步   （使接收方能区分帧的起始和终止）、透明 

           传输 （需要区分某一部分到底是数据还是帧定界符，保证任何数据都能传输） 

         •    量控制  （数据链路层控制的是相邻两个结点力间的流量） 

               控制, 保证每一帧都能有且仅有一次正确地交付给目的结点 
                                                C 
         ・ 
       •  为网络层提供服务： 

         •  无确认的无连接服务 
           • •发送时不需先建立链路连接， 目的机器收到时不需发回确认。对丢失的帧， 

             不负责重发而上交给上层处理。 

           • •适用于实时通信或误码率较低的通信信道，如以太网。 
         •  有确认的无连接服务 
﻿                     公众号：一大颗牛奶糖 

          • •不需先建立链路连接，但目的机器必须发回确认。在所规定的时间内未收到 

           确认信号时，就重传丢失的帧。 

          • •适用于误码率较高的通信信道，如无线通信 
       •    确认的面向连接服务 
          • •三个阶段：建立数据链路 、传输帧、释放数据链路 
          • •目的机器对每一帧都要给出确认，源机器收到确认以后才能发送下一帧，可 

           靠性最高 

          • •适用于通信要求较高的场合 

   （二）组帧 

  •  1） 透明传输： 
- 
     • 1）定义  数据链路层对上层交付的传输数据没有任何限制，就好像不存在一样，收 
      到什么，就传输什么 

     •   方％  如果数据里面恰好有和“开始”、 “结束”符相等的字符，这时采用字节填充 

      法  （面向字节） 或。比特填充法   （面向比特），告诉计算机这其实是数据而不是帧头 

      和帧尾 

     •   字节替充里        发送端在数据中出现控制字符“SOH”或“EOT”时，在其前面 
      插入一个转义字符“ESC”   （十六进制编码是IB）  。接收端在将数据送往网络层之前删 
      除插入的转义字符。 

     •  如果转义字符也出现数据当中，那么应在转义字符前再插入一个转义字符。用户 

      察觉不到转义字符的存在，不管所传数据是什么样的比特组合，都应当能在链路上传 
      送 

  • 2）组帧方法 
     •    节填充 

          帧的一部        帧的数据部分       帧的尾部 

       7E  A C P   7E   7D    03  FCS 7E 

       • •用特定字符来定界一帧的开始与结束，控制字符 SOH放在帧的最前面，表示帧 
         的首部开始，控制字符EOT表示帧的结束。 

       • 

         使用字节填充 

          •   息字段中每个0x7E字节转变成为2字节序列（0x7D,0x5E）; 
          •   息字段中每个0X7D字节转变成为2字节序列（0x7D,0x5D）; 
          •   息字段中每个ASCII码控制字符（小于0x20字符）， 在前面加入一个0x7D 
     •  （2）零比特填充                                       公 

                 非正式版本，版权所有，禁止盗印倒卖! 
﻿         帧的首部         帧的数据部分         帧的尾部 

      01111110  1...101001 011 10101001010...0 01111110 

                      0   0 

      •     送端，只要发现有5个连续的1,  则填充一个0,         接收端删掉对应的0。 
      •  接收端做该过程的逆操作，每收到五个连续地“1”，  自动删除后面紧跟的“0" 
   •  (3)  字符计数法 

        第一帧       第二帧      第三帧      第四帧 

      • •在帧头部使用一个技术字段来标明帧内字符数， 目的结点的数据链路层在收到 

       字符计数值时，就指导后面跟随的字节数，从而确定结束位置 

      • •计数字段提供的字节数也包含自身所占用的一个字节 
      • •缺点：如果计数字段出错，就失去了帧边界划分的依据，接收方就无法判断结 
       束位和下一个真的开始，收发双方失去同步 

   •   违规编码法 
      •    用违规编码。没有采用的编码数据             借用违规编码序列来定界帧的起始 
                                  比等。 
       和终止。 

      •  不需要采用任何填充技术，便能够实现数据传输的透明性。只适用于冗余编码 

        的特殊编码环境 

• 3) 封装成帧 

       帧的首部                        帧的尾部 

      A C                          FCS 
   1界」有1钟； 2例        不曲50(^5       2和 ［和 

   •    数据前后添加首部和尾部：首部+尾部〈帧长度 
   • 
         链路层协议都规定了所能传送的帧的数据部分长度上限一一最大传输单元 
     MTU, SOH放在帧的最前面，表示帧的首部开始，EOT表示帧的结束。 

 (三) 差错控制 
• 1) 相关概念 
   •(1)  比特差错：传输过程中可能会产生比特差错，1可能会变成。而0也可能变成1。 
   •     码率：在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 

     BER (Bit Error Rate)o 

   •   利用编码技术进行差错控制，主要有两类：自动重传请求ARQ和前向纠错FEC。 
      •  ARQ 中，接收端检测出差错时，就设法通知发送端重发，直到接收到正确的码 

       字为止。 

      •  FEC中，接收端不但能发现差错，而且能确定比特串错误位置，加以纠正。 
   •   “可靠传输” (即发送什么就收到什么)  必须再加上确认和重传机制。考虑帧重 

     复、帧丢失、帧乱序的情况。可靠传输由传输层负责。 
﻿                   公众号：一大颗牛奶糖 

    •   收到正确的帧就要向发送端发送确认，发送端一定时间内没有收到对方的确认， 

      就认为 出现了差错，就进行重传 

  • 2）检错编码   （计组） 
    •  奇偶校验码：奇校验码的1为奇数，偶校验码的1为偶数 
    •  循环冗余码：双方商定一个多项式G,    用待传送的数据M加上若干0后除以G对应的 

      二进制编码得到一个余数，将余数拼接在M的后面形成要发送的编码，接收方收到数 
      据后除以G, 若余数为0则表示没有出错 

      • 仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受 。“无差错接受”是 

        指：“凡是接收端数据链路层接受的帧都没有传输差错”（有差错的帧就丢弃而不 
        接受）。 

  • 3） 纠错编码  （计组） 
    • 海明码：检错d位.  需要d+1的海明距; 纠错d位. 需要2d+l 的海明距。 

• （四）流量控制与可靠传输机制 

  •  1 流量控制： 
     ・ 

    •  1）  相关知识点 
      •     A 向主机  传输B 数据的信道仍然是无差错的理想信道。 不能保证接收端向 

        主机交付数据的速率永远不低于发送端发送数据的速率。 

      •   由收方控制发方的数据流，使其发送速率不超过接收方的接收能力，对链路上 

        的帧的发送速率的控制，以使接收方有足够的缓冲空间来接收每个帧。 

      •   可能出现发送能力大于接收能力，如果不及时处理将会被后面不断送来的 
        帧“淹没”， 造成帧的丢失出错。 

    • 2）基本方法 
      • 由接收方控制发送方发送数据的速率。 
      •  停止等待流量控制。 
      •  滑动窗 口流量控制。 

  • 2，可靠传输： 

    •  1） 数据链路层向上层提供服务 
      •     靠传输服务：仅仅丢弃有误码帧，其他什么也不做。 
      •   靠传输服务：发送端发送什么。接收端就收到什么。 
      •     链路误码率比较低，为减少开销，不要求数据链路层向上提供可靠传输服 

        务。 

      •  无线链路易受干扰，误码率高，要求数据链路层向上提供可靠传输服务。 

    • 2） 可靠传输与无差错接收的区别                             中 
      •   数据链路层只能做到对帧的无差错接收，段“凡是接收端数据链路层接收白草 
        做， 都能以非常接近于  的概率认为 文些帧在传输过程中没有产生差错      / 
                    1      1                  ; 
               非正式版本，版权所有，禁止盗印倒卖！           店" 
﻿     •     传输：数据链路层的发送端发送什么，接收端就接收什么。 
     •     差错：比特错误；帧丢失、帧重复、帧失序。 
  •  3）确认和超时重传 
     • 
        确认：一种无数据的控制帧，使得接收方可以让发送方知道哪些内容被正确接 
       收。为提高传输效率，可将确认捎带在一个回复帧中，称为捎带确认。 

     •     重传：发送方在发送某个数据帧后就开启一个计时器，在一定时间内如果 

       没有得到发送的数据帧的确认帧，就重新发送该数据帧，直到发送成功为止。 

  •  4） 自动重传请求   （ARQ） 
     •   过接收方请求发送方重传出错的数据帧来恢复出错的帧 
     •     三种，即停止-等待ARQ、 后退N帧ARQ和选择性重传ARQ。 
     •     种协议是滑动窗口技术与请求重发技术的结合，由于窗口尺寸开到足够大 
       时，帧在线路上可以连续地流动， 又称为连续ARQt% 
  •  5） 可靠传输不仅局限于数据链路层 
                                   人 

                         TCP向其上层提供面向连接的可靠传输服务 
                         UDP向其上层提供无连接、不可靠传输服务 

                         IP向其上层提供无连接、不可靠传输服务 

                         802.11无线局域网要求数据链路层实现可K传输 
     网络接口层 网靖接口1 网IM口2 Httffnn 以太网不要求数据链路层实现可靠传输 

•  3.滑动窗口流量控制基本原理:不蓝' 
                           ） 
  •  1）相关概念           / 
     •     窗口：在任意时刻，发送方都维持一组连续的允许发送的帧的序号 
     •     窗口：   尹也维持一组连续的允许接收帧的序号。 
               琴 
     •     窗口：用来对发送方进行流量控制，而发送窗           大小w代表在还未收到 

       对方确认信息的情况下发送方最多还可以发送多少个数据帧。 

  •  2） 步马青 
     • e发送端每收到一个确认帧,  发送窗       向前滑动一个帧的位置.     当发送窗口内 

       没有可以发送的帧    （即窗口内的帧全部是已发送但未收到确认的帧） 时，发送方 
       就会停止发送，直到收到接收方发送的确认帧使窗           动，窗口内有可以发送的 

       帧后,  才开始继续发送。 

     •    收端收到数据帧后,  将窗      移一个位置，并发回确认帧、 若收到的数据 

       帧落在接收窗口之外，则一律丢弃。 

  •  3）特性 
     •     接收窗    前滑动  （同时接收方发送了确认帧） 时，发送窗        有可能 

       （只有发送方收到确认帧后才一定） 向前滑动。 

     •    滑动窗     念看,  停止-等待协议、后退N帧协议和选择重传协议只在发送 

       窗   小与将收窗      上有所差别： 

       •     •等待协议：发送窗 口大小=1, 接收窗 口大小=1。 
﻿                公众号：一大颗牛奶糖 

     •    N帧协议：发送窗 口大小＞1,  接收窗 口大小=1。 
     •  选择重传协议   发送窗 口大小＞1, 接收窗 口大小＞1 
  •   援收窗   大小为1时,  可保证帧的有序播收C 
  •     链路层的滑动窗口协议中，窗口的大小在传输过程中是固定的。 
•  4） 图解 

     （1）滑动窗口流量控制的发送窗口 

     •  a） 在发送端，发送窗   大小为 5, 在发送开始时，允许发送 5个帧，帧序 
      号为 0~4。 

     •  b） 每发送一帧之后，若未收到确认，发送窗口 自动减1。 
     •  c） 若序号为 0~4 的帧都已发送完毕，且未收到确认帧，则无法缝续发送后续 

      的帧。 

     •  d） 当发送端每收到一个确认帧后，发送窗      向前滑动一个帧的位置， 收 
      到3个帧的确认之后，可继续发送序号为 5~7 的3 个帧。 

•  5）缓存与窗口 

                       下一个期望收到的字节 

                         （b）接收缓存和接收窗口 

  •     方的应用程序把字节流写入TCP的发送缓存，接收方的应用程序从TCP的 

    接收缓存中读取字节流。 

  •     缓存用来暂时存放： 
     •  发送应用程序传送给发送方TCP准备发送的数据。 
     •  TCP 已发送出但尚未收到确认的数据。 
  •     缓存用来暂时存放： 
     •   序到达 、但尚未被接收应用程序读取的数据。 
     •  未按序到达的数据。 
•  6）捎带确认与累计确认 
  •   每两个发送数据的站都是诵过全双工连接的*      每个站既维持发送窗口 
    收窗口。 

            非正式版本，版权所有，禁止盗印倒卖! 
﻿     •     确认：在同一时间某站可能既发送数据又发送确认，将确认放在数据里面 

       一起发过去。 

     •     确认：接收方每收到K个帧发一个ACK告知发送方已正确接收前          (K-1) 帧 

       并期待第K帧。 

  • 7) 信道利用率 
     • 
       •      效率：对发送方而言，指发送方在一个发送周期的时间内，有效地发 

         送数据所需要的时间占整个发送周期的比率。 

       •      周期：发送方从开始发送数据到收到第一个确认帧为止。 
       •      吞吐率 二信道利用率x发送方的发送速率。 
     •      (停等协议为例) 

       •   TD：发送分组需要的时间，等于分组长度除以数据率 
       •   TA：发送确认分组时间 
       •   RTT：往返时间 
       •   两个分组发送间隔时间为：      (TD+RTT+TA) 

                二 
       •   利用率 U TD/ (TD+RTT+TA) 
     •(3) Notes：    • 
       •  信道在绝大多数时间都是空闲的。 
       •    RTT远大于分组发送时间TD时，利用率非常低。 

•  4•停止-等布忌☆ 

   之间的最小时间间隔 

  • 1) 停止一等待流量控制基本原理: 
﻿                  公众号：一大颗牛奶糖 

     •  0发送方每发送一帧,  都要等待播收方的应答信号.  之后才能发送下一帧；接收 
      方每接收一帧.  都要反馈一个应答信号、 表示可接收下一帧，如果接收方不反馈 
      应答信号，那么发送方必须一直等待。 

     •   次只允许发送一帧，然后就陷入等待接收方确认信息的过程中，传输效率很 

      低、信道利用率很低 

     •  从滑动窗口机制的角度看.  停止-等待协议相当于发送窗口和接收窗         小均 

      为1的滑动窗口协议C 

  • 2） 单帧滑动窗口与停止     待协议 
     •  停止-等待协议中，除数据丢失外两种差错： 
       •     目的站的帧可能已遭破坏，接收站利用差错检测技术后，简单地将该 

         帧丢弃。源站装备了一个计时器，一个帧发送后，源站等待确认，计时器计 
         满未收到确认，再次发送同样的帧。 

       •   据帧正确而确认帧被破坏，接收已接收正确帧，发送方收不到确认帧， 

         会重传已被接收的数据帧，接收方收到同样的帧会丢弃，并重传一个确认 

         帧。 

     • （2）为 了超时重发和判定重复帧的需要，发送方和接收方都须设置一个帧缓冲 
      区。发送端在发送完数据帧时，必须在其发送缓存中保留此数据帧的副本，这样 
      才能在出差错时进行重传。只有在收到对方发来的确认帧ACK 时，方可清除此副 

      本。 

•  5.后退N帧协议  （GBN） 

        图 3.10 GBN协议工作原理：对出错数据帧的处理 

  • 1）概念 
     •    滑动窗    量控制技术，采用n 个比特对帧讲行编号,  发送窗口尺寸Wr 

      必须满足 KWCn-L 接收窗    寸为L 若发送窗口尺寸大干        会造成将收 
      方无法分辨新、旧数据帧的问题。接收窗         寸为 1,  接收方只能按序来接收数 

      据帧。 

     •  发送方无须收到上一个帧的ACK后才能开始发送下一个帧，而是可以连续发送 

      帧。 

  • 2） 基本原理 
                                                     * 
     •   送方发送完一个数据帧后，不是停下来等待确认帧，可以连续再发送若无解 
      数据帧。如果收到了接收方的确认帧，那可以接着发送数据帧。               /p 

              非正式版本，版权所有，禁止盗印倒卖！             店" 
﻿       如果某个帧出错了，接收方只能简单地丢弃该帧及其所有的后续帧。要求发送 

      方重发最后一个正确接收的信息帧之后的所有未被确认的帧 

         发送方发送了N 个帧后，若发现该N 个帧的前一个帧在计时器超时后仍未返回 
      其确认信息，则该帧被判为 出错或丢失，发送方重传该出错帧及随后的N个帧。 

       接收端不一定每收到一个正确的数据帧就必须立即发挥一个确认帧，而可以在 
      连续收到好几个正确帧以后捎带确认。对某一个数据帧确认就表明该帧和此前所 

      有的数据帧均已正确无误地收到C 

  •  3) 特点 

      6连续发送数据帧提高了信道利用率,  重传时必须把原来已传送正确的数据帧讲 
      行重传  （仅因前面有一个帧出了错）,  使传送效率降低C 

         信道的传输质量很差导致误码率较大时，后退N 帧协议不一定优于停止-等待 
      协议。 

  •  4) 发送窗口尺寸l<Wr<2n-l             人 
                                  6 
       若发送窗口的大小为      发送方发送0号帧，接收窗 口发送ACK1  （但ACK1丢 
      失），接着发送1号帧，接收窗 口发送ACK2   （AC击失），以此类推，直到发送 
      方发了第 27 号帧，接收方发送 ACK2n    ，此时已经发送2n 个帧，不能再 
                            回） 
      发送数据，但一个确认都没有收到，过一段时间0号帧的计时器会到达预定时间 
      进行重发，接收方分不清是新。号帧还是重传帧，所以出现了错误，即发送窗口 
      大小不可能为27 

         在假设发送窗 口的大       情况和上面一样，发送方发送了 0~2（2 号 
                    力兵乜 
      帧，接收方发送的确认帧都丢失了，如果没有丢失就接着传 开-1号帧，但丢失 
      了，发送方应该发送0号帧。接收方可以判断出来      （下一帧只要不是第 211 号帧 
      就是重传），毛岁生错误。 
         果发送窗口尺寸小于 2支1, 更不会发生错误。 

  •  5) 例题 —0* 
      题目、采用后退N 帧（GBN）协议，发送方已发送编号0~7帧。当计时器超时时，若 
      发送方女收到0 、2 、3号帧的确认，则发送方需要重发的帧数是     （） 
                                            。 
       • 收到了3号帧，认为0 、1、2 、3号接收方已收到，需要发送4号帧以及其后续 

        所有帧 

         要收到ACK国就认为前面n-1 帧一定全部收到;      N帧重发原理是发送方 

      超时后需重发该出错帧及其后续的所有帧C 

•  6，选择重传协议  （SR） 
﻿                    公众号：一大颗牛奶糖 

           由数据链路层缓冲的帧 将分组2 ~ 8传给网络层 

  • 1）概念 
    •      滑动窗 口流量控制技术的。接收窗         寸和发送窗 口尺寸都大于 1,   一次 

      性接收多个帧。 

    •   若采用 n 个比特对帧进行编号，为避免接收端向前移动窗 口后，新接收窗口与 
      旧接收窗 口产生重叠，发送窗        最大尺 寸应该不超过序列号范围的一半； 

    •    发送窗     最大值时， 蛇二六2"一。若 Wr取大干       的值.  可能造成新、 
      旧接收窗       C 

    •     收窗口WR + 发送窗口WTs2n, n比特。 
    •   选择重传协议不支持累计确认 。 
  • 2） 基本思想 
    •   若一帧出错，则其后续帧先存入接收方的缓冲区中，同时要求发送方重传出错 

      帧，一旦收到重传帧后，就和原先存在缓冲区的其余帧一起按正确的顺序送至主 

      机。 

    •   选择重传协议避免 了重算传输那些本来已经正确到达接收方的数据帧、 提高了 
      信道利用率，代价是增加缓冲空间。 

    •   播收端要设詈具有相当容量的缓冲区来暂存那些未按序正确收到的帧               接收端 
                                                    c 

      不能接收窗口下界以下或窗         界以上的序号的帧，所需缓冲区的数目等于窗口 
      的大小，而不是序号数目。 

  • 3） 最大发送窗 口大小2-1 
    • 
      假设选择重传协议的最大发送窗口是w,        可一次性发送 0~W-1 号帧，并且接收方 
      都已经接收到了     （W个确认帧都发了），这W 个确认帧全部都丢失，此时接收窗 
         置已经移动到 W~2W-1   如果发送方再发一轮。这 W 个帧应该落在 W 〜 2W- 
                       。 
      1,  但是此时W 帧是重传的，所以若要正确，就必须满足 2W-1在最大序号 2L1之 
      内，2W-K2n-1, 即Ww2n7  。 

              n- 
    • 假设 n=3, 2 1=4o 若发送窗口为 5, 则接收窗口为 5  假设   时刻发送方发送序 
                                        。   3 
      号为0~4 的帧，t? 时刻接收方接收到序号为 0~4的帧，接收窗          到 
      [5,6,7,0,1], 并发送 0~4 号的确认帧。但是确认帧在传输中都丢失了。于是，发送 
      方在 t3 时刻重发帧 0。当t, 时刻接收方收到帧0时，由于帧。在其接收范围，。被错 
      误地当作新帧接收，导致协议错误。发送窗口的大小 

（五）介质访问控制 

               非正式版本，版权所有，禁止盗印倒卖! 
﻿•  1.信道复用技术 

  •  1） 复用是通信技术中的基本概念 

           信道 

           信道             八字信直 
           信道        庙中用      分用 1 

       （a） 不使用复用技术     （b）使用复用技术 

    •   思想：当传输介质带宽超过了传输单个信号所需的带宽时，通过在一条介质 

      上同时携带多个传输信号的方法来提高传输系统的利用率，多路复用技术能把多 
      个信号组合在一条物理信道上进行传输，使多个计算机或终端设备共享信道资 
      源，提高信道的利用率。 

    •   实质：通过分时、分频、分码等方法把原来的一条广播信道 
       •    上分为几条用于两个结点之间通信的互不锐的子信道， 
       •    上把广播信道转变为点对点信道。 

  • 2）频分复用、时分复用和统计时分复用 
    •  （1） 频分复用FDM 
                          A 

                                   时间 

       • 定义：一种将多路基带信号调制到不同频率载波上，再叠加形成一个复合信 

        号的多路复用技术。在物理信道的可用带宽超过单个原始信号所需带宽的情 
        ）市月将该物理信道的总带宽分割成若干与传输单个信号带宽相同          （或略 
        宽） 的子信道，每个子信道传输一种信号，这就是频分多路复用， 

       • 
       • •用户在分配到一定的频带后，在通信过程中始终站用这个频带。频分复用的 

        所有用户在同样的时间占用不同的带宽资源（带宽指频率带宽不是数据的发送 
        速率）。 

       • •共享时间不共享空间.  适合传输模拟信号 

       • •定义：将一条物理信道按时间分成若干时间片，轮流地分配给多个信号使用 
﻿                   公众号：一大颗牛奶糖 

       • •所有用户在不同的时间占用相同的频带宽度 
       • •时分复用可能会造成线路资源的浪费， 由于计算机数据的突发性质，用户对 

         分配到的子信道的利用率一般不高。 

     •  （3） 统计时分复用STDM 
       • •改进的时分复用，明显的提高信道的利用率，可以做到动态的分配时间， 
       •  ♦TDM 帧并不固定分配时隙，而按需动态地分配时隙，当终端有数据要传送 
         时，才会分配到时间片， 

  •  3） 波分复用 
     • 光的频分多路复用，用不同波长的光传输信息，共享空 间不共享时间 
  •  4） 码分复用 （码分多址） CDM 
     •  码分多路复用CDM ：将两个要传输的信号表示成正交的向量在公共信道上叠 

      力口， 到了 目的端后再进行数据分离，既共享时间也共享空间 

     •      每个比特时间再划分成m个短的时间槽，通常m的值是64或128 
     •  （3） Notes： 
       •  每个站点被指派一个唯一的m位码片序列。要求各个站点的码片序列相互 

         正交 

       •     1时，站点发送它的码片序列；发送。时， 站点发送该码片序列的反 

         码。当两个或多个站点同时发送时，各路数据在信道中线性相加。 

       •  每个用户在同样的时间使用同样的频带进行通信 
       •   很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现 
       •    何一个码片向量和该码片向量自己的翅,格化内积都是1. 
       •  任何一个码片向量和该码片反码向量的规格化内积都是-1. 

           S・S = —         =—.（±1）2 =1 

•  2.随即访问 
  •  1） 定义： 
     • 用户根据自己的意愿随机地发送信息， 占用信道的全部资源，既不共享时间也不 
      共享空间，当与其他用户产生冲突时就需要遵守相应的协议，是一种将广播信道 
      转化为点到点信道的行为 

  •  2） 纯ALOHA协议 （想发就发） 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿      发送成功                一1冲突重发 
   站1                        =^> 
                          四 
   站2     I 2 
                             发送成功  「 
                   冲突重发 
   站N-1       「 
              尹       = >n~i       一 
                 发送成功 
   站L             E 
                 4 
  帧到达」 

        图 3.20 纯 ALOHA 协议的工作原理 

  •    本思想 ：任何一个站点需要发送数据时，可以不进行任何检测就发送数据。 
    一段时间内未收到确认，就认为传输过程中发生了冲突。等待一段时间后再发送 
    数据，直至发送成功。 

  •    ALOHA 系统策略是让各站等待一段随机的时间，最后再进行重传。 

               时隙ALOHA协议的工作原理 

  •    本思想 ：把我有各站在时间上同步起来，并将时间划分为一段段等长的时 
    隙，规定只能在每个时隙开始时才能发送一个帧。避免了用户发送数据的随意性 
  •    隙长度   使得每个帧正好在一个时隙内发送完毕。每个帧在到达后，一般都 
    要在缓存中等待一段小于 T。的时间，然后才能发送出去。 
  4) CSM、 (先听再发) 
•       即T 
  • 思想：发送数据前先监听一下公用信道，发现信道空闲后再发送 

    信道状态  1- 坚持  非坚持          P-坚持 
     空闲 立即发 送数据 立即发送数据 以P概率 发送数据， 以1-P概率推迟下一个时除 
      忙 继续坚持侦听 放弃监听，等行随机时间  持续 倾听，直 至空闲 

  •   1-坚持CSMA：  如果监听到信道空闲，立即发送数据；如果信道忙，就一直等待 

    并且坚持监听直到信道空闲；如果发生冲突，就等待一段时间后再开始监听 

  •   非坚持CSMA：  如果监听到信道空闲，就立即发送数据；如果信道忙，则放弃监 
    听，随机等待一段时间后再次监听 

  •   p-坚持CSMA：  如果监听到信道忙，就下一个时隙再次监听；如果监听到信道空 
    闲，就会以概率p发送数据，以概率1-P推迟到下一个时隙再次监听，直到发送成 
    功或者信道忙开始随机等待 

•  5) CSMA/CD协议 (载波监听多点接入/碰撞检测) 
  •  (1)  概念： 
﻿              公众号：一大颗牛奶糖 

  •     计算机发数据，总线上所有计算机都能检测到这个数据。 
  •     送数据帧时，在帧的首部写明接收站的地址，仅当数据帧中的目的地 

    址与适配器ROM 中存放的硬件地址一致时，该适配器才接收这个数据帧，对 
    不是给 自己的数据帧就丢弃 

  •    果监听到信道空闲，就开始发送数据帧；如果信道忙，就持续监听到信 

    道空闲然后开始发送。在发送过程持续检测信号，若未检测到碰撞则直接把 
    数据帧发送完；若检测到碰撞则停止发送，并发送一个拥塞信号给所有用 
    户，然后开始执行二进制指数退避算法，等待一段时间后再开始监听信道 

  •    用干总线型或半双工通信.  主要星有线连播的局域网 
•   以太网采取两种措施 
  •  （1）  采用较为灵活的无连接工作方式，不必先建立连接就可以直接发送数 
    据。适配器对发送的数据帧不进行编号，也不要求对方发 回确认 

     •  当目的站收到有差错的数据帧时，就把帧丢弃，其他什么也不做 
     •     差错帧是否需要重传则由高层决定 
     •     层使用TCP协议，TCP就会发现丢失了一些数据，经过一段时间以 

       后，TCP就会把这些数据重新传输给以太网进行重传，但以太网并不知道 
       这是重传帧，而当做新的数据帧来发送 

  •     以太网发送的数据都使用导彻斯特编码的信号 
•  （3） CSMA/CD协议的要点 
  •   “多点接入”MA：  总线型网络，许多计算机以多点接入的方式连接在一条总 

    线上，协议的实质是“载波监听”和“碰撞检测” 

     • “载波监听”CS： 检测总线上有没有其他计算机在发送，每个站都一直不 

       停的检测信道，如果检测已有其他站在发送，则自己就暂停发送数据 

     • “碰撞检测”CD “边发送边监听”， 边发送数据边检测信道上的信号电压 

       的变化情况，判断自己也在发送数据时其他站也在发送数据。 

  •     CSMA/CD协议、 一个站不可能同时进行接收和发送      （但边发边监 
    防9 . 使用CSMA/CD协议的以太网只能讲行双向交替通信  （半双工通信） 
  •    求在发送数据帧的时间一定要大于发送端能确认未发生冲突的时间，假 
    设总线传播时延为t    （从一端到另一端时间 t）  , 则发送端开始发送数据后最 
    多经过时间2t  （争用期） 就可以确定是否发生了碰撞，发送的数据帧的最小 

    帧长二2r数据传输速率 

  •     帧长为64B, 使用字节填充，使之大于64B 
  •   以太网规定取      为争用期的长度    对于10Mb/s的以太网,  在争用期内 
              51.22         c 
    可发512bit， 即64Bc 如发牛冲突.  一定在前 64B 。 以太网规定最短顺长为 
    64B. 凡长唐小干64B的帧都易由干冲突而异常中止的无效帧,  收到1文种无效 

    帧时应立即丢弃 

  •    间距为96B, 96ns, 用来清理接收缓存，做好接收下一帧的准备 

          非正式版本，版权所有，禁止盗印倒卖! 
﻿       •    讲制指数退避算法来解决碰撞问题.重传次数大干10时, k就不再增大 

        而一直等于10. 当重传达16次仍不能成功时,  认为此帧永玩无法正确发出 

  •  6）CSMA/CA协议 （碰撞避免） 
    •   思路： 
       •    点最初有数据要发送且监听到信道空闲，则等待时间DIFS后，就发送 

        整个数据帧 

       • 如果信道忙，就执行CSMA/CA退避算法，选取一个随机回退值，只要检测 

        到信道忙，退避计时器就不变 

       •   要信道空闲，退避计时器就进行倒计时，当倒计时为。时， 站点就发送数 

        据帧并等待确认。若收到确认后还要继续发送第二帧，就直接开始执行退避 
        算法，若未收到确认帧，就必须争用该信道重传 

          间隔：所有站完成发送后，要再等待一段很短时间       （继续监听） 才能发 

       • SIFS （短IFS） ：最短IFS, 分隔属于一次对话的各帧，ACK帧、CTS 帧、分片 

        后的数据帧，以及所有回答 AP 探询的帧等。 

       • PIFS （点协调IFS） ：中等长度的IFS, 在PCF操作中使用。 
       • DIF彳包布式协调IFS） ：最长的IFS, 用于异步帧竞争访问的时延。 
    •   应用于无线局域网,  要求必须收到确认后才能继续发送 

 （六）局域网 

•  1.局域网的基本概念与体系结构 

  •  1） 局域网的概念 
    • 在一个较小的地理范围内将各种计算机、外部设备和数据库系统等通过双绞线、 

      同轴电缆等介质连接起来，组成资源和信息共享的计算机网络 

  •  2）局域网的特点 
    •     为一个单位所拥有，且物理范围和站点数目均有限 
    •   域网比广域网具有较高的数据率、较低的时延和较小的误码率 
    •     网的工作层次跨越了数据链路层和物理层 
    •   个站点的关系平等；能进行广播和组播 
  •  3）局域网的优点： 
﻿                  公众号：一大颗牛奶糖 

    •    有广播功能，从一个站点可很方便的访问全网，局域网上的主机可共享连接 

      在局域网上的各种硬件和软件资源 

    •    于系统的扩展和逐渐演变，各设备的位置可灵活调整和改变 
    •    高了系统的可靠性、可用性和生存性 

  • 4）用户合理的共享通信媒体资源： 
    •  Q） 静态划分信道： 
       • 频分复用、时分复用、波分复用、码分复用 
    •   动态媒体接入控制： 
       • 多点接入，特点是信道并非在用户之间固定分配给客户 
         •    接入：所有用户可随机的发送信息，如果恰巧有两个或更多用户 
          在同一时刻发送信息，在共享媒体上就会产生碰撞，使得用户发送的都 

          失败 

         •    接入：用户不能随机的发送信息而必须服从一定的控制。多点线 

          路探询，或轮询 

  • 5）体系结构 
    •     结构：星形结构；总线形结构；环形结构；星形和总线形的复合结构 
       •   太网。逻辑拓扑是总线形结构,  物理拓扑是星形或拓展星形结构C 
       •  令牌环（EEE802 谡辑拓扑是环形结构.  物理拓扑是星形结构c 
       •           。逻辑拓扑是环形结构，物理柘扑是双环结构。 
          FDDI（IEEE802.8） 

    •     介质：光纤、双绞线    （主流） 等 
    • （3） 介质访问控制方式：CSMA/CD, 令牌总线，令牌环等 
    •   IEEE802标准将数据链路层划分为 了逻辑链路控制子层LLC和媒体介入控制子层 

      MAC, 前者负责向上层提供无连接等服务，后者负责和物理层打交道，比如组 
      帧，介质访问控制等 

• 2•以太网与 IEEE802 3^^ 
               ・ 
  •  1） 概念： 
    • 以太网是遵循802.3标准的局域网 
  • 2） 特点： 
    •    太网涉辑上采用总线形柘扑结构.  以太网中的所有计算机共享同一条总线. 

      信息以广播方式发送C 

    •     无淬接的工作方式，尽最大努力交付，提供的是不可靠服务,  不能纠错 
    •  发送的数据都使用易彻斯特编码的信号， 每个码元中间出现一次电压转换 

  • 3）传输介质： 

             非正式版本，版权所有，禁止盗印倒卖! 
﻿                 各种传输介质适用情况 
     参数     IQBases  10Base2 lOBase T 10Base-FL 
   传输媒体  基带同轴电缆 （粗） 基带同轴电缆 （细） 非屏蔽 双绞线 光线对 
    编码     坦彻斯特编码   坦彻斯特编码  域彻斯特编码 曼彻斯特编码 
   拓扑结构     总线形      总线形      星形    点对点 
   最大段长     500m      185m    100m  2000m 
  最多结点数目     100      30      2      2 

   •   10BASE-T 非屏蔽双绞线以太网拓扑结构为星形网,  星形网中心为集线器.  但 

     使用集线器的以太网在谡辑上仍然是一个总线网. 属于一个冲突域。 

   •   Base表示 电缆上的信号是基带信号，采用曼彻斯特编码； BROAD 代表宽带信 

     号。Base 前面的数字表示数据传输率，后面的数字表示每一段电缆的最大长度 

•4） 适配器    （网卡） 
   •   计算机和外接局域网的连接是通过适配器进行的 
   •      器原是主机箱内插入的一块网络接             （NIC） , 称为“网卡”， 每个网卡 

     都有一个唯一的48位的MAC地址 

   •   功能： 
     •      数据串行数据和并行传输的转换，网络和计算机总线的数据率不相 
       同，适配器中必须装有对数据进行缓存的存储方片 
     •   实现与局域网传输介质之间的物理连接和电信号匹配，帧的发送与接收、 

       帧的封装与拆封、介质访问控制、数据的编码与解码及数据缓存功能 

     •   适配器实现的功能包含了数据链路层及物理层两个层次功能 
   •   适配器在接收和发送各种帧时，不使用计算机的CPU 
     •   接收：当适配器收到有差错的帧时，就把这个帧直接丢弃而不必通知计算 

       机， 当收到正确帧时，就使用中断通知该计算机 

     •   发送：罗算机要发送IP数据报时，就由协议栈把IP数据报向下交给适配 
       器，组装成帧后发送到局域网 

     •   适配器从网络上每收到一个MAC帧就用硬件检查MAC帧中的目的地址。是 
       本站的就收下，不是就丢弃 
   •   计算机硬件地址在适配器的ROM中. 计算机软件地址            （IP地址） 在计算机的存 

     储器中 

       生成发送的数据 把帧发送到局域网 

       处理收到的数据 从局域网接收幢 

•5） 以太网的MAC层 
   •     关概念 
     •   固化在适配器ROM 中的地址， 硬件地址——物理地址——MAC地址 
     •   “名字指出我们所要寻找的那个资源，地址指出那个资源在何处，路由告 

        诉我们如何到达该出” 

     •      与该系统所在地无关，“地址”固化在适配器的ROM中 
﻿                公众号：一大颗牛奶糖 

     •  MAC地址长度6字节，12个六进制表示 

     • 五个字段： 
       •   目的地址和源地址：都是6个字节的MAC地址 
       •      2个字节，指出数据与中携带的数据要用什么协议处理 
       •      （也就是IP数据报） ：46 〜 1500字节 （46字节是根据CSMA/CD中 

         的最短帧长是64帧确定的，而1500是认为规定） 

       •  校验码FCS ：4个字节，校验范围是从目的地址到数据端末尾，采用32 

         位循环冗余码 

     •  Notes 
       •     帧并不需要帧结束符,  以太网在传送帧时，各帧之 间必须有一定 

         的间隙。帧既要加首部，也要加尾部。 

       •    导码：在帧的前面插入8B,   使接收端与发送端进行时钟同步。这8B 
         可分为前同步码   （7B） 和帧开始定界符  （IB）两部分。 

•6） 以太网的信道利用率 

        发赞撞        |占用信道时间 
  L                  ————    - 
   争用期 j 争用期; … 争用期   发 送成功 
  ：            : 
  Jr- 2r 二|              Y   二 
       I-                 一 
   i        发送一帧所需平均时间 
               " 
  •   T 是以太网单程端到端传播时延，一个站在发送帧时出现了碰撞，经过一个 2T 
    后，可能又碰撞，经过若干个争用期后，发送成功，发送帧时间 T。二帧长 /发送 
    速率 

  •   发送一个帧需要的占用信道时间是 To+t,    比这个帧的发送时间需多出一个单 

    程端到端时延T,  这是因为当一个站发送完最后一个比特，这个比特还要在以太 
    网上传播，To+t后以太网的媒体才完全进入空闲状态 
  •   要提高以太网的信道利用率，要减小 T 与To之比，以太网定义了参数a,        以太 
    网单程端到端时延  与帧t 的发送时间T。之比：a=r /To 
     •   aX,  表示只要一发生碰撞，立即可以检测出来，并立即停止发送。参 

      数a越大，表明争用期所占比例越大 ，使每次碰撞浪费更多的信道资源 

     •   数据一定时，以太网的连线长度受到限制，同时以太网的帧长不能 
       （否则T。的值会太小，使a值太大）                        / 

            非正式版本，版权所有，禁止盗印倒卖! 
﻿     •   极限信道利用率Smax为： 

       S  =二」 
        max I 
            A +z  1+。 
       •   当参数a远小于1能得到尽可能高的极限信道利用率 
       •   当以太网利用率达到30%时处于重载情况 
  •  7）高速以太网 
     •  100BASE-T以太网，100Mb/s, 双绞线， 全双工或者半双工 
     •  吉比特以太网    （千兆以太网），lGb/s, 全双工或者半双工,  在半双工方式下 

       《市用CSMA/CD协议,  全双工方式下不适用 

     •  10吉比特以太网，光纤，只工作在全双工.  不存在争用问题 

•  3.IEEE 802.11 
  •  1） IEEE80ZH无线局域网 
     • 无线局域网的组成 
       •      定基础设施的无线局域网：最小构件是基本服务集BBS,        包括一个基 
         站AP和若干移动站，站内通信或者BB宓q的通信都要通过AP 来完成 
       •   无固定基础设施的移动自组          由一些处于平等状态的便携机构成的 
         自组网络，常规的路 由选择协议备不适用 
  •  2）802.11无线局域网的MAC/% 
     •  802.11共有三种帧，分别是数据帧，控制帧和管理帧 
     •    据帧由MAC首部 、帧主体和帧检验序列组成 
     •  802.11MAC帧首部中最重要的是三个地址 

       去往AP 来自AP  地址1      地址2   地址3  地址4 
        0   1  接收地址=目 的地址 发送地址=AP地址 源地址 - 
        1   0  接收地址=AP地址 发送地址=源地址 目的地址 — 

•  4VLAN基就您与基本原理 
  •  1）  VLAN概念 
     •     个较大的局域网分割成一些较小的与地理位置无关的逻辑上的VLAN,          每个 

       VLAN 是一个广播域，用VID来标识不同的VLAN 

     •  VLAN 帧最大帧长从1518字节，变为1522字节 
     •     VLAN 范围可以跨越不同交换机， 
     •  同一个VLAN 中的机器相互通信时，主机先把信息发送给交换机，交换机在转发 

       前给帧加上VLAN标签再发送给另一个交换机 

     •     VLAN 内的机器之间想实现通信需要借助路 由器或者三层交换机        （也就是需 

       要上层的帮助） 

  •  2）VLAN标签 
﻿                    公众号：一大颗牛奶糖 

     •    以太网帧中插入一个4字节的标识符（插入在源地址字段和类型字段之 间）， 用 

       来指明该帧属于哪个虚拟局域网 

     •     VLAN 标签的帧称为802.1Q帧 

                         802」Q帧 

     •  VLAN 标签的前2个字节置为0x8100, 表示这是一个802.Q帧 
     •  VLAN 标签的后2个字节，前4位没有用，后12位是标识符VID,     唯一标志该帧属 

       于哪个VLAN 

   • 3）图解 

                  图 3.2 利用以太网交换机构成虚拟局域网 

     •    A 向B发送帧，交换机1根据帧首部的目的MAC地址，识别B属于本交换机管理 

       的VLAN-10, 就像普通以太网中那样直接转发帧。 

     •    A 向E发送帧，交换机1必须把帧转发到交换机2,      在转发前，要插入VLAN 标 
       签，否则交换机2不知道应把帧转发给哪个VLAN 因此在交换机端口之间的链接上 
       传送的帧是802.10帧。交换机2在向E转发帧之前，要拿走已插入的VLAN标签，E 
       收到的帧是A发送的标准以太网帧，而不是802.10帧。 

     •    A 向C发送帧，A和C都连接在同一个交换机，但它们已处在不同的网络（VLAN- 
       10和VLAN-20）中，需要通过上层的路 由器来解决，也可以在交换机中嵌入专用芯 

       片来进行转发 

 （七）广域网 

•  1.广域网的基本概念 

   •  1） 概念： 
     •    盖范围很广的长距离网络，广域网能够连接两个相距很远的局域网，但丕能 

       连播两个不同类型的网络. 结点交换机只能在单个网络中讲行分组转发 

     •  组成：广域网由一些结点交换机以及连接这些结点交换机的链路组成。               （结点 

       交换机在单个网络中转发分组，路由器在多个网络构成互联网中转发分组） 

     •  广域网为单一的网络 

               非正式版本，版权所有，禁止盗印倒卖! 
﻿   •2) 局域网和广域网的区别联系 

                   表 3-5 广域网和局域网的区别与联系 

      比较标准         广域网               局域网 

      覆盖范围       很广，通常跨区域         较小，通常在一个区域内 

      连接方式       点对点通信方式            广播通信方式 

      OSI 层次  三层：物理层、数据链路层、网络层    两层：物理层、数据链路层 

            (1) 广域网和局域网都是互联网的重要组成构件，从互联网的角度上看，二者平等，没有包含关系 
       联系 
            (2) 连接在广域网或局域网上的主机在该网内进行通信时，只需要使用其 网络的物理地址即可 

       着重点        强调资源共享            强调数据传输 

     •    域网使用的协议主要在数据链路层         (少量物理层)，广域网使用的协议主要 

       在网络层 

     •   局域网通过交换机组成更大局域网  (即广域网) 
     •   路由选择协议负责搜索分组从某个节点到 目的节点的最佳传输路电，以便构造 

       路由表。从路由表再构造出转发分组的转发表，分组是通过转发表进行转发的。 

•  2.点对点协议PPP+ 
   •1)  定义 

          用串行线路通信的面向字节的协议 

          户要连接某个isp才能接入互联网,  ppp协议是用户和ISP通信用的数据链路 

       层协议 

   •2) 组成 

         封装方法：将IP数据报封装到串行链路的方法，PPP既支持异步链路，也支持 

       面向比特的同步链路 

         链路控制协议FPI 用来建立、配置和测试数据链路连接。保证数据链路链 
       通，链路上所        设备存在自己的地址 

         网络控      NCP：每一个协议支持不同的网络层协议 

   •3) 需求 J 
          、八 

        • 每收一个帧，就CRC检验，如果正确就收下，反之就丢弃这个帧，其他什么 

          也不做 

     •     装成帧 
        •PPP协议规定特殊字符作为帧定界限         (帧的开始和结束) 
     •(3)  透明性 
        •PPP协议必须保证数据传输的透明性，如果数据中碰巧出现和帧定界符一样 
          的比特组合，要采取有效措施来解决 

     •(4)  多种网络层协议 
        •  PPP协议必须能够在同一条物理链路上同时支持多种网络层协议 
        •   当点对点链路所连接的是局域网或者路由器时，PPP协议必须同时支持在 

          链路所连接的局域网或路由器上运行的各种网络层协议 
﻿                  公众号：一大颗牛奶糖 

   •   多种类型链路 
     •  PPP必须能够在多种类型的链路上运行 
   •   差错检测 
     • 能够对接收端收到的帧进行检测，并立即丢弃有差错的帧 
   •   检测连接状态 
     • PPP协议必须有一种机制能够及时      (不超过几分钟)   自动检测出链路是否处 
       于正常工作状态 

   •   最大传送单元 
     •     一种类型的点对点链路设置最大传送单元MTU 的标准默认值，促进各 

       种实现之间的互操作性 

     •     一种机制使通信的两个网络层的实体能够通过协商知道或能够配置彼 

       此的网络层地址 

     •  如果高层协议发送分组超过MTU 的数值，PPP就丢弃这样的帧，并返回差错 
     •  MTU 是数据链路层的帧可以载荷的数据部分的最大长度，而不是帧的总长 

       度 

   •  (9) 网络层地址协商 
   •  (10)  数据压缩协商 
     • 提供一种方法来协商使用数据压缩算法 
•4) 特点 
   •   支持全双工、只支持点对点.  不支持多点 
   •  PPP在异步传输时用字节填充；同步传输时用零比特填充           (硬件完成) 
   •     测差错但无法纠错，是:不可靠传输协议 
   •  PPP的两端可运行不同的网络层协议， 仍可使用同一个PPP讲行通信C 

•5) 帧格式 

      帧的首部                      帧的尾部 

     A C  P        帧的数据部分       FCS 
   1字巧 1字节 "字句 2字节 ； 不超过1500^5 ； 2字节 "字节 

   •   PPP帧的首部四个字段 
     •    志字段F(Flag), 规定0x7E (Ox表示十六进制)。表示一个帧的开始或结 

       束，连续两个帧之间只需要用一个标志字段，如果出现两个连续标志字段， 
       就表示这是个空帧，应当丢弃 

     •    址字段A  (Address) 规定为OxFF (11111111) , 预留 
     •    制字段C  (Control) 规定为0x03 (00000011) , 预留 
     •    议字段P  (Protocol) 
        • 若为0x021时，PPP帧的信息字段是IP数据报 
        • 若为0XC021, 信息字段是PPP链路控制协议LCP 的数据, 

             非正式版本，版权所有，禁止盗印倒卖！ 
﻿        • 若为 0x8021, 表示这是网络层的控制数据 
   •    据部分 
     • 
          。〜 1500个字节。PPP是点对点的，非总线型，不需要用 CSMA/CD 协 
       议，没有最短帧。 

     •     据部分出现和标志位一样的比特组合时，要实现透明传输。 
   •  （3） PPP帧的尾部两个字段 
     •     验序列 ： CRC计算出的校验位 
     •     字段：同首部标志段 

•6） 工作状态 

                                          无需鉴别或 

                                        PPP链路的两端互相交换网络层特定的NCP分组. 
                        出现故障或    引以证仃  如皿PP嚏路上运行的是IP, 则使用I哝制协议IPCP来 
                         终正请求    数据通信   对PP唯路的每一端配置I 喉块  （如分配IPifi址） 

   •   PPP链路起始和终止状态是“链路静止”状态，用户电脑和ISP 路 由器间不存在 

    物理层连接 

   •   用户通过调制解调器呼叫路由器时，路由器检测信号，双方建立物理层连接 

    后，PPP就进入“链路建立”状态， 目的是建立链路层的LCP 连接 

   •   Lq章罅配置选项，发送LCP 的配置请求帧，PPP帧协议字段置为LCP对应的代 
    码 ，信息字段包含特定的配置请求 

   •   链路的另一端可发送以下相应中的一种： 
     •  配置确认帧，所有选项都接受 
     •  配置否认帧，所有选项都理解但不能接受 
     •  配置拒绝帧，选项有的无法识别或不能接受，需要协商 
   •   协商结束建立LCP链路，进入“鉴别”状态，只允许传送LCP协议的分组，鉴别 

    协议的分组以及监测链路质量的分组。若鉴别失败，转到“链路终止”状态，若鉴 
    别成功，进入“网络层协议”状态 

   •   “网络层协议”状态PPP链路两端的网络控制协议NCP 根据网络层的不同协议互 

    相交换网络层特定的网络控制分组，PPP协议两端网络层可以运行不同的网络层 
    协议，但仍使用同一个PPP协议进行通信 
﻿                     公众号：一大颗牛奶糖 

       •   网络配置完毕后，链路进行数据通信“链路打开”状态 ，链路的两个PPP端点可 

         以彼此向对方发送分组，两个端点可发送回送请求LCP分组和回送回答LCP分组， 
         检查链路状态 

       •   数据传输结束后， 由链路一端发送终止请求LCP分组请求终止链路连接，在收 
         到对方发来的终止确认LCP分组后，转到“链路终止”， 如果链路出现故障，会 
         从“链路打开”转到“链路终止”状态， 当调制解调器的载波停止后，则回到“链路静 
         止”状态 

• （八）数据链路层设备 

  • 1.局域网交换机及工作原理 

     • 1）概念 

       •   换机本质是一个多端      网桥，每个端    可以连接主机或者集线器，建二 

         个端口都星一个冲突域.  一般都工作存全双工方式 

       •  工作在数据链路层。交换机能经济地将网络分成小的冲突域 
     • 2） 原理 

       •  原理：通过动态查找表记录每个目的MAC要从哪个端口转发出去，每当从端口 

         接收到MAC帧时，交换机就会检查该表 

       •   学习：如果表中没有这个MAC地址信息，就把将这个地址加入表中，然后进 

         行转发，如果表中没有目的MAC地址对应的端口号，交换机就会向除了源端口外 
         的所有端口广播这个帧，接收到帧的结点如果发现目的地址不是自己就会直接丢 

         弃该帧 

     • 3） 特点 

       •  每个端口都直接与单台主机相连,  采用全双工方式 
       .  时联诵多对端       无碰撞地传输数据 
       •     即用，转发表通过自学习自动建立 
       •   太网交换机独占传输媒体的带宽,     也就是说对于10Mb/s的以太网,  拥有N个 

         端口的交换机的总容量为NxlOMb/s 

     • 4） 两种交换模式 

       •   通式交换机：检查帧的目的地址后立即发送出去 
         • 百诵交换方式只检查帧的目的地址，共6B.     最短传输时延是6*8bi 
           t/100Mb/s=0.48Hse 
       •  存储转发式交换机：先缓存，检查数据正确后再发送出去 
     • 5） 集线器和交换机 

                非正式版本，版权所有，禁止盗印倒卖! 
﻿              ［集线器HUB）      （集线崩HUB）     （集线器HUB） 

                           扩大了广播域 
                          扩大了碰撞域（冲突域） 

                  集线器HUB             交换机SWITCH 

             早期以太网的互连设备          目前以太网中使用 泛的互连设备 

             工作在OSI体系结构的物理层      工作在OSI体系结构的数据链路层 （也包括物理层） 

             对接收到的信号进行放大、 转发     根据MAC地址对帧进行转发 

             使用集线器作为互连设循的以太网仍然属于共享总 使用交换机作为互连设督的以太网，称为交换式以 
             线式以太网.  集线器互连起来的所有主机共享总线 太网. 交换机可以根据MAC地址过这幢，即限两破 
                                ・ 
             带室， 同一个 域和广播域.      播域. 

                                 交换机的雷个接口是一个独立的 域 

                                 交换机。寓碰指域但不隔离广播域 （VLAN除外） 
                                ・ 
•四、网络层 

      （-）网络层的功能 

      • L异构网络互联 
        • 1）  概念: 
           •   将两个以上的计算机网络，通过一定的方法，用一种或多种通信处理设备                    （即 
             中间设备） 相互连接起来，以构成更大的网络系统。 

           •    络的异构性是指传输介质、数据编码方式、链路控制协议及不同的数据单元 
             格式和转发机刺务声特点分别在物理层和数据链路层协议中定义。 
           •    IP网上的主机进行通信时，就好像在一个单个网络上通信一样，看不到互联 
             各网触2体异构细节        （编址方案、路 由选择协议） 
           •   互联网可由多个异构网络互连组成 
        •2） 中间1殳b 
           •（1）中间系统或中继系统。 

                  物理层中继系统：中继器,  集线器       （Hub） 
                                               。 
              • 
              •    据链路层中继系统:网桥或交换机c 
              •      层中继系统:路由器C 
              •      层以上的中继系统:网关C 
           •   使用物理层或数据链路层的中继系统时，只是把一个网络扩大了，从网络层的 
             角度看，仍然是同一个网络，一般并不称为网络互联。 

      - 2.路由与转发 

        （详见 （八）网络层设备） 

        •  1）  路由器功能： 
﻿                   公众号：一大颗牛奶糖 

     •     选择。  （确定哪一条路径） 
       •  根据特定的路由选择协议构造出路 由表，同时经常或定期地和相邻路由器 

         交换路由信息而不断地更新和维护路由表。 

       •  指按照复杂的分布式算法，根据从各相邻路由器所得到的关于整个网络拓 

         扑的变化情况，动态地改变所选择的路由。 

     •     转发。  （当一个分组到达时所采取的动作） 
       •  处理通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管 

         理和任务调度等。 

       •    路由器根据转发表将用户的IP 数据报从合适的端口转发出去。 

  •  2） 路由表、转发表 
     •   由表是根据路由选择算法得出的，需要对网络拓扑变化的计算最优化。 
     •  转发表是从路电表得出的，转发表的结构应当使查找过程最优化 

  •  3）补充 
     •   由器星第三层设备,  向传输层及以上层次隐藏下层的具体实现、 物理层、 数 

      据链路层、 网络层协议可以不同 
                         C 

     •    层之上的协议数据导     由器所不能处理的.  网络层以上的高层协议必须相 

      葭 

•  3 软件定义网络SDN 
   ・ 

  •  1）概念 
     •  SDN 是一种支持动态、弹性管理的新型网络体系结构，是实现高带宽、动态网络 

      的理想架构。 

  •  2） 特征 
     •     可编程 
       •  SDN的可编程性是通过为开发者们提供强大的编程接          网络有很好的编 
         程性。 

     •     平面和数据平面分离 
       •  两个层面相互分离，控制层面利用控制一数据接口对数据层面上的路由器 

         进行集中式控制，方便软件来控制网络。 

       •     统互联网中，每个路由器既有转发表又有路 由选择软件，既有数据层 

         面也有控制层面。 

     •    辑上集中管理 
       • 对分布式网络状态的集 中统一管理。逻辑集中控制为软件编程定义网络功能 

         提供架构基础、网络自动化管理。 

  •  3） SDN体系结构 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿  •  SDN 网络应用 
    • 实现了对应的网络功能应用。 
  •   向接口                       4 
    • 对上层应用的开发者，SDN提供的编程接口称为北向接口，北向接           了 

      一系列丰富的API, 开发者可以在此基础上设计自己的应用而不必关心底层的 
      硬件细节。                X Q" 
  •   向接口 
    •  SDN控制器和转发设备建立双向会话的接口称为南向接口，通过不同的南向 
      接口协议，SDN控制器就可       同的硬件设备，同时可以在设备中实现 
      上层应用的逻辑。 

  •     向接口       / 
    •  SDN控制器集群内部控制器之间的通信接 口称为东西向接口，  用于增强整个 
      控制平面的可靠性和可拓展性。 
              O 
  •  SDN控常陈' 
    • 也越为网络操作系统。控制器不仅要通过北向接 口为上层网络应用提供不同 

      层次的可编程能力，还通过南向接       SDN 数据平面进行统一的配置、管理 
      和控制。 

  •  SDN数据平面 
    •  SDN 数据平面是基于软件实现和硬件实现的数据平面设备。 
•  4) SDN的优点 
  •    局集中式控制和分布式高速转发，利于控制层面的全局优化、高性能的网络 

    转发。 

  •  灵活可编程与性能的平衡，控制和转发功能分离，网络可由专有的自动化工具 

    以编程方式配置。 

  •     成本，控制和数据层面分离，使用开放的接口协议后，实现网络设备的制 

    造与功能软件的开发相分离，有效降低成本。 

•  5) SDN的问题 
  •     风险，集 中管理容易受攻击，如果崩溃，整个网络会受到影响。 
﻿                  公众号：一大颗牛奶糖 

     •    问题，原本分布式的控制层面集中化后，随着网络规模扩大，控制器有可 

      能成为网络性能的瓶颈。 

  • 6）补充 
     •SDN结构中，路由选择软件不再需要了，路 由器之间不再相互交换路由信息。在 
      网络的控制层面有一个逻辑上的远程控制器（可以由多个服务器组成）。 远程控制 
      器掌握各主机和整个网络的状态，为每个分组计算出最佳路由，通过Openflow协 
      议（也可以通过其他途径）将转发表下发给路由器。路由器的工作很单纯，即收到 
      分组、查找转发表、转发分组。 

• 4.拥塞控制 

  •  1）  概念 
     • 如果网络的吞吐量随着网络负载的增大而下降，网络就有可能进入了拥塞状 

      态。 

     • 作用是确保子网能够承载所达到的流量，全局性过程 

  • 2） 流量控制、拥塞控制区别 
     • 3流量控制指在发送端和搭收端之间的点对点通信的控制.  流量控制抑制发送端 

      发送数据的速率，使接收端来得及接收。 

     •  拥塞控制确保通信子网能够传送待传送的数据,  从整个网络的角唐上看 

  • 3）拥塞控制方法 
     •    控制。事先将有关发生拥塞的因素考虑周到，力求网络在工作时不产生拥 

      塞。静态的预防方法。一旦整个系统启动并运行，中途不再需要修改。 

     •    控制。事先不考虑有关发生拥塞的各种因素，基于反馈环路的概念，是动 

      态的方法。 

• 5.网际协议IP 
  •1） 网际协议IP是TCP/IP体系中两个最主要的协议之一 
  •2） 与IP协议配套使用的还有三个协议： 
     • 地址解析协议ARP 
     • 网际控制报文协议ICMP 
     • 网际管理协议IGMP 
  •3） 三个协议与网际协议IP的关系 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿                                      物理硬件 

               图4-2      网际协议 IP 及其配套协议 

        •    ARP在最下面，因为IP经常要使用这个协t 
                                                       炉 
        •    ICMP  IGMP和  在这层的上部，因为他们要使用IP协议 

 （二）路由算法 

•  1.静态路由与动态路由 
    •  ）  青争态路 由算法        （非自适应路由算法） 
        •         配置网络路由 、默认路由、特定主机路由、黑洞路由。 
        •    特点：人工配置方式简单、开销小。适用于小规模网络 
        •    缺点：不能及时适应网络状态变化 
    •  2）静态路里号邛苗山环路 
        •  Q）        由而置错误导致路 由环路 
              啾唠 
           4.5 静态路由配置及其可能严维路由环路问即                  为了防止IPWK报在国由环
           【举         错误                         画剧8 没育生存时间TTL字段. 
             例】峥态路由配H    导到 
                                                   IPIMK报进入81由H后，TTL字段的值91.若 
                                                    ・・ 
                                         _ 
                                           路由环路 
                                                 TH 不等于8 购植ai由联发. 否则植表葬. 
                                          T-BWWUWM 
                                           ttR3mao 〜 
                                      、/           、 
           却92.168.1.0/24^^^ 10.0.0.0/30    10.0.1.0/30    92.16820/24. 
               192.168.1.254 10.0.0.1 10.0.0.2       」 
                                       TgU         A  192.168.2.254 Q 
               255.255.255.0 255255255252 2S5J2552552S2 2552552史2S" 比55255252 255.255.255.0 

                     R1的路由表         R2的路由表          R3的路由表 
                 目的网络     下一跳   目的网络     下一跳    目的网络     下一跳 
                 192.168.1.0/24 接口0 10.0.0.0/30 接口0 10.0.1.0/30 接口0 
                 10.0.0.0/30 接口〔 10.0.1.0/30 接口1 192.168.2.0/24 接口1 
                 192.168.2.0/24 10.0.0.2 192.168.1.0/24^/1 1.2 192.168.1.0/24 ^10.0.1.1 
                                192.168.2.0/24 10.0.1.2 

            •    R2路由表设置错误，原本192.168.L0/24网络下一跳应是R1的接口1, 错误 
               配置成R3的接口0。当发送数据报时，先发送到R3的端口0, 查找R3的路由 
               表，发现目的地址对应的下一跳为 R2的端口1, 又进行了转发后，就形成了一 
               个路由环路。 
﻿                                         公众号：一大颗牛奶糖 

                            问题： IP数据报首部设置生存时间TTL字段，进入路由器后，TTL值减 
                         如果TTL值等于0, 数据报会被丢弃。 

                  聚合了不存在的网络而导致路 由环路 

               4.5  静态路由配置及其可能产生的路由环路问题 
                                                                        192.168.0.0/24 不存在 
              【举例】 聚合了不存在的网络而导致路由环路 
                                                                       J 192.168.1.0/24 存在 
                                  192.168.2.0/24      聚合路由：192.168.0.0/22< 192.168.2.0/24 曲 

                                       192.168.2.254                    192.168.3.0/24 不存在 

                                      2255.255.255.0 
                    192.168.1.0/24              10.0.0.0/30 
                                    铲 “1 
                            192.168.1.254 R110.0.0.1       10.0.0.2 ^172.16.0.254 
                            255.255.255.0 255.255.255.252 255.255.255.252 1 255.255.255.0 

                            C     R1的路由表      、         C    R2的周由表 
                              目的网络        下一跳            目的网络     '下一跳 
                             192.168.1.0/24 接口0          10.0.0.0/30 \ 接口。 
                             10.0.0.0/30  接口1            172.16.0.0/24 '、接口1 
                             192.168.2.0/24 接口2          192.168.0.0/22 ^.0.0.1 

                                                                     ' 
                             0.0.0.0/0   10.0.0.2        192.168.3.0/24 。 
                                                         am   n nnA 

                •        R2路由表中设置一条聚合路由，将对于R2来说下一跳相同两个网络选取 
                   共同前缀聚合，得到聚合网络192.168.0.0/22。 
                •           合路由中其实有两个不存在的网络192.168.0.0/24和192.168.3.0/24, 当 

                   R2要发送数据报到192.168.3.0/24, 数据报会到达R1的接口1, 查找R1的路由 
                   表，没有该网络的路由，就会按默认路由转发回R2的接口0。 
                •           问题： 在R2路由表中设置两条黑洞路由，数据报的目的地址为 黑洞路 

                    由的目的网络，就会被丢弃而不被转发。 

          •             故障导致环路 

               【举例】 网络故障而导致路由环路 
                                        _ 
                                      _ 
                                          _ _ 
                                  192.168.2.0/24 
                                               襄转发Ipff噫担 
                                       192.168.2.254 
                                      产5.2  .结A  1的接口1- 
                                          竺      约        一 
                    192.168.1.0/24               10.0.0.0/30               172.16.0.0/24 

                            192.168.1.254 ^10.0.0.1         10.0.0.2 172.16.0.254 
                                      1 
                            255.255.255.0 255.255.255.252 255.255.255.252 255.255.255.0 
                            ,  R1的                      (     R2的路由表 
                                     卑由表 
                              目的网络        下一跳            目的网络        下一跳 
                                      ； 
                                                         10.0.0.0/30  接口。 

                              10.0.0.0/30 \ 接口1          172.16.0.0/24 接口1 
                              192.168.2.0/24 '、接口2       192.168.0.0/22 10.0.0.1 
                              0.0.0.0/0  20.0.2          192.168.3.0/24 
                             J92.16810/24 3  &           192.168.0.0/24 

                • 解决办法：设置黑洞路由 

         3） 动态路由算法: 
          • 算法：由相互连接的路由器之间彼此交换信息不断更新路由表 
          • 特点：能较好地适应网络状态的变化，实现起来比较复杂，开销较大。动态路 

              由适用于较复杂的网络。 

• 2.距离-向量路由算法 
     • 详见        （五）路由协议TRIP路 由协议 
• 3.链路状态路由算法 
I    • 1）链路状态路由算法结点任务 

                               非正式版本，版权所有，禁止盗印倒卖! 
﻿       •   主动测试邻接结点的状态。相邻结点，连接到同一条链路，或者连接到同一广 

         播型物理网络。 

       •   定期地将链路状态传播给所有其他结点，泛洪法 
   •2） 链路状态路由算法特征 
       •     洪法：向本自治系统中所有路由器发送信息，即路由器通过所有端口向所有 

         相邻的路由器发送信息。每个相邻路由器又将此信息发往其所有相邻路由器 

       •    发送的信息是与路由器相邻路由器的链路状态,  只是路由器所知道的部分信 
         息    链路状态”， 指说明本路由器与路 由器相邻及该链路的"代价" 。"代价"用来 
         表示费用、距离、时延、带宽等等。 

       •      有当链路状态发生变化时,  路由器才向所有路由器发送此信息C 
   •3） 链路状态路由优点 
       •       路由结点都使用同样的原始状态数据独立地计算路径，不依赖中间结点的 
         计算；链路状态报文不加改变地传播，采用该算法图于查找故障。 
       •     一个结点从所有其他结点接收到报文时，它可以在本地立即计算正确的通 

         路，保证一步汇聚。 

       •     路状态报文仅运载来 自单个                 于直接链路的信息，其大小与网络中的路 
                                     结点茅 
         由结点数目无关，有更好的规模可伸展性。 

•  4.层次路由 

                        路由信息协议RIP   星于距离向 
                                     RIP在因特网上II早使用 

                                     IGRP是思科早期私有的防议，现在己植 
                       内部网关路由帆议IGRP  EIGRP取代 

                                   思科私有的，用来取代IGRP的混合则由协议 
            内部网关协设IGP 0强型内部网关路由协议EIGRP 
                                   （结合距网向 磁路状态） 

                                    "于微毫状态 

                                     OSPF在各种网络中广泛便用 
     路由选择协议 
                                     集成化isisjmsp僧干网上 常用的 
                      中间系统到中间系统IS-IS IGP»蚁 

            外部网关协议EGP   边界网关命议BGP 

   •            办议   （IGP） ：自治系统内部使用的路由选择协议 
   •    外部网关防议       （EGP） : 自治系统之间使用的路 由选择协议，主要在不同自治系统 

      的路由器之间交换路由信息，并负责为分组在不同自治系统之间选择最优的路径 

   •      内路由选择： 自治系统内部的路由选择。 
   •      间路由选择： 自治系统之间的路由选择。 

        IPv4 

•  LIPv4分组 
﻿                  公众号：一大颗牛奶糖 

            首 部    一据  部  分 
          +     — IP 数据报   — 

         发送在前 
S3? 

•  1) 字段含义 
   •  版本。占4 bit 指IP的版本，        版本 
               。         IPv4/IPv6 
   •     长度。占4 bit 可表示最大十进制数是 15     以32位(4B)为单位、 最大值为 
                  。                。 
    60B (15X4B) 最常用首部长度是20B 
              。 
   •     服务。占8 bit 用来获得更好的服务 
                  。 
   •   长度。占16 bit 首部和数据之和的长度，单位为字节(1B)、 数据报的最大长 
                 。 
     度为2|6-l=65535B 以太网帧的最大传送单元   (MTU) 为 1500B, IP数据报封装成 
                。 
     帧时，数据报总长度一定不能超过下面的数据链路层的MTU 值。 

   •  标识。占16 bit 计数器，每产生一个数据报就加1,       当一个数据报的长度超过 
                。 
     网络的MTU 时，必须分片，每个数据报片都复制一次标识号，以便重装成原来数 
     据报。属于同一个数据报各分片有相同的标识 

   •  标志。占3 bit 标志字段的最低位为 MF(More Fragment), MF=1表示后面还有 
               。 
     分片，MF=O表示最后一个分片。标志字段中间一位是DF(Don't Fragment),   只有 
     当  二O 时才允许 
      DF       分片。 

   •   偏移。占13 bit 指出较长的分组在分片后，某片在原分组中的相对位置。 
                 。 
     片偏移以8 个字节(8B)为偏移单位 

   •   存时间TTL   占8 bit 路由器在转发分组前，先把TTL减1  若 TTL 被减为0, 
              。     。                      。 
     则该分组必须丢弃。 

   •  协议。占8 bit 指出此分组携带数据使用何种协议，分组数据部分应交给哪个 
               。 
    传输层协议，其中值为6表示 TCP,     值为 17表示UDP。 
   •  首部校验和。占16 bit  只校验分组的首部，而不校验数据部分。没经过一个 
                    。 
     路 由器，都重新计算 

   •  源地址字段。占4B,   标识发送方IP地址。 
   •   的地址字段。占4B,    标识接收方IP地址。 
   •     字段。用来排错，测量及安全等措施。 
   •     字段。确保首部长度为4字节的整数倍。使用全。进行填充 
• 2) 分片 
                  ： 
   •  最大传送单元MTU    一个数据链路层数据报能承载的最大数据量。MTU严孵 
     制着IP数据报长度                                     /干 

             非正式版本，版权所有，禁止盗印倒卖！                店" 
﻿   •    当IP数据报总长度大于MTU时，将IP数据报中数据分装在多个较小的IP数据报 
     中  （片） 。片在目的地的网络层被重新组装， 目的主机使用IP首部中的标识、标 
     志和片偏移字段来完成对片的重组 

      •   标识：创建一个IP数据报时，源主机为该数据报加上一个标识号。当一个 

        路由器需要将一个数据报分片时，形成的每个片都具有原始数据报的标识 
        号。目的主机收到来自同一主机的一批数据报时，它可以通过检查数据报的 
        标识号来确定哪些数据报属于同一个原始数据报的片。 

      •   标志：首部中标志位有3比特，但只有后2 比特有意义，分别是 MF 位和DF 
        位。只有当 DF二O  时，该IP数据报才可以被分片。MF用来告知目的主机该IP 数 

        据报是否为原始数据报的最后一个片。当 MF=1 时，表示相应的原始数据报还 
        有后续的片；当 MF=O 时，表示该数据报是相应原始数据报的最后一个片。 

      •   片偏移字段：目的主机在对片进行重组时，使用片偏移字段来确定片应放 

        在原始 IP 数据报的哪个位置 

   •   一个长4000B 的IP数据报    （首部20B,  数据部分3980B） 到达一个路由器，需要 

     转发到一条 MTU为 1500B的链路上。假定原始数据报的标识号为777,               分成3片。 
     片偏移值的单位是 8B,      除最后一个片外，其他所有片中的有效数据载荷都是 8 的 

     倍数。 
                                  ， 
                IP首部，20B 0           3979 

              标识=777,MF=0,DF=0 有效数据3980 

            0   1479   1480=(185x8) 2959 2960=(370x8)  3979 
       ««=777,                            有效数据 
             有效数据 
      MF=1,DF=0                    MF=0,DF=0 1020=(3980- 
       片偏移=0  1480B                片偏移=370 1480-1480)B 

•  3）IP组转发 
   •       据报的首部提取目的主机的IP地址D,          得出 目的网络地址N。 
   •   若网络N与此路由器直接相连，则把数据报直接交付给目的主机 D ；否则是间 

     接交付 ，执行步骤。 

   •       由表中有目的地址为 D的特定主机路由，则把数据报传送给路由表中所指 

     明的下一跳路由器；否则，执行步骤。 

   •     路由表中有到达网络N的路由，则把数据报传送给路由表指明的下一跳路由 

     器；否则，执行步骤 

   •     路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由 

     器；否则，执行步骤。 

   •   报告转发分组出错。 
   •  Notes 
      •   得到下一跳路由器的下地址后并不易直接将该地址填入待发送的数据报. 
        而是将该IP 地址转换成MAC地址         （通过ARP）.  将其放至UMAC版首部中.  然 
        后根据1文个MAC地址找到下一跳路由器。 
﻿                      公众号：一大颗牛奶糖 

        •     不同网络中传送时，MAC 帧中的源地址和目的地址要发生变化，但是网 

          桥转发帧时，不改变帧的源地址 

        •   路由表并没有给分组指明到某个网络的完整路径              路由表指出,  到某个网 
                                             。 

          络应当先到某个路由器       （下一跳）.  在到达以后，继续查找路由表, 知道再 

          下一步到哪个路由器 

•  ZIPV4地址与 
   •  1) IPv4地址 

       （1）定义：每台主机（路由器）的每个接口分配的32位全球唯一地址 

         组成：｛〈网络号〉，〈主机号〉｝ 

        •    络号：标志主机所连接的网络，整个互联网中唯一 
        •    机号：标志该主机，在当前网络号范围内唯一 
   •  2) 特点 

         IP地址两部分：网络号和主机号 

        •   IP地址管理机构只负责分配网络号.  而主机号自行分配 
        •      器转发分组时只根据网络号 

          IP地址标志一台主机     （路由器）和一条链路的接口，主机         （路由器）链接两个 

        不同网络时，至少要两个IP地址,  网络号必须不同 

        划 网络相同的主机在同一个网络. 同一个广播域.  用转发器            （物理层） or 网桥 

        （数据链路层） 连接起来的若干个局域网仍为一个网络 

          所有分配到网络号的网络       （局域网LAN/广域网WAN）   都是平等的，互联网同 
       等对待每一个IP地址 

        同 同一个局域网上的主机       （路由器） IP 地址中网络号必须一样 

   •  3) 地址分类 

       （1）Notes 

        •  A 、B 、C类为单播地址，D类用于多播，E保留 

                              32 位 

           A 类地址 0: 网络号          主机号 
                --8 位  —          24 位 

           B 类地址 10   网络号             主机号 
                        - 
                      16 位      .      16 位 

                   ： 
                                                - 
           C 类地址 1 10     网络号              主机号 
                L           和            1 .q 后 —r 
                                        ・   8W q 

           D 类地址 1110         多 播地址 

           E 类地址 111u      保 留为今 后使用 

         A类 

                非正式版本，版权所有，禁止盗印倒卖! 
﻿                 -8位    L           -24位一 

      A 类地址      网络号                主机号 

       •   网络号字段占1个字节，第1位固定为0,             可指派网络号27-2 个      (1-126) 
          • •全。表示“这个网络上这个主机”， 网络号全。的IP地址表示“本网络” 
          • •网络号127(01111111)为环回测试 
       •   主机号字段占3个字节，最大主机数 224-2 个 
          • •全0的主机号表示“本主机”连接到的单个网络地址 
          • •全1表示该网络上的所有主机 
   •    B类 
                       16位       卜     一16位        • 

       B类地址     10    网络号               主机号 
                  一 

                                                         吃 
       •   网络号字段占  个2    字节，前2位固定为 10,       可指派网络号2       1个  (128.0- 
         191.255) 

          •・128.0.0.0不指派 
       • 主机号字段占  个2    字节，最大主机数 2死物个I扣除全。和全1主机号 
   •  (4)C类 

       •   网络号字段占  个3    字节，前2位固定为 10,       可指派网络号225 个       (192.0.0- 
         223.255.255) • 
       •   主机号字段占1个字节，最大主机数 28-2 个 

•4)  特殊的Iy熠 

       特殊地址       网络号       主机号       源地址或目的地址 

       网络地址       特定的       全 0         都不是 

       直接广播地址     特定的       全 1        目的地址 

       受限广播地址      全 1      全 1        目的地址 

     这个网络上的这个主机    全 0      全 0      源地址或默认目的地址 

     这个网络上的特定主机    全0       特定的        目的地址 

       环回地址        127    不是全 。或全 1   源地址或目的地址 

   •    直接广播地址      (主机号全1) 

                网络号           主机号 
                特定的            全1 
              221.45.71.64  221.45.71.126 
       221.45.71.20 .1 

                        网络 

                       C类 
         路由器使用直接广播地址 向一个              IP地址： 
                                   目的 
         本地网络上的每一个主机发送报               221.45.71.255 
         文，每一个主机路由器接收和处                    255 
                                     主机号： 
         理具有直接广播地址的分组 
﻿               公众号：一大颗牛奶糖 

   •   A 、B、C类地址中，若主机号全1, 称直接广播地址。 
   •     器使用该地址把一个分组发送给特定网络上所有主机，所有主机都接 

    收和处理这个分组C 

   •     地址在 IP 分组中只能用作目的地址C 
   •  i文个地址个地 方、8、 C类地址中每个网络中可用的主机数。 
•    回地址  (网络号127) 

                     网络号和主机号 
                      127.x.y.z 

   •   一个字节等干127的小地址作为环回地址.  用来测试机器的软件。 
   •     这个地址时，分组永远不离开这个机器，分组简单地返回到协议软 

    件，用来测试 IP 软件。 

   •     ping应用程序: 发送把环回地址作为目的地址的分组.测试IP软件能 

     否接收和处理分组；客户进程用环回地址发送报文给同样机器上的服务器进 

    程。 

   •   IP分组中既能用作目的地址， 也能用作源地址c 
   •   际上是 A 类地址，环回地址会使 A 类地址中的网络数减少一个 
•    个网络上的这个主机     (o.o.o.o) 

              网络号和主机号 

   不知道自 己的IP地址的主机可发送一个报文给引导服务器，它使用IP 
   地址O.O.O.O作为源地址，而使用255.255.255.255作为目的地址 

   •  IP地址为O.O.O.O. 表示2文个网络上的主机c 
   •   个主机不知道 自己的IP地址，主机为要发现 自己的IP地址，就给引导服             竣 
    务器发送IP分组，并使用这样的地址作为源地址，并且使用255.255.255.255 
                                                    记 
    作为目的地址。                                       叁 

          非正式版本，版权所有，禁止盗印倒卖! 
﻿     •   个地址是一个A 类地址，A类地址网络减少一个 
  •    个网络上的特定主机     （网络号全0） 

            网络号      主机号 

             全0      特定的 

            一个网络上的特定主机发送报文 

           图4-11 这个网络上的特定主机 

     • 3具有全0的网络号的IP地址表示在这个网络上的特定主机 
     •   于当某个主机向同一网络上的其他主机发            寸 
     •  分组被路由器挡住，把分组限制在本地网络上的一种方法 
     •   是一个A 类地址 
  •   受限广播地址 

              网络号和主机号 

     •  31P地址为 255.255.255.255. 用于定义在当前网络 （不是整个因特网,  注意 
       出选择题1）上的广播地址C 

     •   个主机若想把报文发送给所有其他主机，可使用这样的地址作为分组中 
       的目的地址，但路由器会把这种类型的地址阻拦，使这样的广播仪局限于本 
      地局域网。 

     •  这种地址属于E类地址 

•5） 网络地址转换NAT： 
  •   定义：通过专用网络地址转换为公用地址，对外隐藏内部管理的IP地址。 
  •      ：使得整个专用网只需要一个全球 IP地址就可以与因特网连通 
  •      地址： 
﻿                    公众号：一大颗牛奶糖 

        •     可重用地址，只能用于局域网内部，不能用于广域网，路由器对目的 

         地址是私有地址的数据报一律不进行转发， 

        •  私有地址必须通过网关利用NAT转换为合法的全球IP地址后才能用于在 

         Internet中通信 

     •      原理： 
        •  NAT路由器内部维护一张NAT转换表，记录着 ｛本地IP地址：端口｝到 ｛全球IP 

         地址：端口｝的映射 

        •  当使用IP地址的主机向互联网发送数据报时，NAT路由器接收到该数据报后 

         会根据NAT转换表将该数据报中的源IP地址或者目标IP地址更换成合法的全球 
         IP地址，然后再转发给Web 服务器或者目的主机 

     •  （5）NAT与普通路由器 
        •     路由器在转发P数据报时，不改变其源 IP地址和目的IP地址。而NAT路 
         由器在转发下数据报时， 要更换其IP地址       （转换源IP地址或目的IP地址） 。 
        •   通路由器仅工作在网络层.  而NAT路由器转发数据报时需要查看和转换 

         传输层的端口号C 

     •      IP地址网段： 
        • 
           A类：1个A类网段. 即10.0.0.0〜10.255.255255c 
        • 
           B类：16个B类网段. 即N 72.16.0.0〜172.31.255.255。 
        •  C类：256个（:类网段. 即192.168.0.0〜 
                                  192.168.255.255c 

•  3.子网划分与子网掩码、CIDR^^^ 
   •  1） 子网划分 
     •  Q）概念： 
        • 
              内部讲一步对IP地址分级，形成三级旧地址:       〈网络号   子网号X主机 

         受的结构，路由器会先找到目的子网然后再转发给目的主机 

        •  只是把IP地址的定机号讲行再功/分.     不改变原来网络号 
     •      思想： 
        •   主机号借用若干比特作为子网号，主机号相应减少相同比特。 
        •     网络发给本单位某台主机的IP数据报，仍是根据 IP数据报目的网络 

         号，先找到连接到本单位网络上的路 由器。然后该路由器在收到 IP 数据报 
         后，按目的网络号和子网号找到目的子网。 

     •   特点： 
        •  子网划分纯属内部的事情。对外仍然表现为没有划分子网的网络。 
        •   分子网只是把IP地址的主机号次部分进行再划分,  不改变原来网络号C 

         从一个IP地址本身或IP数据报的首部，无法判断源主机或目的主机所连接的 
         网络是否进行了子网划分。 
                                                         2 
        •     子网划分时，子网号不能为全1或全0。                       净 

               非正式版本，版权所有，禁止盗印倒卖! 
﻿     . 子网中的丰机号为全0或全1的地址都不能被指派c       子网中主机号全。的地址 

      为子网的网络号,  主机号全1的地址为子网的广播地址 

• 2） 子网掩码 
  •   目的：使路由器知道IP地址是否使用了子网划分并且能快速知道子网号 
  •   优点：只要把子网掩码和IP地址进行逐位“与”运算,     可以得出网络地址C  主机 

    号变了全0 

  •   分组转发步骤 
     •     到分组首部提取目的 IP地址 D 。 
     •  判断是否直接交付，对路由器直接相邻网络的子网掩码和 D 逐位相"与"， 

      看是否和相应网络地址匹配。若匹配，则将分组直接交付，否则就是间接交 
      付。 

     •     由表中有目的地址为D的特定主机路由，则将分组传送给指明的下一 
      跳路 由器，否则执行。 

     •  对路由表中的每一行的子网掩码和D逐位相"与z 若其结果与该行的目的 
      网络地址匹配，则将分组传送给该行指哪电下一跳路由器；否则，执行。 
     •   路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由 
      器；否则，执行。          4公八 
     •  报告转发分组出错。 
  •   总结：            不一 
     •  主机设置 IP地址信息的同时. 必须设置子网掩码C    所有网络必须有一个子 

      网掩码，如果一个网络没有划分子网，就采用默认子网掩码。 

       •  A类地贴药品0.0.0 ；B类地址255.255.0.0 ；C类地址255.255.255.0 
     •   属于一个子网的所有主机及路由器的相应端口,  必须设置相同的子网掩 

     • 里路由器的路由表中，所包含信息的主要内容必须有目的网络地址、子网掩 

      码、下一跳地址 

     •    IP地址和不用的子网掩码可以得到相同的网络地址 
     •    掩码是一个网络或子网重要属性.  必须汜自己所在网络的子网掩码告 

      诉临近路由器 

• 3） 无分类编址CIDR 
  • 
     •    A 、B 、C 类地址及划分子网的概念，更有效地分配 IPv4 地址空间。 

                                                 二 
     •  CIDR使用“网络前缀”的概念代替子网。IP地址无分类两级编址为 JP ：：〔V 
      网络前缀〉.  v主机号A。 

     •  CIDR 使用“斜线记法”, 即IP地址/网络前缀所占比特数  网络前缀所占比特 
                                       。 
      数对应于网络号的部分,  等效于子网掩码中连续       的部分  诵过逐位 
                                   1    。 
      相"与"的方法得到该地址的网络前缀 
﻿                  公众号：一大颗牛奶糖 

       •  @QDR地址块中地址数一定杲2的整数次嘉.  实际可指派的地址数通常为 
        2N表示主机号的位数，主机号全0代表网络号，主机号全1为广播地址。 
     • （2）路由聚合  （构成超网）： 
       • 网络前缀都相同的连续IP地址组成“CIDR地址块”。 一个CIDR地址块可 以表示 

        很多地址。路 由聚合使得路 由表中的一个项目可以表示多个原来传统分类地 
        址的路由，有利于减少路由器之间的路由选择信息的交换 

     • 
       • 网络前缀长度的灵活性。上层网络的前缀长度较短，相应的路由表的项目较 

        少。内部可采用延长网络前缀的方法来灵活地划分子网。 

     •  最长前缀匹配 
       • 使用 QDR, 路 由表中的每个项目由“网络前缀”和吓一跳地址”组成。在查找 

        路由表时可能会得到不止一个匹配结果。应当从匹配结果中选择具有最长网 
        络前缀的路由，网络前缀越长，地址块就越小，路 由就越具体。 

•  4.ARP协议、DHCP协议与 ICMP协议 
  • 1） 网络层分组转发的过程 

     •   取目的IP地址 
     • 若下一跳为具体的主机则直接转发      （特定主机路由） 
     •   查路由表的每一行，将子 网掩码和目的IP地址进行与运算得到网络号，查看 

      能否与路由表表项匹配，若能匹配则转发到记录的下一跳 

     •   转发表中未查到具体表项但有默认路由，则执行默认路由 
     • 丢弃，报告分组转发出错 
  • 2） IP地址与硬件地址 

     •  IP地址与硬件地址区别 

       •  下地址是网络层使用的地址，是一种逻辑地址，分层次等级的 
       •    地址是数据链路层和物理层使用的地址，它是平面式的。 
       •  在网络层及网络层;上使用下地址.  数据链路层及以下使用的是硬件地 

        姐 

       •   地址放在IP数据报的首部.  MAC 地址放在MAC帧的首部  通过数据封 
                                          。 

        装，把IP数据报分组封装为 MAC帧后，数据链路层看不见数据报分组中的 IP 
        地址。 

       •  由于路由器的隔离，IP网络中无法通过广播方式依靠 MAC 地址来完成 
        络的寻址，在IP网络的网络层只使用 IP 地址来完成寻址。 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿•  3) 地址解析协议ARP 
  •  (1) 用途：解决同一个局域网内IP地址和MAC地址的映射 
  •      原理： 
     •   域网内每台主机都动态维护ARP表，记录本局域网上各主机和路 由器的IP 

      地址到MAC地址的映射 

     •    域网内A主机想向B主机发送信息时，如果ARP表记录了B的MAC地址， 

      直接发送给B 

     •   果没有记录，4 会使用FF-FF-FF-FF-FF-FF作为目的MAC地址来进行ARP请求 

      广播，本局域网所有主机运行ARP都能收到 

     •  B收到该请求后，给A发送响应分组，告诉A 自己的IP地址与MAC地址的映射 

      关系，A更新ARP 表再进行MAC帧发送 

  •     ARP情况： 
     •  主机找同网：发送方是主机时，要把 IP 数据报发送到本网络上的另一台主 
      机。这时用ARP找到目的主机的硬件地址。 

     •  主机找异网：发送方是主机时，要把IP数据报发送到另一个网络上的一台 
      主机。这时用ARP找到本网络上的一个路由器的硬件地址，剩下的工作由这 
                             八 
      个路 由器来完成。 

     •  路由找同网：发送方是路由器时，要把IP数据报转发到本网络上的一台主 

      机。这时用ARP找到目的主机的硬件地址。 

     •  路由找异网：发送方是路由器时，要把IP 数据报转发到另一个网络上的一 
      台主机。这时用ARP找到本网络上的一个路由器的硬件地址，剩下的工作由 
      找到的这个路由器完成。 

  ・   要点： 
     •   ip 项L到硬件地址的解析是 自动进行的，用户并不知道地址解析过程。 

      ARP 自动将IP地址解析为数据链路层所需要的硬件地址。 

     • 由铲n央射地址都设置生存时间，超过时间就删掉 
     •  ARP请求分组泉广播发送, ARP响应分组是单播 
•  4) 动态主机配置协议DHCP 
  •   提供即插即用的联网方式，允许一台计算机加入新的网络时能被动态的分配IP 

    地址而不用手动参与 

  •      原理： 
     •     UDP的C/S模式.  需要IP地址的主机广播一个‘发现报文”告知DHCP自己 

      的存在.  DHCP服务器收到消息后就会广播一个“DHCP提供”报文、 里面包含 

      了准备分配给客户机的IP地址 

     •  客户机收到后会广播“DHCP请求报文”表示想要这个IP地址，DHCP服务器收 

      到后会广播“DHCP确认”报文来告诉客户机IP地址已分配给它 

  •    换过程 
﻿                   公众号：一大颗牛奶糖 

       •   DHCP客户机广播“DHCP发现，消息，试图找到网络中的DHCP服务器，以便 
         从DHCP服务器获得一个 IP地址。 

       •   DHCP服务器收到“DHCP发现哨息后，向网络中广播“DHCP提供”消息，其 

         中包括提供 DHCP客户机的IP地址和相关配置信息。 

       •   DHCP客户机收到“DHCP提供”消息，如果接收 DHCP 服务器所提供的相关参 
         数，通过广播“DHCP请求”消息向 DHCP 服务器请求提供I P地址。 

       •   DHCP 服务器广播“DHCP确认”消息，将IP地址分配给 DHCP客户机。 

  •  5）网际控制报文协议ICMP 
     •  （1）用途 
       •     ICMP报文来让主机或路 由器报告差错或者异常情况 

       •   ICMP报文作为IP层数据报的数据，加上数据报首部，组成IP数据报发送出 

         去 

     •   ICMP差错报文 

       •     不可达  （无法交付） 

       •    点抑制  1（拥塞后丢数据） 

       •    间超过  （生I 存时间TTL=O） 

       •    数问题  （首部字段有问题） 

       •    变路由  （有1 更好的路由方向） 

     •   ICMP询问报文 

       •    送请求和回答报文：测试 目的站是否可达以及其有关状态。 

       •     戳请求和回答报文：用于时钟同步和时间测量 

       •     掩码请求和回答报文 

       •    由器询问和通告报文 

     •  不发送 ICMP 

       •    ICMP差错报告报文不再发送 ICMP 差错报告报文。 

       •  对第一个分片的数据报片的所有后续数据报片都不发送ICMP 差错报告报 

         文。 

       •  对具有组播地址的数据报都不发送 ICMP 差错报告报文。 

       •    具有特殊地址   （如127.0.0.0或0O0.0）  的数据报不发送ICMP差错报告报 

         文。 

     • 

       •   ping操作使用的是ICMP回送请求和回答报文 
       •  traceroute操作使用的是ICMP时间超过报文 

 （四）IPv6 

•  1.IPV6的主要特点 

               非正式版本，版权所有，禁止盗印倒卖! 
﻿                     公众号：一大颗牛奶糖 

       • 
          多播。一点对多点通信 

       •  任播。 目的站是一组计算机，只交付其中的一台 
     •  3）IPv6地址表示法 
       •    址中每4位用一个十六进制数表示，并用冒号分隔每 16 位 
       •   16 位域开头有一些0时，采用缩写表示法，域中必须至少有一个数字 
       •     相继的0值域时,  进一步缩写C  用双冒号缩写  加  C  双冒号表示法在一个 

         地址中仅能出现一次 

     •  4）IPv6地址分类 
       •    明地址：16字节的全0地址，缩写为“: :”，  不能用作目的地址，只能为某台 

         主机当作源地址使用 

       •    地址：地址0:0:0:0:0:0:0:1, 可缩写为“::1” 
       •   播地址 
       •  本地链路单播地址：连接网络上的主机都可以和本地地址进行通信，不能和互 

         联网其他主机通信 

       •   球单播地址： 
     •  5）IPV4向IPv6过渡 
       •   协议栈 ：指在一台设备上同时装有 IPv4和 IPv6 协议栈 
       •    技术：将整个IPv6 数据报封装到 IPv4 数据报数据部分，使得 IPv6 数据报 

         可以在IPv4 网络的隧道中传输。 

• （五）路由协议 

  • 1.自治系统 
     • 单一技术管理下的一组路由器，内部使用统一的内部路由选择协议，外部使用AS 之间 

      的路由协议 

  •  2.域内路由与域间路由 
     • 域内路由选择：自治系统内部的路由选择 
     • 域间路由选择：自治系统之间的路由选择 
     •  （同层次路由） 

  •  3.RIP路由协议 
     •  1） 工作原理 
       •  RIP是分布式基于距离向量的路由选择协议 
       •  RIP要求自治系统AS 内的每一个路由器都要维护从它自己到其他每一个网络的 
         距离记录。  （一组距离，称为“距离向量”） 

       •    跳数表示到达 目的网络距离 

                非正式版本，版权所有，禁止盗印倒卖! 
﻿     •  跳数指从源端     目的端    经过的路由器个数,  每经过一个路由器. 

      跳数加1c 

     •    器到直连网络的距离定义为1。 
     • 路由器到非直连网络的距离定义为所经过的路由器数加1。 
     • 团允许一条路行最多只能句含15个路由器c  “距离”等于16时相当于不可认. 
      RIP只适用干小型互联网. 
•  2）基本工作过程 
  •    通告一条新的路由，该路由在本结点的路由表中不存在，本地系统加入这条 

    新路由。 

  •    由器刚开始工作时，只知道自己到直连网络的距离为1 
  •     路由器仅和相邻路由器周期性地交换并更新自己全部路由信息 
  •    路由器 X 发来的RIP报文，先修改报文项 目：把   一跳"字段中地址改为X, 

    并把所有"距离"字段值加 1。 

  •    干次交换和更新后，每个路由器都知道到达本AS内各网络的最短距离和下一 
    跳地址，称为收敛。 
  •     RIP收敛后，每个路由器到每e月标网络的路由都是距离最短的 
•  3）路由条目更新规则          磁广 
  •     了新的网络，添加 
  •    达目的网络，相同下一必 最新消息，更新 
  •    达目的网络，不同下一跳，新路由优势，更新 
  •    达目的网络，不同下一跳，新路由劣势，不更新 
  •     目的网      下一跳，等价负载均衡 
•  4）RIP三个嗝_ 

  • 
        谬信息一¬仅和相邻路由器交换信息 
  •  交换什么信息一一 自己的路由表 
  •  何时交换信息一一周期性交换 

•  5）特点 
  •  仅和相邻路由器交换信息.  相邻表示两个路由器之间不经过另一个路由器 
  •     的信息是当前路由器所知道的全部信息.  即自己现在的路由表 
  •    固定时间间隔交换路由信息 
  •  RIP认为好的路由就是“距离短”的路由，所通过路 由器数量最少的路由 
  •  当到达同一目的网络有多条“距离相等”的路由时，可以进行等价负载均衡 

•  6）缺点 
  • （1）“坏消息传播得慢”： 路由环路或距离无穷计数问题，距离向量算法的固有问题 
  •   RIP限制了网络规模，最大距离15 （16不可达） 
﻿                   公众号：一大颗牛奶糖 

   •      器交换完整路 由表，开销大 
   • 
      •  当路由表发生变化时就立即发送更新报文（即"触发更新）而不仅是周期性 

        发送 

      •    路由器记录收到某特定路由信息的接口，而不让同一路由信息再通过此 
        接口向反方向传送（即“水平分割”） 

•7） RIP报文格式    （了解） 

               首部     路 由部分       路 由信息 

                                   里反,比以 
                                  最多25 个 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿   •  （2）  使用OSPF的每个路由器都会产生链路状态通告LSA。LSA被封装在链路状态 
    更新分组LSU中，采用洪泛法发送通过各路由器洪泛发送封装有自己LSA的LSU分 
    组，各路 由器的LSDB最终将达到一致。LSA中包含 

     •     网络的链路状态信息 
     •  邻居路 由器的链路状态信息 
• 2）OSPF工作原理 
   • 
      路由器建立一个链路状态数据库。实际是全网的拓扑结构图，在全网范围内一 
    致  （链路状态数据库同步）。 

   •  每个路 由器根据全网拓扑结构图，使用Dijkstra最短路径算法计算从自己到各自 

    的网络的最优路径，构造自己的路由表。 

   •  链路状态发生变化，每个路 由器重新计算到各目的网络的最优路径，构造新的 

    路由表 

• 3）OSPF基本特点 
   •  OSPF是基于链路状态的.  采用SPF算法计算路由,  保证不会产生路由环路 
   •  OSPF不限制网络规模，更新效率高，收敛速度快 
   •     OSPF的各路由器进行最短路彳         5十算， 构建出各自到达其他各路由 
                           与名修 
    器的最短路径，即构建各 自的路由表。 
   •     OSPF能够用于规模很大的邈JOSPF把一个 自治系统再划分为若干个更 

    小的范围   （区域） 

     • 划分区域的好处：把利用洪泛法交换链路状态信息的范围局限于每一个区域 
       而不是整个自治系统，这就减少了整个网络上的通信量 

   •     Dijkstra算出完整的最优路径,  但是路由表中不会存储完整路径,  只存 
    储“下一跳”   t0 
   •  可以将通信量分配给好几条路径，实现多路径之间的负载平衡 
   •     交换的分组都有鉴别功能，提高了可靠性 
   •   个状态链路都有一个32位的序号，序号越大，状态就越新 
• 4）OSPF分组类型 

              O 
                       问候 

                       问候 

                      数据库描述 

                      数据庞描沸 
    二十 眼米什 块 加 的自比     1 — 

                      数据库描述 

                      数据库描述 

                     链路状态请求 

     新情况-F的同步        链路状态更新 

                     链路状态确认 

   •     （Hello）分组：发现和尾部邻居路 由器的可达性 
﻿                  公众号：一大颗牛奶糖 

     •    库描述分组：向邻居路由器给出 自己链路状态数据库中所有链路状态项目 

      摘要 

     • 链路状态请求分组：向邻居请求发送链路状态项目 
     • 链路状态更新分组：洪泛法对全网更新链路状态 
     • 链路状态确认分组：对链路更新分组的确认 

  • 5）OSPF分组 （了解） 

     • 版本，1字节 
     • 类型，2字节，五种类型的一种。 
     •    长度，2字节，包括OSPF首部在内的分组长度，以字节为单位。 
     •   由器标识符，标志发送该分组的路由器的接口的IP地址 
     • 区域标识符，分组属于的区域的标识符。 
     •   验和，用来检测分组中的差错。 
     •    类型，0（不用） 和1（口令）。 
     • 鉴别，鉴别类型。时就填入0,   鉴别类型1填入8个字符 口令。 

  • 5）RIP和OSPF的区别 
     •  0OSPF向本自治系统内的所有路由器发送信息.  而RIP只向邻居路由器发送信息 
     • OSPF发送的信息是与本路由器相邻的所有路由器的链路状态，而RIP发送的是 

      整个路由表 

     • OSPF只有当链路状态发生变化时才会发送        而RIP 般每隔30s就交换一次 
                               信息，    一 
      信息 

     • OSPF是网络层协议， 使用IP数据报传送,  RIP是 用层协议， 使用UDP 
•  5.BGP路由协议 

  •  1） 基本概念 
                                                    ， 

     • 在不同 自治系统内，度量路由的“代价”（距离，带宽，费用等）可能不同。对于《4 
      自治系统之间的路由选择，使用“代价”作为度量来寻找最佳路由是不行的。 
                                                /封一 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿   •   治系统之间的路由选择必须考虑相关策略（政治，经济，安全等） 
   •  BGP只能是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子）， 而 

    并非要寻找一条最佳路由 

   •  BGP发言人除了运行BGP外，还必须运行自己所在自治系统所使用的内部网关 

    协议IGP, 例如OSPF或RIP. 

   •  BGP发言人交换网络可达性的信息（要到达某个网络所要经过的一系列 自治系 

    统） 
   •   BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据所采用的 

    策略从收到的路由信息中找出到达各自治系统的较好的路由。也就是构造出树形 
    结构、不存在回路的自治系统连通图。 

   •  BGP 是应用层协议.  它星基于 TCP 的 
                              0 

• 2）特点 
   •  BGP 交换路由信息的结点数量级是 自治系统的数量级，要比这些自治系统中的 

     网络数少很多。 

   •    个自治系统中BGP发言人     （或边界路由戳的数目是很少的。使得自治系统 
                                   * 
    之间的路由选择不致过分复杂。 

   •  BGP支持 QDR, BGP的路由表包有  层 的网络前缀、下一跳路由器，以及到达该 
     目的网络所要经过的各个自治系统F 
   •  在BGP刚运行时，BGP的邻站:      ，整个BGP 路由表. 但以后只需在发牛变化时 

    更新有变化的部分c 对节省网络带宽和减少路由器的处理开销都有好处 C 

• 3）BGP-4四种报文 
   •  OPEN（打开）报文：与相邻的另一个BGP发言人建立关系，使通信初始化。 
   •  UPDATE（更新）报文：用来通告某一路由的信息，以及列出要撤销的多条路由 
   •  KEEPAL（f^酒）报文：用来周期性地证实邻站的连通性。 
   •  NOTIFICATION（通知）报文：用来发送检测到的差错。 

• 4）工作赵 
   •  在配置BGP时，每个自治系统的管理员要选择至少一个路由器作为该自治系统 

    的“BGP发言人” 

   •  不同自治系统BGP发言人交换路由信息，首先建立TCP连接.            （端口号为179） 
     •      TCP连接上交换BGP报文以建立BGP会话 
     •      BGP会话交换路由信息（例如，增加新的路由，或撤销过时的路由， 以 

       及报告出错的情况等） 

     •      TCP连接交换路由信息的两个BGP发言人，彼此称为对方的邻站 

       （neiahbor）或对等站（peer） 

• 5）BGP报文   （了解） 
﻿                     公众号：一大颗牛奶糖 

       • （1）  BGP报文通用首部 （19字节） 
         •     字段，16字节长，鉴别收到的BGP报文。当不使用鉴别时，标记字段 

           要置为全1。 

         •     字段，包括通用首部在内的整个BGP报文以字节为单位的长度，最小 

           值是19,最大值是4096 。 

         •     字段，值为 1到4, 分别对应于上述四种BGP报文中的一种。 
       • （2） OPEN报文 （6个字段） 
         •  版本，1字节； 
         •    自治系统号，2字节，全球唯一的16位号 
         •     时间，2字节 
         •  BGP标识符，4字节，路由器IP地址 
         •    选参数长度，1字节 
         •    选参数 
       • （）3 UPDATE报文 （5个字段） 
         •     行路由长度，2字节，指明下一个字段的长度 
         •  撤销的路由，列出所有要撤销的路由 
         •     属性总长度，2字节，指明下一个字段的长度 
         •     属性，定义在这个报文中增加的路径的属性 
         •     层可达性信息NLRI, 定义发出此报文的网络，包括网络前缀的位数、 

           IP地址前缀。 

       • （）4 KEEPALIVE报文 
         •  19字节长的通用首部 
       • （）5 NOTIFICATION报文 （3个字段） 
         •     代码，1字节 
         •  差错子代码，1字节 
         •     数据，给出有关差错的诊断信息 
• （六）IP组播 

  • L组播的概念： 
     • 1） 基本概念 

                非正式版本，版权所有，禁止盗印倒卖! 
﻿     •   源计算机一次发送的单个分组可以抵达用一个组地址标识的若干目标主机， 

      并被它们正确接收。 

     •    地址标识一组地址。主机可以选择加入或离开一个组，一台主机可同时属 

      于多个组。 

  •2） 过程： 
     •    IGMP协议 （因特网组管理协议） 加入组播组。通知本地网络上的路 由器关 

      于要接收发送给某个组播组的分组的愿望。 

     • 通过扩展路由器的路 由选择和转发功能，在路由器互联的支持硬件组播的网络 

      上面实现因特网组播。 

  •3） 特点： 
     • 主机组播时数据只需发送一次就可发送到所有接收者，减轻网络的负载和发送 

      者的负担。 

     • 组播仅应用干UDP.  TCP是面向连接的协议  （一对一地发送） 。 
     • 组播需要路由器的支持才能实现.  能够运行组播        潞由器称为组播路由 
      算                            > 
•  ZIP组播地址                 妥 
  • 力  组播使用  类地址格式   类卅加          〜           每个 类 
      IP    D      c  D      224.0.0.0 239.255.255.255c D IP 

    地址标志一个组播组、 

  •2） 特点 
     • 组播数据报导    最大        不提供可靠交付C 
     •   播地址只能用于目的地址,  而不能用于源地址C 
     •   组播数据磁伏ICMP差错报文。若在PING命令后面键入组播地址，将永远 
      不会收到啊叫二 
     •    所希丽族地址都可作为组播地址。 
  •3） IP组 
     •   在本局域网上进行硬件组播 
     •   因特网的范围内进行组播。 

•  3JP地址与以太网多播地址 
  •     地址块范围：01-00-5E-00-00-00SIJ01-00-5E-FF-FF-FF 
  •     MAC地址和组播IP地址映射关系不是唯一对应的,  32位 IP组播地址可以变化的 

    28位中只映射其中23位,  剩下5位自由变化的 

  •  过程: 
﻿                         公众号：一大颗牛奶糖 

                  D 类 
                     1110 
                  IP 地址  士’ 

        oooo'oooi oooo'ooob dioi'iiio d 
               I 1 1 I  1 I I 1 I 1 I I 1 I I 

            表示多播            r  最低 23 位来自 D 类 IP 地址  一 
                                              一 
                       48 位以太网地址 

              图 4-54 D 类 IP 地址与 以太网多播地址的映射关系 

      • 组播地址为 224.215.145.230, 二进制11100000. 11010111. 10010001.11100110, 只 

        映射 IP地址后23位，即1010111. 10010001. 11100110十六进制为 57-91-E6,   在前 
        面加上固定首部01-00-5E 。结果是 01-00-5E-57-91-E6o 

 （七）移动IP 

•  1.移动IP的概念 

   •  1）  概念 
      •     动结点以固定的网络IP地址实现跨越不同网段的漫游，并保证基于网络IP 的 

        网络权限在漫游过程中不发生改变 

      •       IP 中，每个移动结点都有一个唯一的本地地址， 当移动结点移动时，本地 
        地址是不变的，本地代理维护当前的位置信息 

   • 2）  目标 
      •       组自动地投递给移动结点。把其连接点从一个网络或子网改变到另一个网 

        络或子网的主机。 

      •     个移动结点可以在不改变其 IP 地址的情况下改变其驻留位置。 

   • 3） 功能 
      •       结点：具有永久IP地址的移动结点 
      •       代理：在归属网络       （本应该在的网络） 中代表移动结点办事，把数据转交 

        给移动结点的实体 

      •       代理：在外部网络中帮助移动结点完成移动管理功能的实体 
   • 4）移动IP与动态IP 
      • 动态IP指局域网中的计算机可以通过网络中的DHCP服务器动态地获得一个IP地 
        址，不需要用户在计算机的网络设置中指定IP地址 

• 2.移动IP的通信过程 
   • 1） 当移动结点得到一个新的转交地址时，通过绑定向本地代理进行注册，以便让本 
     地代理即时了解移动结点的当前位置。 

      •     动节点在本地网时，按TCP方式进行通信 
                                                                        ， 

      •     动节点漫游到外地网络时，仍使用固定的 IP 地址进行通信。移动节点需要叙 
        本地代理注册当前的位置地址，这个位置地址就是转交地址。移动 IP 的转交修 
        可是外部代理的地址或动态配置的一个地址。                                      / 

                   非正式版本，版权所有，禁止盗印倒卖! 
﻿  •     代理接收来自转交地址的注册后，会构建一条通向转交地址的隧道，将截 

    获的发给移动节点的 IP 分组通过隧道送到转交地址处。 

  •    转交地址处解除隧道封装，恢复出原始的 IP 分组，最后送到移动节点，这样 

    移动节点在外网就能够收到这些送给它的 IP 分组了。 

  •  移动节点在外网通过外网的路由器或者外代理向通信对端发送 IP 数据报。 
  •     节点来到另一外网，只需要向本地代理更新注册的转交地址，就继续通 

    信。 

  •  当移动节点回到本地网时，移动节点向本地代理注销转交地址，移动节点将使 

    用传统的 TCP/IP 方式进行通信。 

•   移动IP为移动主机设置两个IP地址,  主地址和辅地址    （转交地址）  移动主机在 
  2）                                      。 
  本地网时，使用的是主地址     当移动到另一网络时.  需要辅助的临时地址,  主地址仍 
                  。 

  然保持不变c  当从外网移回本地网时. 辅地址改变或撤销.  主地址保持不变C 

• 1）本质 

• 2） 任务 
  •    接不同的网络  （连接异构网络） 并完成路由转发。在多个逻辑网络       （即多个 

    广播域）互联时必须使用路由器C 

  •     由器某输入端      分组.  按照分组要去的目的地. 把网络从合适输出端 

    口转发给下一跳路由器 

• 3） 过程 
  •  源主机向目标主机发送数据报时，路 由器先检查源主机与 目标主机是否连接在 
    同一个    上。 

  •  如黄矗一个网络上，直接交付而无须通过路由器。如果不在同一个网络上， 
    路由器按照转发表   （路由表）指出的路由将数据报转发给下一个路由器，这称为 
    间接交付。 

  •     一个网络中传涕数据无须路由器的参与， 而跨网络通信必须通过路由器讲 

    行转发c  路由器隔离了广播域C 

• 4） 结构 
﻿                   公众号：一大颗牛奶糖 

                 路由选择处理器 
                                  路由 
                 I路由选择协议 I        选择 

                           输出 

          输入端口              输 出端口 

                  交换结构 

     •    由选择部分，控制部分 
       • 核心构件是路由选择处理机。路由选择处理机根据路由选择协议构造出路由 

         表，经常或定期地和相邻路由器交换路由信息而不断更新和维护路由表。 

     •    组转发部分：交换结构、一组输入端 口和一组输出端口。 
       •  输入端 口在从物理层接收到的比特流中提取出数据链路层帧，从帧中提取 

         出网络层数据报，输出端 口执行相反的操作。 

       •     结构是路由器的关键部件，根据转发表对分组进行处理，将某个输入 

         端 口进入的分组从一个合适的输出端 口转发出去。交换结构本身就是一个网 
         络。 

       •     的交换方法：通过存储器进行交换、通过总线进行交换和通过互联网 

         络进行交换。 

  • 5） 功能: 
     •     选择。  （确定哪一条路径） 
       •  根据特定的路由选择协议构造出路 由表，同时经常或定期地和相邻路由器 

         交换路由信息而不断地更新和维护路由表。 

       •  指按照复杂的分布式算法，根据从各相邻路由器所得到的关于整个网络拓 

         扑的变化情况，动态地改变所选择的路由。 

     •     转发。  （当一个分组到达时所采取的动作） 
       •  处理通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管 

         理和任务调度等。 

       •    路由器根据转发表将用户的IP 数据报从合适的端口转发出去。 
  • 6） 路由器和网桥的重要区别 
     • 网桥与高层协议无关，而路 由器是面向协议的，它依据网络地址进行操作，并进 

      行路径选择、分段、帧格式转换、对数据报的生存时间和流量进行控制等。 

• 2.路由表与路 由转发 
  • 1） 标准的路由表有4个项目:  目的网络IP地址、 子网掩码、 下一跳IP地址、 搭6 
     • 可用默认路由代替所有具有相同“下一跳”的项目，并将默认路由设置得比其姊 
       目的优先级低，                                     广 

              非正式版本，版权所有，禁止盗印倒卖! 
﻿       • 2） 转发和路由选择的区别： 
         • “转发”是路由器根据转发表把收到的IP数据报从合适的端口转发出去，仅涉及 

          一个路由器。 

         • “路由选择”涉及多个路由器，路由表是许多路由器协同工作的结果。路 由器按 
          照路由算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变 
          所选择的路由，并由此构造出整个路 由表。 

         •   由表用软件来实现；转发表用软件来实现. 也可用特殊的硬件来实现 
         •   由表是根据路由选择算法得出的, 转发表是从路由表得出的C 

       • 3）工作流程 

              输入端口的处理         输出端口的处理 

         • 路由器从线路上接收分组，讲行物理层处理      （讲行比特的接收） 、 数据链路层 

          处理  （剥去帧头、帧层  得到了IP数据报）、 分组被送入网络层模块 

         •   接收的分组是路由器之间交换路由信息的分组，则把这种分组送交路 由器的 

          路由选择部分中的路由选择处理器。 

         •   接收的是数据分组，则按照分组首部中的目的地址查找转发表，根据得到的 

          结果，分组就经过交换结构到达合适的输出端口。 

         •    个分组正在查找转发表时，紧跟着从这个输入端 口收到另一个分组，这个 
          分组必须在队列中排队，产全一定时延 
         •    结构传送过来的分组先进行缓存，数据链路层处理模块将给分组加上数据 
          链路层的首部和尾部，交给物理层后发送到外部线路 

•五、传输层          后 
  • （-）传输层提模的服务 

    •  1.传输层的功能 

       •  1）通信和信息处理 
         •    层向应用层提供通信服务,  是面向通信部分最高层、 是用户功能中最低 

          层C 

         •  传输层为运行在不同主机上的进程之间提供了逻辑通信,  而网络层提供主机之 

          间的逻辑通信。 

         •  “两台中福力间的通信”实际上是两台主机中的应用进程之间的通信.  进程之间 

          通信称端到端注辑诵信C 

       • 2）复用和分用 
         •    指发送方不同的应用进程都可使用同一个传输层协议传送数据 
﻿                  公众号：一大颗牛奶糖 

    •    用是指接收方的传输层在剥去报文的首部后能够把这些数据正确交付到目的 

      应用进程。 

  • 3） 差错检测 
    •   传输层对收到的报文进行差错检测    （首部和数据部分）。网络层只检查 IP 数 
      据报的首部，不检验数据部分是否出错。 

    •    使网络层协议不可靠   （网络层协议使分组丢失、混乱或重复）.  传输层同样 

      能为应用程序提供可靠的服务C 

  • 4） 提供两种不同的传输协议 
    • 面向连接的 TCP和无连接的 UDP。而网络层无法同时实现两种协议     （只提供面向 
      连接的服务，如虚电路；or, 只提供无连接服务，如数据报）。 

  • 5） 为高层用户屏蔽低层网络核心细节 
    •   它使应用进程看见的是好像在两个传输层实体之间有一条端到端的逻辑通信信 
      道，这条逻辑通信信道对上层的表现却因传输层协议不同而有很大的差别。 

    •     输层采用面向连接的 TCP时. 尽管下面的网络是不可靠的     （只提供尽最大 
      努力的服务）.  但i文种涉辑通信信道就相当干一条全双工的可靠信道C 

    •   当传输层采用无连接的 UDP 时. 这种逻辑通信信道仍然是一条不可靠信道。 
  • 6） 为进程提供逻辑通信 
    • 网络的边缘部分的两台主机使用网络核心部分的功能进行端到端的通信时，只有 

      主机的协议栈才有传输层和应用层，而路由器在转发分组时都只用到下三层的功 
      能 （即在通信子网中没有传输层，传输层只存在于通信子 网以外的主机中）。 

•  2.传输层寻址与端口 
  • 1）  端口 
    •  概念： 
       • 端口能够让应用层的各种应用进程将其数据通过端口向下交付给传输层，以 

             非正式版本，版权所有，禁止盗印倒卖! 
﻿     •       传输层服务访问点    （TSAP） IP 地址和MAC 地址标识的是主机，端口 
                              . 

       标识的易主机中的应用讲程C 

     •  数据链路层的SAP是 MAC地址,  网络层的SAP是IP地址， 传输层的SAP是端口行 
     •  硬件端    不同硬件设备进行交互的接口，软件端口是应用层的各种协议进程 

       与传输实体进行层间交互的一种地址。传输层使用的是软件端口。 

  • 2）端口号 

                                                    1 
     •     进程通过端口号进行标识，端口号长度为16bit       能够表示65536 2  个 
                                       、           （ 6） 
       不同的端 

     •  端口号只具有本地意义、即端口号只标识本计算机应用层中的各进程，不同计 
       算机的相同端口号是没有联系的。 

     •  （3）根据端口号范围可将端口分为两类： 
       •      器端使用的端      又分两类， 
          •  a.熟知端口号，数值为0~1023, 端口号指派给了 TCP/IP 最重要的一些应 
            用程序 

            b.登记端口号，数值为 1024〜 49151 供没有熟知端     应用程序使用 
                                 。 
          • 
            的，使用这类端      须登记， 以防止重复。 

       • 
            户端使用的端 口号，数值为49152 〜 65535 仅在客户进程运行时才动态 
                                     。 
         地选择，又称短暂端       （也称临时端口）。通信结束后，刚用过的客户端 
             复存在 
                           ） 
  • 3）套接字             / 

       的不同应用      夕 • 
              进学） 
     •  端口号拼接到 IP 地址即构成套接字 Socket  采用发送方和接收方的套接字来 
                                  。 
       识别端点。 

     •     字实际上是一个通信端点，唯一地标识网络中的一台主机和其上的一个应 
       用      八 套接字Socket 二 （尸地址: 端 
         加才 
     •     A 发给主机 B 的报文段包含目的端口号和源端口号，源端口号是“返回地 
       址”的一部分，即当B需要发回一个报文段给A 时，B到A 的报文段中的 目的端 
       便是A到B的报文段中的源端口号     （完全的返回地址是A 的IP 地址和源端口号）。 

•  3,无连接服务与面向连接服务 

  •  1） 面向连接服务 
     .通信双方通信之前，必须先建立连搭,  通信过程整个连接情况一直被实时地监控 
       和管理c  通信结束后，释放连接。 

  • 2）无连接服务 
     • 两个实体之间的通信不需要先建立好连接，需要通信时，直接将信息发送到"网 

       络"中，让该信息的传递在网上尽力而为地往 目的地传送。 

  • 3）TCP/IP 协议族IP层之上使用协议 
﻿   图 5-3 TCP/IP 体系中的运输层协议 

   • 面向连接的传输控制协议              , 采用TCP时,  传输层向上提供的是一条全双工 
                         （TCP） 
     的可靠谡辑信道; 

   • 无连接的用户数据报协议               , 采用UDP 时，传输层向上提供的是一条不可 
                         （UDP） 
     靠的逻辑信道C 

•  4）TCP特点 
   •   TCP提供面向连援可靠传输的服务.          TCP不提供广播或组播服务。 
   •      了许多开销，如确认、流量控制、计时器及连接管理等。使协议数据单元 

     的头部增大很多， 占用更多处理机资源。 

   •   TCP主要适用于可靠性更重要的场合，如文件传输协议                 （FTP） 超文本传输协 
                                                      、 
     议  （HTTP）、远程登录     （TELNET）等。 

•  5） UDP特点 
   •   UDP是一个无连接的非可靠传输层协议             它在IP之上仅提供两个附加服务:         多 
                                    。 

     路复用和对数据的错误检查。IP知道怎样把分组投递给一台主机，但不知道怎样 
     把它们投递给主机上的具体应用。 

   •   UDP在传送数据之前不需要先建立连接,  远程主机的主输层收到UDP报文后， 

     不需要给出任何确认C 

   •      速度比较快、实时性好。 
   •      UDP的应用主要包括小文件传送协议            （TFTP） DNS、SNMP和实时传输 
                                             、 
     协议   （RTP）。 
• 6) TCP和UDP区另!1 

       UDP          TCP         应用        应用层协议     运输层协议 
       无连接         面 向连接     名字转换     DNS （域名系统）     UDP 
   支持一对    一对多               文件传送     TFTP （简单文件传送协议） UDP 
         、 
        一 
   、 多对一和多对多通   每条TCP 只有两个端  路由选择怖议   R1P （路由信息协议）   UDP 
        信        点，只能一对一     IP 地址配置  DHCP （动态主机配置协议） UDP 

   对应用层交付的报文                 网络管理     SNMP （简单网络管理协议） UDP 
      直接打包        面向字节流      远程文件服务器  NFS  （网络文件系统）  UDP 
   尽最 大努力 交付，不               IP  电话   专用协议           UDP 
   可靠；不使用 流量控   可靠传输，使 用流量   流式多媒体通信  专用协议           UDP 
     制和拥 塞控制     控制和拥塞控制     多播       IGMP （网际组管理协议） UDP 

   首部开销小，仅8字                 电子邮件     SMTP （简单邮件传送协议） TCP 
        节       首部范围20-60字节  远程终端接入   TELNET  （远程终端协议） TCP 
               报 文段头 部长，传输   万维网      HTTP （超文本传送协议） TCP 
  传输开销小，时延短    开销大           文件传送     FTP （文件传送协议）   TCP 

•  7） IP数据报和UDP数据报的区别: 
﻿          图 5-3 UDP 数据报与 IP 数据报的关系 

      IP 数据报在网络层要经过路由的存储转发； 而UDP数据报在传输层的端到端的逻 
    ・ 
      辑信道中传输，封装成IP 数据报在网络层传输时，UDP数据报的信息对路由是不 
      可见的。 

  • 8) TCP和网络层虚电路的区别： 
    •   TCP报文段在传输层抽象的逻辑信道中传输，对路由器不可见；虚电路所经过 

      的交换结点都必须保存虚电路状态信息。 

    •    网络层若采用虚申路方式,  则无法提供无连接服务; 而传输层采用 TCP不影 

      响网络层提供无连接服务。 
                                 ' 
 (二) UDP协议               嗓0 

• LUDP数据报 
  •  1) UDP概述       / 
    • 
       • UDP仅在沪 的数据报服务之上增加了两个最基本的服务；复用和分用以及差 

        错检平 
    •优 
            一 
         ，更 /yV- 
       • NUDP无须建立连播c  不引入建立连接的时延。 
       •    接状态c  UDP不维护连接状态，也不跟踪参数。 
       •   组首部开销小     仅有  的开销 
                   。UDP  8B   6 

       •  应用层能更好地控制要发送的数据和发送时间。UDP 没有拥塞控制，网络 

        中的拥塞不会影响主机的发送效率。 

       •    支持一对    一对多、 多对一和多对多的交互通信 
          UDP    一、                     行 

    • 
       •    不保证可靠交付,  所有维护可靠性工作可由用户在应用层来完成       应 
        0UDP                                    。 
        用开发者可根据应用的需求来灵活设计自己的可靠性机制。 

       •  UDP是面向报文的c 
         • •应用层交给UDP多长的报文,  UDP照样发送,  一次发送一个报文；接收 

           方UDP对IP层交上来 UDP数据报，在去除首部后就原封不动地交付给上层 
           应用进程，一次交付一个完整的报文。 
﻿          • •报文不可分割,  是UDP数据报处理的最小单位c 应用程序选择合适大小 

           的报文，若报文太长，UDP把它交给 IP层后，可能会导致分片；若报文太 
           短，UDP把它交给IP层后，会使 IP 数据报的首部的相对长度太大 

       •  UDP没有拥塞控制,  UDP 常用于一次性传输较少数据的网络应用，如 

         DNS、SNMP 等，允许在网络发生拥塞时丢失一些数据，不允许太大时延 

  • 2） UDP首部格式 

     ・ UDP数据报包含两部分：UDP首部和用户数据。UDP首部有8B.     由4 个字段组成, 

       每个字段的长唐都是2B 

     •     口号。对方回信时选用，不需要时可用全 0。 
     •  口号。终点交付报文时使用。 
     •  长度。UDP 数据报的长度   （包括首部和数据），最小值是8     （仅首部）。 
     •  校验和。检测 UDP数据报在传输中是否有错。该字段可选，不想计算校验和时 
      该字段为全 0 。 

•  ZUDP校验 
  •    首部：计算校验和要在UDP数据报之前增加 12B的伪首部，伪首部并不是真正首 

    部。伪首部既不向下传送又不向上涕交.  只是临时添加在 UDP数据报的前面 
                                                  。 

  •   伪首部包括源 IP地址字段、目的IP地址字段、全。字段、协议字段        （UDP固定为 
    17） 、UDP长度字段。 
  •   IP数据报的校验和只检验IP 数据报的首部， UDP 的校验和检杳首部和数据部分. 

    通过伪首部，可以检查源端口号、目的端口号、UDP数据部分、IP数据报的源地址和 
    目的地址。 

  •  （4）校验步骤 
﻿                                10011001 00010011  — 153.19 
                   153.19.8.104 00001000 01101000 8.104 
         12B 
                                           — 
        伪首部        171.3.14.11  10101011 00000011  — 171.3 
               全0  17    15     00001110 00001011  — 14.11 
         8B      1087    13     00000000 00010001  — 0和17 
       UDP首部     15      全0     00000000 00001 1 1 1 — 15 
         7B    数据  数据  数据 数据    00000100 00111111  — 1087 
         数据    数据  数据  数据 全0    00000000 00001101  — 13 
                                00000000 00001111 * 15 
                          / 
                                           — 
                         填充     00000000 00000000  — 0（校验和） 
                                01010100 01000101  — 数据 
                                01010011 01010100  — 数据 
                                01001001 01001110 —* 数据 
                                01000111 00000000 数据和0（填充） 

                 按二进制反码运算求和     10010110 11101011 — 求和得出的结果 
                  将得出 的结果求反码    01101001 00010100 校验和 

       •      送方首先把全零放入校验和字段并添加伪首部，把UDP 数据报视为许多 16 

          位的字串接起来。 

       •      UDP数据报的数据部分不是偶数个字节，则要在数据部分末尾填入一个全零 
          字节   （此字节不发送）。 

       •        进制反码计算出这些16位字的和，将此和的二进制反码写入校验和字段， 

          并发送。 

       •      收方把收到的 UDP 数据报加上伪首部                便蔚为偶数个字节，那么还需要补 
          上全零字节） 后，按二进制反码求这些16  学的和。 
       •        差错时其结果应为全1, 否则就表明有差错出现，接收方就应该丢弃这个 

          UDP 数据报。 

    •  （5）UDP的校验和不是必需的, 如果不使用校验和,  那么将校验和字段设置为0.                              而如 
      果校验和的廿           赢好为           么以校验禾口詈为全1n 
 （三）TCP协议 
•  LTCP特点           ☆既 

    • 1） TCP 传送的数据单元称为报文段。TCP报文段既可以用来运载数据,  又可以用来建 

      立淬接、释放连接和应答c 

    •     TCP是面向连接的运输层协议              应用程序在使用TCP协议                 必须先建立TCP连 
      2）                            。                       之前， 
      接，传送完毕后，必须释放。 

    •     TCP提供可靠交付的服务            数据无差错、不丢失、不重复、按需到达。 
      3）                        。 
    •     TCP提供全双工通信          通信双方任何时候都能发送数据，两段都有发送缓存和接 
      4）                    。 
      收缓存。 

    •    面向字节流        应用程序和TCP交互一次一个数                    TCP把应用程序交下来的数据 
      5）            。                              据块， 
      仅仅看成一连串无结构的字节流。 

•  2.TCPE殳 
﻿                32位 

•  1） 一个 TCP报文段分为首部和数据两部分，整个 TCP报文段作为 IP数据报的数据部 
  分封装在 IP数据报中。 首部前20B固定. 后面4n字节根据需要增加的选项.  TCP中E文 

  段的首部最短为 20B, 

•  2）字段意义 
   •  源端口和目的端口。各占2B。端 口是运输层与应用层的服务接口，运输层的复 

     用和分用功能都要通过端口实现。 

   •  序号。 占4B,  范围为 0~232一 1,  共232个序号。TCP是面向字节流的   （逐个字节 

     传     TCP连播传送的字节流中的每个字节都按顺序编号            序号字段的值指的 
      送），                                    。 
     是本报文段所发送的数据的第一个字节的序号 
                                    C 

     • •例，报文段序号字段值是 301,      而携带的数据共有 100B,   本报文段数据的最 

       后一个字节序号是400,     下一个报文段的数据序号应从 401 开始。 

   •    认号。占4B,  期望收到对方下一个报文段第一个数据字节的序号。若确认号 

     为M  则表明到序号 N-1为止的所有数据都已正确收到。 

     • •例，B正确收到A发送报文段，序号字段是501,         数据长度是200B   （序号 

       501~700）, 表明B正确收到了A发送的到序号700为止的数据。B期望收到A的 

       下一个数据序号是701,     B把确认号置为701。 

   •    据偏移（首部长度）。 占4bit,  表示首部长度，指出 TCP报文段的数据起始处距 

     离TCP报文段的起始处有多远。”数据偏移”单位是4B计算单位。当此字段的值为 

     15 时，达到 TCP 首部的最大长度 60B 。 

   •  保留。占6bit,  保留为今后使用， 目前应置为 0 。 
   •  紧急位URG。Ibit,  URG=1时，表明紧急指针字段有效。告诉系统此报文段中 

     有紧急数据，应尽快传送       （高优先级数据）。但 URG 需要和紧急指针配合使用、 

     即数据从第一个字节到紧急指针所指字节就是紧急数据。 

   •  确认位ACK   lbit, 仅当    时确认号字段才有效      当ACK=0   确认号无 
              。       ACK=1              。      时， 
     效。连接建立后所有传送的报文段 ACK 置 1。 

   •  推送位         。Ibit, 接收方TCP收到 PSH=1 的报文段，尽快地交付给接收 
           PSH（Push） 
     应用进程，不再等到整个缓存都填满后再向上交付。 

   •  复位位         。Ibit, RST=1时，表明 TCP连接中出现严重差错，必须释放 
           RST（Reset） 
     连接，再重新建立运输连接。 

   •   同步位SYN 。lbit, 同步SYN=1表示这是一个连接请求或连接接受报文。苴 
     SYN二L ACK=O时，表明这是一个连接请求报文，对方若同意建立淬接， 
     ―                                               则应瞬 
     应报文中使用SYN=L ACK=L                                 芳 
﻿     •  终止位       。lbit,  用来释放一个连接。当 FIN = 1时，表明发送方的数据 
            FIN（Finish） 
       已发送完毕，并要求释放传输连接。 

                       电 
     •  窗口。占2B, 范围为 0~2 1。指出现在允许对方发送的数据量，接收方的数 
      据缓存空间是有限的，窗口值作为接收方让发送方设置其发送窗              依据「窗口 
      值动态变化。 

       • •例，确认号是701, 窗口字段是1000。表明从701号算起，发送此报文段的一 

         方还有接收 1000 字节数据 （字节序号为 701〜 1700）  的接收缓存空间。 

     •   验和。 占2B  校验和字段检验的范围句括首部和数据两部分         在计算校验和 
                 。                           。 
       时. 在TCP报文段的前面加上12B的伪首部。 

     •     指针。占2B。仅在 URG=1时才有意义，它指出在本报文段中紧急数据共有 

       多少字节 

     •  选项。长度可变。最长可达40B,    没有“选项”时，TCP首部长度为20B 。最大报 
      文段长度MSS是TCP报文段中的数据字段的最大长度 ，权仅是数据字段）。 
     . 填充。使整个首部长唐昌48 的整数倍。 

•  3.TCP连接管理 

  •  1）  相关概念 
     •  TCP 是面向连接的协议，每个TCP 连接都有三个阶段：连接建立、数据传送和 

      连接释放。 

     •  TCP 连接的管理是使运输连接的建立和释放都能正常进行。 
     •  TCP把连接作为最基本的抽象，每条TCP连接有两个端点，TCP 连接的端点不是 
      主机，不是主机的IP地址，不是应用进程，也不是传输层的协议端口。TCP连寺妾 
       的端   为套厚声jsocket）或插口. 每条 TCP连接唯一地被通信的两个端点 
       烟7两个套拷攵篇宅， 
     •     连接的建立采用客户/服务器方式      主动发起连接建立的应用进程 
        TCP                   行                  称为客 
      户，而被动等待连接建立的应用进程称为服务器。 

     •  TCP连格是一条虑连接   （逻辑淬接）.  而不是一条真正的物理淬接。 
  • 2）连接的建立 
     •    决问题 
       •  要使每一方能够确知对方的存在。 
       •     许双方协商一些参数    （如最大窗 口值、是否使用窗      大选项、时间 

         戳选项及服务质量等） 

       •  能够对运输实体资源    （如缓存大小、连接表 中的项目等）进行分配。 
     •    次握手 
﻿   •  客户机TCP 向服务器 TCP发送连接请求报文段。首部同步位SYN=1,        选择初 
    始序号seq=x 。SYN报文段不能携带数据,     但要消耗掉一个序号。TCP客户进 
    程进入 SYN-SENT （同步已发送） 状态。 

   •  服务器TCP 收到连接请求后，如同意，则向客户机发回确认，并为该TCP 

    连接分配缓存和变量。确认报文段中,  SYN=1,      ACK=1, 确认号ack=x+l, 选 
    择初始序号scq=y 。确认报文段不能携带数据,       但也要消耗掉一个序号。TCP 

    服务器进程进入 SYN-RCVD   （同步收到） 状态。 

   •  客户机收到确认报文段后，向服务器给出确认，并为该TCP连接分配缓存 
    和变量。确认报文段ACK=1,    确认号ack二y+1, 序号seq=x+l 。报文段可携带数 

     据.  若不携带数据则不消耗序号、 TCP客户进程进入ESTABLISHED     （已建立连 

    接） 状态。 

•  （3）Notes 
   •  TCP提供的是全双工通信.  因通信双方的应用进程在任何时候都能发送数 

    据。 

   •  服务器端的咨源是在完成第二次握手时分配的.  而客户端的资源是在完成 

    第三次握手时分配的、 服务器易于受到 SYN 洪泛攻击。 

•   如果把“三次握手”改成“两次握手”， 就可能发生死锁。 

            主机A               主机B 
            白                  H 

    等待连接确认，认     _ SYN,ACK,SEQ=y, ACK=x+l 确认, 认为 
    为连接尚未建立 程行                  连接 已建立 

    怎么还不是连接确         死锁         开始发送数据。 
   认呢？难道没收到                     由于未收到确 
    我的连接请求？                     认，再重发！ 

   •     A给B发送请求分组，B收到了这个分组，并发送了确认应答分组。按 
     照“两次握手”，  B认为连接已经建立，可以开始发送数据分组。 

   •  A在B的应答分组在传输中被丢失的情况下，将不知道B是否已准备好，也 
                                                       《 
    不知道B发送数据使用的初始序列号，A  甚至怀疑B是否收到自己的连接请求首 
    分组。                                           /声 
﻿     •  最后一次等待2MAL 
       •     A发送的最后一个确认报文段能够到达B。如果A 不等待2MSL,     A 返回 
         的最后确认报文段丢失，B不能进入正常关闭状态，而A此时已经关闭，也不 
         可能再重传 

       •    止出现“已失效的连接请求报文段”。 A在发送完最后一个确认报文段后, 

         经过 2MSL 可保证本连接持续的时间内所产生的所有报文段从网络中消失。 

• 4.TCP可靠传输 

  •  1) 概念 

        TCP的任务易在下层不可靠的、尽力而为服务的基础上建立一种可靠数据传输 

      版务c 

        TCP程供的可靠数据传输服条 保证接收方讲程从缓存区读出的字节流与发送方 

      发出的字节流完全一样。TCP使用了校验、序号、确认和重传等机制来达到这一 

       目的。 

  • 2) 序号 

        TCP首部的序号字段用来保证数据能有序提交给应用层，TCP 把数据视为一个 
      无结构但有序的字节流，序号建立在传送的字节流之上          不建立在报文段之上C 

        TCP淬接传送的数据流中的每个字节都编上一个序号        序号字段的值是指本报 
                                       。 

      文段所发送的数据的第一个字节的序号。 

  • 3) 确认 

        TCP首部的确认号是期望收到对方的下一个报文段的数据的第一个字节的序 

      号。 

        TCP默认使用累计确认， TCP 只确认数据流中至第一个丢失字节为止的字节 

  • 4) 重传 

         0 TCP每发送一个报文段.就对这个报文段设置一次计时器        计时器设置的 
                                            。 
       • 
         重传时间到期但还未收到确认时，就要重传2文一报文段. 
       •  TCP 采用一种 自适应算法，记录一个报文段发出的时间，以及收到相应确 
         认的时间，两个时间之差为报文段的往返时间RTT。 

       •  TCP保留了RTT的一个加权平均往返时间RTTs,   它会随新测量RTT 样本值的 

         变化而变化。超时计时器设置的超时重传时间        （RTO） 应略大于RTTs 

        冗余ACK 

       •     ACK：  再次确认某个报文段的ACK, 而发送方先前已经收到过该报文 

         段的确认。 

       •   TCP规定每当比期望序号大的失序报文段到达时.就发送一个冗余ACK.        指 
         B月下一个期待字节的序号。                               ? 
       •     送方收到对同一个报文段的3个冗余 ACK 时，就认为被确认报文谈瘴 
         的报文段已经丢失。立即对报文执行重传，这种技术通常称为快速重修 
﻿• 5.TCP流量控制 

  •  1) 相关概念 

          控制：通信过程中，接收方会根据自己的缓存大小来动态调整发送方的发 
      送窗口大小，调整方式就是通过确认报文首部的窗口字段告诉发送端 

         收窗口rwnd： 接收方根据自己接收缓存的大小，动态地调整发送方的发送窗 

         塞窗口cwnd： 发送方根据其对 当前网络拥塞程度的估计而确定的窗口值 

       TCP提供流量控制服务来消除发送方    （发送速率太快） 使接收方缓存区溢出的 
      可能性，流量控制是一个速度匹配服务     （匹配发送方的发送速率与接收方的读取 
      速率）。 

  • 2)    和              区别 

       传输层定义端到端用户之间的流量控制，数据链         定义两个中间的相邻结点 
      的流量控制。 

        数据链路层的滑动窗      的窗口大小不        ，传输层的则可以动态变 
      化                     没 
  • 3) 持续计时器、零窗 口探测报文段 公六 

       TCP 每个连接设有持续计时器。只要TCP连接的一方收到对方的零窗口通知， 
      就启动持续计时器。 

       若持续计时器设置的时间到期     就发送一个零窗      报文段  （仅携带1B的数 
                        ， 
      据）.  对方就在确认2文个探测报文段时给出了现在的窗      C 

              是零，呗  收到这个报文段的一方就重新设置持续计时器。若窗口不 
      是零，则死锁的僵局就可以打破了。 

  • 4) TCP报文单曜缸标 
       TCP维/*变量，等于最大报文段长度      （MSS） 。只要缓存中存放的数据达 
      到M击字节时，就组装成一个TCP报文段发送出去。 

        由发送方的应用进程指明要求发送报文段，即TCP支持的推送（push）操作 

          方的一个计时器期限到了，就把当前已有的缓存数据装入报文段（长度不 
      能超过MSS）发送出去 

  6.TCP拥塞控制 

  •  1） 基本概念 

            拥塞控制所起的作用 
﻿  •   在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网 

    络性能变坏¬一产生拥塞。 

  •     资源拥塞的条件是：对资源需求的总和〉可用资源 
  •   若网络中产生拥塞，网络的性能就要明显变坏，整个网络的吞吐量将随输入负 

    荷的增大而下降。 

  •   发送窗    上限值应取接收窗Drwnd 和拥塞窗       中较小的一个,  即发送 
    窗     限彳直 =min「rwnd,cwndl 

•  2） 拥塞控制与流量控制对比 
  •    塞控制使网络能够承受现有的网络负荷，是一个全局性、动态的过程、 涉及 

    所有的主机、所有的路由器以及与降低网络传输性能有关的所有因素C 

  •   流量控制指在端到端力间点对点诵信量的控制        流量控制要抑制发送端发送数 
                                 c 

    据的速率，使接收端来得及接收。 

  •   流量控制中.  发送方发送数据的量由播收方决定; 拥塞控制中， 由发送方自己 

    通过检测网络状况来决定C 

  •     不够大可能造成分组丢失。分组丢失是网络发生拥塞的征兆而不是原因。 
  •    许多情况下，拥塞控制本身会成为引起网络性能恶化甚至发生死锁的原因 
•  3） 拥塞控制分类 
  • 1） 开环控制：在设计网络时事先将有关发生拥塞的因素考虑周到，力求网络在 
    工作时不产生拥塞。 

  •  2）  闭环控制：基于反馈环路。 
     •   测网络系统以便检测到拥塞在何时、何处发生。 
     •     塞发生的信息传送到可采取行动的地方。 
     •  调整网络系统的运行以解决出现的问题。 
•  4） 慢开始算法的原理 
  •     刚开始发送报文段时先设置拥塞窗             即设置为一个最大报文段 

    长度 MSS 的数值。 

     • 每收到1个对新的报文段的确认后，将拥寨窗         1, 而第二次收到2个确认， 

      第三次会收到4个确认，依此类推，可以知道每经过一个传输轮次，拥悬窗口 

      就加倍 
﻿              发送方每收到一个对新报文段的确认 
              （重传的不算在内）就使cwnd加 1 

             图 5-15 每经过一个传输轮次，拥塞窗 口加倍 

  •     到一个对新报文段的确认，将拥塞窗口加1, 每经过一个RTT, cwnd 就会 

    加倍，cwnd 大小指数式增长。 

  •   慢开始一直把 cwnd增大到一个规定的慢开始门限 sstresh  （阈值），改用拥塞 
    避免算法。                   区产' 
•5） 拥塞避免算法的原理           女H 
  • Q）慢开始门限ssthresh：防止拥塞窗 口增长引起网络阻塞 
     •  当cwndvsstresh 时.  《吏用慢开女台算法c 
     •   cwnd>ssthresh 时,  停止使用慢开始算法,  改用拥塞避免算法。 
     •   cwnd=ssthresh 时. 既可使用慢开始算法， 也可拥塞避免算法。 
  •   拥塞避      法:. 
          免算期 
     • 发送端的拥塞窗 口cwnd每经过一个往返时延 RTT 就增加一个 MSS 的大小， 

      亲取为按线性规律增长c 

     •  出现一次超时  （网络拥塞） ,就把慢开始门限值ssthresh 设置为当前的拥 
      塞窗    的一半  （但不能小于2）, 把拥塞窗口cwnd 重新设置为L  执行慢 
      开始算法   当网络频繁出现拥塞时,  ssthresh 值就下降得很快，以减少注入 
            。 

      到网络中的分组数。 

     •  目的是要迅速减少主机发送到网络中的分组数，使得发生拥塞的路 由器有 

      足够时间把队列中积压的分组处理完毕。 

     •     避免并非指完全能够避免了拥塞。拥塞避免是说在拥塞避免阶段把拥 

      塞窗 口控制为按线性规律增长，使网络比较不容易出现拥塞。 

•6） 快重传算法 
  •    用冗余 ACK 来检测丢包的发生，要求接收方每收到一个失序的报文段后就立 

    即发出重复确认。让发送方及早知道有报文段没有到达接收方。发送方只要连续 

    收到 个重3 豆确认就立即重传对方尚未收到的报文段 
﻿  •    重传并非取消重传计时器，而是在某些情况下可更早地重传丢失的报文段。 
•7） 快恢复算法 
  •      送端收到连续3个重复确认（冗余ACK）时，就执行“乘法减小”算法，重新设 
    置慢开始门限stresh（拥塞窗 口的一半）。 

  •      开始的不同之处是拥塞窗口cwnd不是设置为1,     而是设置为新的 

    ssthreshc 

  •   若发送窗口值还允许发送报文段，开始执行拥塞避免算法          （“加法增大”） ，使 

    得拥塞窗    慢地线性增大 

•8） 四种算法总结 
  •    开始、拥塞避免 、快重传和快恢复同时应用在拥塞控制机制中。 
  •     TCP连格律立和网络出现超时时, 采用慢开始和拥塞避免算法；当发送方接 
    U攵至H冗余ACK 日寸，  采用快重传和快恢复算法。 
  •      方的缓存空间总是有限的。发送方发送窗口的实际大小由流量控制和拥塞 
    控制共同决定。接收窗口     （rwnd）和拥塞窗口  （cwnd）时，发送方实际的发送 
    窗口大小是由rwnd和cwnd中较小的确定c 

•9） 图解 

     •    TCP 连接进行初始化时，拥塞窗口设置为 1  慢开始门限初始值设置为 
                                   。 
       16个报文段，即ssthresh=16 发送端的发送窗口不能超过拥塞窗 口0/72和 
                       。 
       接收端窗口rwnd中的最小值。假定接收端窗口足够大，发送窗 口数值等于拥 
       塞窗口数值。 

     •    执行慢开始算法时，拥塞窗口cwnd 的初始值为1,     发送第一个报文段 M。 
     •     端每收到一个确认，就把cwnd加1,    发送端可接着发送 M1和M?两个报 

       文段 

     •     端共发 回两个确认。发送端每收到一个对新报文段的确认，就把发送 
      端的 cwnd加1。现在cwnd从2增大到4, 并可接着发送后面的4个报文段 
     •     端每收到一个对新报文段的确认，就把发送端的拥塞窗            1, 拥懿 
       窗 Dcwnd 随着传输轮次按指数规律增长                      速 
﻿     •    塞窗口cwnd增长到慢开始门限值sstresh时 （当cwnd=16时），改为执 

      行拥塞避免算法，拥塞窗      线性规律增长 

     •  假定拥塞窗口的数值增长到24时，网络出现超时，表明网络拥塞 
     •   新后的ssthresh 值变为 12 （发送窗 口数值24的一半），拥塞窗 新设 

      置为 1, 并执行慢开始算法 

     •   cwnd=12 时改为执行拥塞避免算法，拥塞窗 口按线性规律增长，每经过 

      一个往返时延就增加一个 MSS 的大小 

  •  快恢复 

  • 客户和服务器都是指通信中所涉及的两个应用进程。客户一服务器方式所描述的 

    是进程之间服务和被服务的关系。 

•  2） 客户程序V， 
  •  被用户调用后运行，在通信时主动向远地服务器发起通信        （请求服务），客户 

    程序必须知道服务器程序的地址 

  •     要特殊的硬件和很复杂的操作系统 
•  3） 服务器程序 
  •     用来提供某种服务的程序，可同时处理多个远地或本地客户的请求 
  •     后即自动调用并一直不断运行着，被动的接收客户通信请求，服务器程序 

    不需要知道客户程序的地址 

  •   般需要强大的硬件和高级的操作系统支持 
•  4） 工作流程 
  •   务器处于接收请求的状态。 
  •   户机发 出服务请求，并等待接收结果。 
  •  服务器收到请求后，分析请求，进行必要的处理，得到结果并发送给客户机。 
•  5） 主要特点 
﻿       •  客户是服务请求方.  服务器是服务提供方;  客户机是面向用户的.  服务器层面 

        向任务的c 

       •    程序必须知道服务器程序的地址,  服务器程序不需要知道客户程序的地 
        城J服务器则从客户端发来的数据包中获取客户端的地址，一旦建立连接，服务 
        器能响应客户端请求的内容，服务器也能主动发送数据给客户端 

       •  客户与服务器的通信关系建立后，通信可以是双向的, 客户和服务器都可以发 

        送和接收数据 

       •   络中各计算机地位不平等，服务器可以限制权限，管理集中方便 
       •   户机之 间不直接通信 
       •   扩展性不好，受服务器硬件和网络带宽的限制，服务器支持的客户机数有限 
     • 6）应用 
       •Web 、FTP （文件传输协议）、远程登陆、电子邮件 
  •  2・P2P模型 

     •  1） 思想 
       • 整个网络中的传输内容不再被保存在中心服务器上，每个结点都同时具有下载、 

        上传的功能，其权利和义务都是大体对等的。 

     • 2） 特点 
       • 没有固定的客户和服务器划分。任意一对计算机直接相互通信。每个结点既作为 

        客户访问其他结点的资源，也作为服务器提供资源给其他结点访问 

     • 3）优点 
       •    服务器的计算压力，消除对某个服务器的完全依赖，将任务分配到各个结 

        点上，提高系统效率和资源利用率 

       •   个客户机之间可以直接共享文档。 
       •    展性好 
       •   络健壮性强，单个结点的失效不会影响其他部分的结点。 
• （二）域名系统 

  • 1.DNS系统概念 

     •  1）  相关概念 
       •  DNS系统把便于记忆的具有特定含义的主机名转换为便于机器处理的IP地址。 
       •  DNS 系统采用客户/服务器模型，其协议运行在 UDP之上，使用 53 号端口。 
       •  DND分为三部分：层次域名空间、域名服务器、解析器 
       •   机名、 IP地址在因特网中必须是唯一的.  一个主机名可以对应多个IP地址C 
     • 2）ARP与DNS 
       •  DNS 是应用层协议，用来请求域名服务器将连接在因特网上的某个主城避 
                                                  / 
        解析为 32位二讲制数 价 地址. 
﻿     •  ARP 是网络层协议，它采用广磨方式请求将连接在本地以太网上的某个主机或 

       路由器的32 位的IP 地址解析为 48 位的以太网硬件地址。 

           ：            ： 
     •  DNS 域名jP地址; ARP  IP地址TMAC地址 

• 2.层次域名空间 
  •  1) 每个域名都由标号序列组成，每个标号之间用点“.”隔开， 
  •  2) 级别低的域名写在左边，级别高的域名写在右边，域名没有大小写之分 
  •  3) 顶级域名分为三大类 
     •   家顶级域名：       中国；“.US”—美国 
     •   用顶级域名：“.com” ，“.net” 
     •   础结构域名：只有arpa,   用于反向解析域名 

• 3.域名服务器 

  •  1） 区：一个服务器所负责管辖的    （或有权限的） 范围《 
  •  2） 一个区中的所有结点必须是能够连通的， 每个区设置相应的权限域名服务器,  用 

    来保存该区中的所有主机的域名到IP 地址的映射 
                                  C 

  •  3） 每个域名福条居不但能够讲行一些域名到下地址的解析,  还必须具有淬向其他域 
    名服务器的信息。当 自己不能进行域名到IP地址的转换时，能够知道到什么地方去找 

    其他域名服务器。 

  •  4） DNS 服务器把数据复制到几个域名服务器来保存，其中的一个是主域名服务器， 
    其他的是辅助域名服务器。主域名服务器出现故障时，辅助域名服务器可以保证 DNS 
    的查询工作不会中断。主域名服务器定期把数据复制到辅助域名服务器中，更改数据 
    只能在主域名服务器中进行，保证了数据的一致性。 

  • 5）域名服务器美彰S 
     •   域名服务器：最高层次的域名服务器，有13个，管理顶级域，如.com,          通常 

             但域名解析成IP地址.  而是会告诉本地域名服务器 下一步应该区哪个顶 

              器查询 

     •     域名服务器：管理在该顶级域名服务器注册的所有二级域名， 当收到DNS 
       请求时， 可以直播给出最后的结果,  也可以告诉下一步去哪查询 

     •     域名服务器：每台主机都必须在授权域名服务器上 登记，可 以直接将其管 

       辖的主机名转换称为该主机的IP地址 

     •     域名服务器：当一个主机发出DNS查询请求时，该请求报文就要发送给该 

       主机的本地域名服务器 

- 4.域名解析过程 
  •  1） 域名解析 
     •  指把域名映射成为IP地址或把 IP地址映射成域名的过程C 
     •  当客户端需要域名解析时，通过本机的DNS客户端构造一个DNS 请求报文,  以 

       UDP 数据报方式发往本地域名服务器。 
﻿     • 2）两种方式 ：差归    和  已归与迭代相结合的查询。 
       • （1）本地域名服务器向根域名服务器查询一迭代查询 
         •     域名服务器收到本地域名服务器发 出的迭代查询请求报文时，要么给 
           出所要查询的 IP地址，要么告诉本地域名服务器：“你下一步应当向哪个顶级 
           域名服务器进行查询”。 

         •   地域名服务器 向这个顶级域名服务器进行后续的查询，顶级域名服务器 
           收到查询报文后，要么给出所要查询的IP地址，要么告诉本地域名服务器下 
           一步应向哪个权限域名服务器查询。 
         •   道所要解析的域名的IP地址后，把这个结果返回给发起查询的主机。 
       • （2） 主机向本地域名服务器查询一一递归查询 
         • 如果本地主机所询问的本地域名服务器不知道被查询域名的 IP 地址，本地域 

           名服务器就以 DNS 客户的身份，向根域名服务器继续发出查询请求报文       （即 
           替该主机继续查询），而不是让该主机自己进行下一步的查询。 

     • 3） 缓存 
       •  为提高 DNS 的查询效率，减少因特网上的 DNS 查询报文数量，在域名服务器 

        中广泛地使用了高速缓存。 

       •   DNS 服务器接收到DNS 查询结果时，它能将该 DNS 信息缓存在高速缓存 

        中。 

       •    一个相同的域名查询到达该 DNS 服务器时，该服务器就能够直接提供所要 
        求的IP地址，而不需要再去向其他 DNS 服务器询问。 

       •   机名和IP地址之间的映射不是永久的，DNS 服务器将在一段时间后丢弃高速 

        缓存中的信息。 

• （三）文件传输协议 

  •  LFTP协议的工作原理 

     •  1）  特点 
       •  FTP采用客户/服务器的工作方式,  使用 TCP可靠的传输服务。一个FTP 服务器 

        进程可同时为多个客户进程提供服务。 

       •  FTP 的服务器进程由两大部分组成：一个主进程，负责接收新的请求；另外有 

        若干从属进程，负责处理单个请求。 

       •    服务器必须在整个会话期间保留用户的状态信息       服务器必须杷指定的用 
          FTP                          。 

        户账户与控制连接联系起来，服务器必须追踪用户在远程目录树上的当前位置。 

       •  FTP服务器的数据要经过应用层 、传输层、网络层、数据链路层及物理层。对 

        应的封装是数据、数据段、数据报、数据帧，最后是比特。 

     • 2）FTP功能 
                                                      * 
       •     不同种类主机系统之间的文件传输能力。减少或消除在不同操作系统 
        理文件的不兼容性，屏蔽各计算机系统的细节，适合在异构网络中的任意然通 
﻿      之间传送文件。 

     • FTP提供交互式的访问,  允许客户指明文件的类型与格式，并允许文件具有存 

      取权限。 

     •  以用户权限管理的方式提供用户对远程 FTP服务器上的文件管理能力。 
     • 以匿名 FTP 的方式提供公用文件共享的能力。 

  • 3）工作步骤 
     • 抄开熟知端口21   （控制端口）、使客户进程能够连接上。 
     • 等待客户进程发连接请求。 
     •   动从属进程来处理客户进程发来的请求。主进程与从属进程并发执行，从属 

      进程对客户进程的请求处理完毕后即终止。 

     •   到等待状态，继续接收其他客户进程的请求。 

•  2.控制连接与数据连接 

         用户界面        TCP 控制连接 TCP21端口 

  日 

         FTP 客户端            220端口 FTP 服务器端 
                     TCP 数据连接 

    FTP 作时使     并行的       一个易控制连接   （端      一个是数据 
  •   在工    用两个     TCP连接：一个            21）、 
    洋建 （端   20）。     / ） 

  •  1）  控制连接 

          器监听21号端口，等待客户连接，建立在这个端        的连接称为控制连 
      接， 控制连接用来传输控制信息    （如连接请求 、传送请求等）， 并且控制信息都以 

      7位ASCI格式传送「 

       FTP客户发出的传送请求，通过控制连接发送给服务器端的控制进程，控制连 
      接并不用来传送文件。传输文件时可使用控制连接，控制连播在整个会话期间一 

      百保持打开状杰。 

       FTP 传输控制信息使用的是数据淬格外的控制连接.     FTP的控制信息是带外传 

  • 2）数据连接 
     • 服务器端的控制讲程在接收到FTP客户发来的文件传输请求后.  创建“数据传送讲 
      程”和“数据连接，数据连接用来连接客户端和服务器端的数据传送进程，数据传 
      送进程实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。 

  • 3） 数据连接两种传输模式 
     •   动模式PORT 。客户端连接到服务器的21端口、 登录成功后要读取数据时， 

      客户端随机开放一个端口，并发送命令告知服务器，服务器收到PORT 命令和端 
      口号后，通过20端     户端开放的端     播,  仅送数据。 
﻿        •    动模式PASV。客户端要读取数据时，发送PASV命令到服务器，服务器在本地 

          随机开放一个端口.  并告知客户端、 客户端再连接到服务器开放的端               行数据 

          传输。 

        •    PORT模式还是PASV模式选择权在客户端。 主动模式传送数据是“服务器”连播 
          到“客户端”的端口; 被动模式传送数据是“客户端”连播到“服务器”的端口。 

        •  FTP服务器是否使用 TCP20端口建立数据连接与传输模式有关，被动方式使用 

          TCP20 端口，被动方式 由服务器和客户端自行协商决定。 

• （四）电子邮件 

   •  1.电子邮件系统的组成结构 

     •  1）  概念 
        • 电子邮件是一种异步通信方式，通信时不需要双方同时在场。电子邮件把邮件发 
          送到收件人使用的邮件服务器，并放在其中的收件人邮箱中，收件人可以随时上 
          网到自己使用的邮件服务器进行读取。 

     •  2）组成构件 
        •    户代理  （UA） ：用户与电子邮件系统的接口。用户代理向用户提供接 口来发 

          送和接收邮件，用户代理至少应当具有撰写、显示和邮件处理的功能。 

        •  邮件服务器：发送和接收邮件，同时向发信人报告邮件传送的情况                （已交付、 

          被拒绝、丢失等）。邮件服务器采用客户/服务器方式工作，能够同时充当客户和 
          服务器。 

           • 邮件服务器A 向B发送邮件时，A作为 SMTP客户，B是SMTP服务器；当B向A发 
            送邮件时，B是SMTP客户，A 是SMTP服务器。 

        •    件发送协议和读取协议：邮件发送协议用于用户代理向邮件服务器发送邮件 
          或在邮件服务器之间发送邮件，如SMTP；  邮件读取协议用于用户代理从邮件服务 
          器读取邮件，如POP3。 

     •  3）STMP与POP3 

        •  SMTP用的是“推   （Push）的通信方式，即用户代理向邮件服务器发送邮件及在 
                      ” 
          邮件服务器之间发送邮件时.  SMTP客户将邮件“推”送到SMTP服务器0 

        •  POP3用的是“拉   （Pull） 的通信方式，即用户读取邮件时,  用户代理向邮件服 
                      ” 
          务器发出请求.“拉”取用户邮箱中的邮件 
                                     C 

     •  4）电子邮件收发过程 
﻿     •  发信人调用用户代理撰写和编辑要发送的邮件。用户代理用 SMTP把邮件传送 

      给发送端邮件服务器。 

     •  发送端邮件服务器将邮件放入邮件缓存队列中，等待发送。 
     •  运行在发送端邮件服务器的 SMTP客户进程，发现邮件缓存中有待发送的邮 

      件，就向运行在接收端邮件服务器的 SMTP 服务器进程发起建立 TCP 连接。 

     •  TCP 连接建立后，SMTP客户进程开始向远程 SMTP服务器进程发送邮件。当所 

      有待发送邮件发完后，SMTP 关闭所建立的 TCP 连接。 

     •   行在接收端邮件服务器中的 SMTP服务器进程收到邮件后，将邮件放入收信 

      人的用户邮箱，等待收信人在方便时进行读取。 

     •   信人收信时，调用用户代理，使用POP3 （或IxP）     协议将自己的邮件从接 
       收端邮件服务器的用户邮箱中取回。            节 
                              x/ 
•  2.电子邮件格式与 MIME          数广 
  •  1） 电子邮件格式 
     •  （1） 组成 
       •     电子邮件分为信封和内容两部分，内容分为首部和主体。RFC822 规定 
         了邮件首部格式，邮件主体部分由用户自由撰写。用户写好首部后，邮件系 
         统自动地将信封所需的信息提取出来并写在信封上，用户不需要亲自填写信 

         封上的信息。 

       •    部与主体力间用一个空行讲行分割 
                                c 

       •  邮件内容的首部包含一些首部行，每个首部行由一个关键字后跟冒号再后 

         跟值组成。 

     •  （2） 关键字 “To：”和 “Subject：”。 
       •  To 是必需关键字，后面填入一个或多个收件人的电子邮件地址。如 
         abc@cskaoyan.com, 收信人邮箱名即用户名，abc在cskaoyan.com这个邮件 
         服务器上必须是唯一的。 

       •  Subject 是可选关键字，是邮件的主题，反映了邮件的主要内容。 
  •  2）多用途网络邮件扩充MIME 
     •  （1）  引入：SMTP只能传送一定长度的ASCII码,  且无法传送可执行文件及其他二 

      进制对象， 因此提出了多用途网络邮件扩充 

     •  （2）  MIME并未改动SMTP或取代它。MIME意图继续使用 目前的格式，但增加了邮 
      件主体的结构，并定义 了传送非ASQ码的编码规则。 

     •    MIME邮件可在现有的申，子邮件程序和协议下传送。 
﻿     • （4）  MIME主要内容 
       •  5个新首部字段，包括 MIME版本、内容描述、内容标识、传送编码和内容 

         类型。 

       •      许多邮件内容格式，对多媒体电子邮件的表示方法进行标准化。 
       •    义传送编码，对任何内容格式进行转换，不会被邮件系统改变。 

•  3. SMTP协议 

  •  1）  概念 
     •     邮件传输协议   （SMTP） 是一种提供可靠且有效的电子邮件传输的协议，控 

       制两个相互通信的SMTP进程交换信息。 

     •  SMTP 使用客户/服务器方式.  负责发送邮件的SMTP进程是 SMTP客户，负责接 

       收邮件的 SMTP进程是SMTP服务器。 

     •  SMTP用TCP连中专, 端口号为25c 

  • 2）SMTP通信三个阶段 
     • （1） 连接建立 
       •    件人的邮件发送到发送方邮件服务器的邮件缓存中后，SMTP客户每隔一 

         定时间对邮件缓存扫描一次。如发现有邮件，就使用SMTP的熟知端口号 
          （25）与接收方邮件服务器的SMTP服务器建立TCP连接。 

       •  连接建立后，接收方SMTP服务器发出220 Service ready （服务就绪）。然 

         后 SMTP客户向SMTP服务器发送HELO命令,  附上发送方的主机名。 

       •  SMTP不使用中间的邮件服务器。TCP连接总是在发送方和榜收方2文两个邮 

         件服务器之间直接建立 

     • （2） 邮件传送 
       •  连接建立后，开始传送邮件。邮件的传送从 MAIL 命令开始，MAIL 命令后 

         面有发件人的地址。若 SMTP服务器已准备好接收邮件，则回答250 OK。接着 
         SMTP客户端发送一个或多个RCPT命令。每发送一个RCPT命令，都应有相应 
         的信息从SMTP服务器返回。 

       •  RCPT 命令作用：先弄清接收方系统是否已做好接收邮件的准备，然后才发 

         送邮件，不至于发送很长邮件后才知道地址错误，避免浪费通信资源。 

     • （3） 连接释放 
       • 邮件发送完毕后，SMTP 客户应发送 QUIT 命令。SMTP 服务器返回的信息是 
         221 （服务关闭），表示 SMTP 同意释放TCP 连接。邮件传送的全部过程就此 

         结束。 

•  4・POP3和IMAP协议 
  •  1) POP3概念 
     •    局协议  （POP） 是一个非常简单但功能有限的邮件读取协议 
﻿       •  POP3采用的是叶立” （Pull） 的通信方式、 当用户读取邮件时，用户代理向邮件 

        服务器发 出请求，“拉”取用户邮箱中的邮件。 

       •  POP使用客户/服务器的工作方式,  在传输层使用TCP,  端    IIO 接收方 
                                                。 

        用户代理上必须运行POP客户程序，收方运行POP服务器程序。 

     • 2）POP工作方式 
       •  “下载并保留"方式，用户从邮件服务器上读取邮件后，邮件依然会保存在邮件 
        服务器上，用户可再次从服务器上读取该邮件 

       •  “下载并删除"方式，邮件一旦被读取，就被从邮件服务器上删除，用户不能再 

        次从服务器上读取 

     • 3）IMAP概念 
       •  邮件读取协议因特网报文存取协议     （IMAP） , IMAP为用户提供了创建文夹、 

        在不同文件夹之间移动邮件及在远程文件夹中查询邮件等联机命令 ， IMAP服务器 
        维护了会话用户状态信息。 

       •  IMAP 特性是允许用户代理只获取报文的某些部分，适用于低带宽的情况 

     • 4）特点 
       • 用户浏览器与Hotmail或Gmail的邮件服务器之间的邮件发送或接收使用的是 

        HTTP, 而仅在不同邮件服务器之间传送邮件时才使用 SMTP 。 

•      WWW 
   （五） 

  • LWWW的概念与组成结构 

     •  1） 概念 
       • 
          万维网  （WWW） 是一个分布式、联机式的信息存储空间，在这个空间中：一 
        样有用的事物称为一样“资源”， 并由一个全域“统一资源定位符”  （URL）   标识。 
        资源通过超文本传输协议    （HTTP） 传送给使用者，URL通过单击链接来获取资 
        源。 

       •  万维网使用链接从因特网上的一个站点访问另一个站点        （“链接到另一个站 

        点”）  ，主动地按需获取丰富的信息。 

       •   文本标记语言   （HTML） 使得万维网页面的设计者可以很方便地用一个超链 

        接从本页面的某处链接到因特网上的任何一个万维网页面，并能够在自己的计算 
        机屏幕上显示这些页面。 

     • 2）内核部分构成 
       •   一资源定位符   （URL） 负责标识万维网上的各种文档，每个文档具有唯一 
                        。 
        的标识符 URL。 

       •   文本传输协议   （HTTP） o 一个应用层协议， 它使用 TCP 连接进行可靠的传 

        输，HTTP是万维网客户程序和服务器程序之间交互的协议。 

       •   文本标记语言   （HTML） o 一种文档结构的标记语言，它使用一些约定的标 

        记对页面上的各种信息    （包括文字、声音、图像、视频等） 格式进行描述。 
﻿  •  3) URL 
     • (1) URL 是对因特网上得到的资源位置和访问这些资源的方法。URL 相当于一个 

       文件名在网络范围的扩展。 

       (2) URL 形式：v协议  v主机＞：v端口〉/＜路径＞ 
     •              》：〃 
       •   v协议〉指用什么协议来获取万维网文档，常见的协议有 http、ftp 等； 
       •   v主机〉是存放资源的主机在因特网中的域名或IP地址； 
       • 
           v端口＞和＜路径〉有时可省略。在 URL中不区分大小写。 

  •  4) 工作流程 
     • (1) 万维网以客户/服务器方式工作。浏览器是在用户主机上的万维网客户程 

       序，而万维网文档所驻留的主机则运行服务器程序，客户程序向服务器程序发出 
       请求，服务器程序向客户程序送回客户所要的万维网文档。 

     • (2)  具体流程 
       •   Web用户使用浏览器   (指定URL) 与Web 服务器建立连接，并发送浏览请 

         求。 

       •   Web 服务器把 URL 转换为文件路径，并返回信息给 Web浏览器。 
       •      完成，关闭连接。 

•  ZHTTP协议 
  •  1) HTTP概念 
     •  HTTP 定义了浏览器  (万维网客户进程)  怎样向万维网服务器请求万维网文 

       档，以及服务器怎样把文档传送给浏览器。 

     •  HTTP是面向事务的应用层协议， 使用TCP库接讲行可靠传送。它规定了在浏览 

       器和服务器之间的请求和响应的格式与规则，是万维网上能够可靠地交换文件 
        (包括文本、声音、图像等各种多媒体文件)       的重要基础。 

  •  2) HTTP操作过程 
     • (1) 从协议执行过程来说，浏览器要访问WWW服务器时，首先要完成对 WWW 
       服务器的域名解析。一旦获得了服务器的IP地址，浏览器就通过 TCP 向服务器发 
       送连接建立请求。 

     • (2) 万维网工作过程 
﻿                              服务器 
                      5班 

         客户 

              浏览器       服务器 
              程序        程或 
             '     HTTP 

               HTTP簸此 
                S…    T* 
               了  苴或茵…" 

                 建立TCP连接 

     浏览器 
          - HTTP请^ 
     发出请求 

                *z=  HTTP响应报文   服务器 
                                返回响应 
                 释放TCP期 

     •      万维网站点都有一个服务器进程,       它不断地监听TCP的端口80 （默 

       加 ， 当监听到连接请求后便与浏览器建立 TCP淬播。 

     •    览器就向服务器发送请求获取某个 Web 页面的 HTTP请求。服务器收到 
       请求后，将构建所请求 Web 页的必需信息，并通过HTTP 响应返回给浏览 
       器。浏览器再将信息进行解释，然后将 Web 页显示给用户。 

     •  TCP 连接释放。 
   • （3） 在浏览器和服务器之间的请求与 响应的交互，必须遵循HTTP。TTP有两类 
    报文：请求报文    （从Web客户端向 Web服务器发送服务请求） 和响应报文        （从 
    Web 服务器对 Web客户端请求的回答）。 

   • （4） 用户单击鼠标后事件 

     （以访问清华大学的网站为例） 

     •   浏览器分析链接指向页面的URL      （http://www.tsinghua.edu.cn/chn/index.ht 
       m） 
     •    览器向 DNS 请求解析 www.tsinhua.edu.cn 的IP地址。 
     •    名系统 DNS 解析出清华大学服务器的IP 地址。 
     •    览器与该服务器建立 TCP淬接     （默认端口号为80） 。 
     •     器发出HTTP 请求：GET/chn/index.htm o 
     •     器通过 HTTP 响应把文件 index.htm 发送给浏览器。 
     •      TCP 连接。 
     •    览器解释文件 index.htm, 并将 Web页显示给用户。 
•  3) HTTP特点 
   • SHTTP使用 TCP作为运输层协议,  保证数据可靠传输c  HTTP不必考虑数据在传 
    输过程中被丢弃后又怎样被重传。HTTP本身是无连接的C           HTTP使用TCP连接. 
    通信双方在交换 HTTP报文之前不需要先建立HTTP连接. 
   •  HTTP是无状态的   同一个客户第二次访问同一个服务器上的页面时，服务器的 
                 。 

    响应与第一次被访问时的相同。服务器并不记得曾经访问过的这个客户，也不记 
﻿    得为该客户曾经服务过多少次。 

  •     Cookie 加数据库的方式来跟踪用户的活动。 
  •  HTTP 既可使用非持久连接.  也可使用持久连接    （HTTP/L1 支持） . 
•  4） HTTP报文结构 

     （1）HTTP是面向文本的.报文中的每个字段都是一些ASCH 码串,  并且每个字段 

    的长府都是不确定的C 

       有两类 HTTP 报文: 

         空格   回车换行         空格   回车换行 

     •    报文：从客户向服务器发送的请求报文 
     •    报文：从服务器到客户的回答 
     • 都由三个部分组成 
       •   始行：用于区分是请求报文还是响应报文。在请求报文中的开始行 

         称为请求行，而在响应报文中的开始行称为状态行。开始行的三个字段 
         之间都以空格分隔 

       •   部行：用来说明浏览器、服务器或报文主体的一些信息。 
       •     主体：在请求报文中一般都不用这个字段，而在有些响应报文中 

         也可能没有这个字段。 

•  5）非持久连接/持久连接 
  •  （1）非持久连接 

            万维网客户        万维网服务器 

            请求一个万维网文档所需的时间 

     •   个网页元素对象的传输都单独建立TCP 连接，      （第三次握手报文段中捎 
      带请求） 。 
     •    所需时间星该文档的传输时间加上两倍往返时间RTT        （一个RTT用举 

       TCP连寸妾, 另一个R「T用于请求和接收文档） 
﻿     •  每个对象引用都导致2xRTT的开销，每次建立新的 TCP 连接都要分配缓存 

       和变量 ，使万维网服务器的负担很重。 

   • （2）持久连接 

     • 指万维网服务器在发送响应后仍然保持这条连接，使同一个客户             （浏览器） 

       和该服务器可以继续在这条连接上传送后续的HTTP 请求和响应报文 

   • （3）持久连接分为非流水线和流水线 

     •    流水线方式，客户在收到前一个响应后才能发出下一个请求，服务器发 

       送完一个对象后，TCP 连接处于空闲状态，浪费了服务器资源。 

     •  HTTP/L1 默认使用流水线的持久连接，客户每遇到一个对象引用就立即发 
       出一个请求，客户可以逐个地连续发出对各个引用对象的请求。如果都是连 

       续的.  所有引用的对象共计经历1个 RTT 延迟 

•  6） Cookie工作原理 

   •  用户浏览使用 Cookie的网站，网站服务器为用户产生一个唯一的识别码， 

    如"123456" 

   •     用户的响应报文中添加一个Set-cookie 的首部行"Setcookie：123456"  用户 
                                                   。 
    收到响应后，在它管理的特定Cookie文件中添加服务器主机名和 Cookie 识别码 

   •     户浏览这个网站时，取出识别码，并放入请求报文的Cookie 首部 

    行“Cookie：123456”， 服务器根据请求报文中的Cookie 识别码就能从数据库中查 
    询到该用户的活动记录 
